<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhaozhiwei1992.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="show me your code">
<meta property="og:type" content="website">
<meta property="og:title" content="离线de日常">
<meta property="og:url" content="http://zhaozhiwei1992.github.io/page/5/index.html">
<meta property="og:site_name" content="离线de日常">
<meta property="og:description" content="show me your code">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mr.zhao">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zhaozhiwei1992.github.io/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>离线de日常</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">离线de日常</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2021/01/24/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/24/%E8%BD%AF%E4%BB%B6%E6%B5%8B%E8%AF%95%E8%AF%B4%E6%98%8E/" class="post-title-link" itemprop="url">软件测试说明</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-24 00:00:00" itemprop="dateCreated datePublished" datetime="2021-01-24T00:00:00+08:00">2021-01-24</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91/" itemprop="url" rel="index"><span itemprop="name">软件开发</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>::: {.center}<br><strong>xx公司</strong></p>
<p><strong>2020-01-01</strong><br>:::</p>
<p><strong>文档管理</strong></p>
<p>合理地管理主文档，确保文档版本的及时更新，同时保持备份文档和源文档的一致性。</p>
<p><strong>版本管理</strong></p>
<hr>
<p>本版本修订日期   2019-08-12   生效日期   2019-08-12</p>
<hr>
<p>版本   生效日期     变更内容       编制人</p>
<hr>
<p>V1.0   2020-01-01   初稿编写完成   xx</p>
<h1 id="范围"><a href="#范围" class="headerlink" title="范围"></a>范围</h1><h2 id="标识"><a href="#标识" class="headerlink" title="标识"></a>标识</h2><p>本条应包含本文档及本文档适用的系统和软件的完整标识，(若适用)包括标识号、标题、缩略词语、版本号和发行号。</p>
<h2 id="系统概述"><a href="#系统概述" class="headerlink" title="系统概述"></a>系统概述</h2><p>本条应简述本文档适用的系统和软件的用途，它应描述系统和软件的一般特性；概述系统开发、运行和维护的历史；标识项目的开发方、业主方、总集方、监理方等；标识当前和计划的运行现场等。</p>
<h2 id="文档概述"><a href="#文档概述" class="headerlink" title="文档概述"></a>文档概述</h2><p>本条应概述本文档的用途和内容，并描述与其使用有关的保密性和私密性的要求。</p>
<h1 id="引用文件"><a href="#引用文件" class="headerlink" title="引用文件"></a>引用文件</h1><p>应列出本文档引用的所有文档的编号、标题、修订版本、日期和来源。</p>
<h1 id="术语和缩略语"><a href="#术语和缩略语" class="headerlink" title="术语和缩略语"></a>术语和缩略语</h1><p>提供此文档中用到的专门术语的定义和缩写词的原词组。</p>
<h1 id="测试准备"><a href="#测试准备" class="headerlink" title="测试准备"></a>测试准备</h1><p>以下按照软件测试类型（如：功能测试、性能测试、可靠性测试等）分章节编写。</p>
<p>每一项测试类型均应有唯一的标识号，应描述如何准备并获取测试资源，如测试环境所必须的软件、硬件、数据资源等；必要时，应描述如何准备测试程序，如开发测试接口所需的数据仿真、业务仿真程序以及测试支持软件等。</p>
<h2 id="（测试名称、唯一标识号）"><a href="#（测试名称、唯一标识号）" class="headerlink" title="（测试名称、唯一标识号）"></a>（测试名称、唯一标识号）</h2><h3 id="设施环境要求"><a href="#设施环境要求" class="headerlink" title="设施环境要求"></a>设施环境要求</h3><p>描述对测试场所、设施和环境的要求。（若有）分析上述差异对测试可能造成的影响。</p>
<h3 id="硬件准备"><a href="#硬件准备" class="headerlink" title="硬件准备"></a>硬件准备</h3><p>描述对测试硬件的要求。分析硬件差异对测试可能造成的影响。</p>
<h3 id="软件准备"><a href="#软件准备" class="headerlink" title="软件准备"></a>软件准备</h3><p>描述对测试软件的要求。分析软件差异对测试可能造成的影响。</p>
<h3 id="数据准备"><a href="#数据准备" class="headerlink" title="数据准备"></a>数据准备</h3><p>描述对测试数据的要求。分析数据差异对测试可能造成的影响。</p>
<h3 id="其它测试准备"><a href="#其它测试准备" class="headerlink" title="其它测试准备"></a>其它测试准备</h3><p>描述对测试程序等分面的其他测试准备工作。</p>
<h1 id="测试项分解"><a href="#测试项分解" class="headerlink" title="测试项分解"></a>测试项分解</h1><p>将需测试的内容进行层次化的分解形成测试项，并进行标识命名。对最终分解后的每个测试项，说明测试用例设计方法的具体应用、测试数据的选择依据等。测试项与具体的功能和性能要求对应，测试项还应包含对用户文档(用户手册、安装部署手册)的测试。</p>
<h1 id="测试说明"><a href="#测试说明" class="headerlink" title="测试说明"></a>测试说明</h1><p>逐层对测试项和测试用例进行标识和说明。其中，测试用例至少应包含：所属测试项、用例名称标识、用例说明、对应需求、前提和约束、执行步骤、预期结果等。</p>
<p>注：测试用例可采用表格方式，可作为本文档的附件另行成文，以下是对测试用例相关项的解释。</p>
<p>对应需求：说明测试所依据的内容来源，如软件需求规格说明书中的需求功能编号或具体条款</p>
<p>测试说明：简要描述测试的对象、目的和所采用的测试方法。</p>
<p>前提和约束：说明实施该测试用例的前提条件和约束条件，如环境条件、准备工作等。</p>
<p>执行步骤：编写按照执行顺序排列的一系列相对独立的步骤，每一个执行步骤应包括测试操作动作、测试程序输入或设备操作、期望的测试结果。</p>
<p>预期结果：期望测试结果应有具体内容(如确定的元数值、业务流程状态等)，不应是不确切的概念或笼统的描述。</p>
<h1 id="测试用例执行顺序"><a href="#测试用例执行顺序" class="headerlink" title="测试用例执行顺序"></a>测试用例执行顺序</h1><p>应确定软件测试用例的执行顺序，从而合理安排测试执行过程，避免重复执行测试用例，提高测试工作效率。同时，通过合理的测试用例执行顺序实现对完整的业务流程的确认和验证。</p>
<h1 id="内容审核要点："><a href="#内容审核要点：" class="headerlink" title="内容审核要点："></a>内容审核要点：</h1><p>测试说明的范围与合同及其附件要求等是否一致；是否覆盖了全部软件需求；是否覆盖了全部测试需求；</p>
<p>软件测试准备是否充分；</p>
<p>软件测试分解是否合理；测试设计思路是否清晰；测试技术实现方法是否科学；</p>
<p>对接口的分析和说明是否完整、准确；对接口测试的正常和容错说明是否全面；</p>
<p>测试用例是否充分；除正常操作、正常流程、正常数据外，是否覆盖了可测试的异常情况；</p>
<p>测试用例的执行顺序是否合理；是否可覆盖必要的业务流程。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a7984927cfb9">https://www.jianshu.com/p/a7984927cfb9</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2021/01/23/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E8%AE%A1%E5%88%92/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/23/%E8%BD%AF%E4%BB%B6%E5%BC%80%E5%8F%91%E8%AE%A1%E5%88%92/" class="post-title-link" itemprop="url">软件开发计划</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-23 22:38:00" itemprop="dateCreated datePublished" datetime="2021-01-23T22:38:00+08:00">2021-01-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">软件设计</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>::: {.center}<br><strong>xx公司</strong></p>
<p><strong>2020-01-01</strong><br>:::</p>
<p><strong>文档管理</strong></p>
<p>合理地管理主文档，<br>确保文档版本的及时更新，同时保持备份文档和源文档的一致性。</p>
<p><strong>版本管理</strong></p>
<hr>
<p>本版本修订日期   2019-08-12   生效日期   2019-08-12</p>
<hr>
<p>版本   生效日期     变更内容       编制人</p>
<hr>
<p>V1.0   2020-01-01   初稿编写完成   xx</p>
<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><h2 id="标识"><a href="#标识" class="headerlink" title="标识"></a>标识</h2><p>本条应包含本文档的完整标识，以及本文档适用的系统和软件的完整标识，包括标识号、标题、缩略词语、版本号和发行号。</p>
<h2 id="系统概述"><a href="#系统概述" class="headerlink" title="系统概述"></a>系统概述</h2><p>本条应简述本文档适用的系统和软件的用途，应描述系统和软件的一般特性；概述系统开发、运行和维护的历史；标识项目的业主方、用户、承建方、监理方等；标识当前和计划的运行现场等。</p>
<h2 id="文档概述"><a href="#文档概述" class="headerlink" title="文档概述"></a>文档概述</h2><p>概述本文档的用途和内容，并描述与其使用有关的保密性和私密性的要求。</p>
<h2 id="与其他计划之间的关系"><a href="#与其他计划之间的关系" class="headerlink" title="与其他计划之间的关系"></a>与其他计划之间的关系</h2><p>描述本计划和其他项目管理计划的关系。</p>
<h2 id="输入基线"><a href="#输入基线" class="headerlink" title="输入基线"></a>输入基线</h2><p>给出编写本项目开发计划的输入基线，如业务需求说明书等。</p>
<h1 id="引用文件"><a href="#引用文件" class="headerlink" title="引用文件"></a>引用文件</h1><p>应列出本文档引用的所有文档的编号、标题、修订版本、日期和来源。</p>
<h1 id="项目范围及约束条件"><a href="#项目范围及约束条件" class="headerlink" title="项目范围及约束条件"></a>项目范围及约束条件</h1><h2 id="交付产品"><a href="#交付产品" class="headerlink" title="交付产品"></a>交付产品</h2><p>列出本项目的交付产品成果，包括软件程序、交付文档等，以及各交付成果的交付期限。</p>
<h2 id="业务需求和约束条件"><a href="#业务需求和约束条件" class="headerlink" title="业务需求和约束条件"></a>业务需求和约束条件</h2><p>分条阐述项目的业务需求和约束条件；</p>
<h2 id="其它方面的需求和约束条件"><a href="#其它方面的需求和约束条件" class="headerlink" title="其它方面的需求和约束条件"></a>其它方面的需求和约束条件</h2><p>分条阐述其它方面的约束，如项目进度要求、保密性等。</p>
<h2 id="项目目标"><a href="#项目目标" class="headerlink" title="项目目标"></a>项目目标</h2><p>综述项目进度目标、成本目标、质量目标。</p>
<h1 id="项目总体计划"><a href="#项目总体计划" class="headerlink" title="项目总体计划"></a>项目总体计划</h1><h2 id="软件开发过程和里程碑"><a href="#软件开发过程和里程碑" class="headerlink" title="软件开发过程和里程碑"></a>软件开发过程和里程碑</h2><p>描述要采用的软件开发过程。计划应覆盖论及它的所有合同条款，确定已计划的开发阶段(适用)、目标和各阶段要执行的软件开发活动。</p>
<p>里程碑设置分条阐述里程碑/阶段名称、期限、里程碑标志说明（进入条件和输出）、评审方式等。</p>
<p>提供一张工作产品矩阵表，描述各工作产品的编号、名称、产生阶段、评审方式等。工作产品包括各阶段产生的过程文档和技术文档等，是工作任务分解和配置管理计划制定的重要依据。</p>
<h2 id="软件开发方法"><a href="#软件开发方法" class="headerlink" title="软件开发方法"></a>软件开发方法</h2><p>描述或引用要使用的软件开发方法，包括为支持这些方法所使用的手工、自动工具和过程的描述。</p>
<h2 id="软件产品标准"><a href="#软件产品标准" class="headerlink" title="软件产品标准"></a>软件产品标准</h2><p>描述或引用在表达需求、设计、编码、测试用例、测试过程和测试结果方面要遵循的标准和要求。对要使用的各种编程语言应提供编码标准。</p>
<h2 id="评审途径"><a href="#评审途径" class="headerlink" title="评审途径"></a>评审途径</h2><p>阐述软件内部评审的方式，以及需方或授权代表（总集、监理）实施软件产品和活动评审的途径和方式。</p>
<h2 id="软件配置管理"><a href="#软件配置管理" class="headerlink" title="软件配置管理"></a>软件配置管理</h2><p>描述针对本项目所采用和遵循的软件配置管理方法.包括配置项的标识、控制、状态统计、审核、交付等。</p>
<p>具体的配置项识别和管理可在配置管理计划中另文给出。</p>
<h2 id="软件质量保证"><a href="#软件质量保证" class="headerlink" title="软件质量保证"></a>软件质量保证</h2><p>描述针对在本项目所采用和遵循的软件质量保证方法。包括软件质量保证评估、软件质量保证记录和处理、第三方独立性保证等。质量保证计划也可另文给出。承建方应在计划中落实下述内部审核和检查工作：</p>
<p>软件计划审核：在软件计划编制阶段结束后必须进行软件计划审核，以确保在软件开发计划、软件配置管理计划、软件质量保证计划中所规定的计划的合适性。</p>
<p>软件需求审核：在软件需求分析阶段结束后必须进行软件需求审核，以确保在软件需求规格说明中所规定的各项需求的合适性。</p>
<p>软件概要设计审核：在软件设计结束后必须进行软件设计的审核，以评价软件概要设计说明、数据结构设计说明中所描述的软件设计在总体结构、外部接口、主要部件功能分配、全局数据结构以及各主要部件之间的接口等方面的合适性；以及在数据结构、功能、算法和过程描述等方面的合适性。</p>
<p>软件详细设计、编码阶段的审核：在软件详细设计和编码实现完成之后要对软件详细设计说明、软件测试计划、软件测试说明（含软件测试用例）、目标程序生成说明进行审核，以确认业主方的业务需求是否得到满足，验证软件需求规格说明中的需求是否已由软件设计说明描述的设计实现，软件设计说明表达的设计是否已由编码实现。</p>
<p>出厂测试审核：在完成出厂测试之后要对源代码交付验证说明、软件测试报告（含源代码交付验证报告）以及按照合同要求应提交给业主方的所有文档（如：软件用户手册等）进行审核，以评价待交付的程序及文档的质量是否满足出厂交付要求、覆盖了业主方的业务需求、做好了交付准备。</p>
<p>部署审核：在配合监理方和业主方完成测试工作后承建方进入系统部署阶段，在完成软件部署并配合完成系统联调联试后，要对部署实施报告进行审核，以验证部署实施的真实性以及外部接口的正确性。</p>
<h2 id="问题跟踪和处理-更正活动"><a href="#问题跟踪和处理-更正活动" class="headerlink" title="问题跟踪和处理(更正活动)"></a>问题跟踪和处理(更正活动)</h2><p>描述软件更正活动中要遵循的方法，包括不同阶段的问题发现、纪录、报告、处理、审核和更正流程，问题/bug跟踪系统的选用等。须论及出厂测试、需方验证测试、试运行三个阶段。</p>
<h2 id="档案收集"><a href="#档案收集" class="headerlink" title="档案收集"></a>档案收集</h2><p>阐述作为承建方在项目进行过程中进行自身档案收集管理的方法，包括纸质档案。</p>
<h1 id="项目估算及进度计划"><a href="#项目估算及进度计划" class="headerlink" title="项目估算及进度计划"></a>项目估算及进度计划</h1><h2 id="工作任务分解"><a href="#工作任务分解" class="headerlink" title="工作任务分解"></a>工作任务分解</h2><p>分解项目工作任务，得出工作任务分解结构（WBS）。</p>
<h2 id="规模估算"><a href="#规模估算" class="headerlink" title="规模估算"></a>规模估算</h2><p>估算项目规模，如需新编的代码行数、文档页数等。</p>
<h2 id="工作量估算"><a href="#工作量估算" class="headerlink" title="工作量估算"></a>工作量估算</h2><p>根据规模估算及项目经验，估算项目工作量。</p>
<h2 id="进度计划"><a href="#进度计划" class="headerlink" title="进度计划"></a>进度计划</h2><p>在工作任务分解结构（WBS）、工作量估算的基础上，进行活动排序、资源分配，进而编制进度计划甘特图,标识各活动的依赖关系、资源分配情况、起止时间等。</p>
<h2 id="风险估计及应对方法"><a href="#风险估计及应对方法" class="headerlink" title="风险估计及应对方法"></a>风险估计及应对方法</h2><p>逐条给出识别的风险及其风险估计量化指标（可能性、严重性等级）、相应的对策和缓解方案。建议以列表的方式给出。</p>
<h1 id="项目跟踪与变更管理"><a href="#项目跟踪与变更管理" class="headerlink" title="项目跟踪与变更管理"></a>项目跟踪与变更管理</h1><h2 id="项目日常跟踪"><a href="#项目日常跟踪" class="headerlink" title="项目日常跟踪"></a>项目日常跟踪</h2><p>阐述项目日常跟踪方法，包括由业主方和授权代表(监理方)参与的项目跟踪。</p>
<h2 id="里程碑评审"><a href="#里程碑评审" class="headerlink" title="里程碑评审"></a>里程碑评审</h2><p>阐述或引用项目各里程碑评审的方法。</p>
<h2 id="变更管理"><a href="#变更管理" class="headerlink" title="变更管理"></a>变更管理</h2><p>包括计划变更、需求变更等的处理流程、机制和方法。</p>
<h1 id="项目组织和资源"><a href="#项目组织和资源" class="headerlink" title="项目组织和资源"></a>项目组织和资源</h1><h2 id="项目组织"><a href="#项目组织" class="headerlink" title="项目组织"></a>项目组织</h2><p>本条应描述本项目要采用的组织结构，包括涉及的组织机构、机构之间的关系、执行所需活动的每个机构的权限和职责。</p>
<h2 id="项目资源"><a href="#项目资源" class="headerlink" title="项目资源"></a>项目资源</h2><p>本条应描述适用于本项目的资源。 主要包括：</p>
<p>人力资源，分条说明投入此项目的人员、职责、投入阶段、地理位置和涉密程度等；</p>
<p>开发人员要使用的设施，包括执行工作的地理位置、要使用的设施、保密区域和运用合同项目的设施的其他特性；</p>
<p>为满足合同需要，需方应提供的设备、软件、服务、文档、资料及设施及需要提供的时间。</p>
<h1 id="内部培训"><a href="#内部培训" class="headerlink" title="内部培训"></a>内部培训</h1><p>根据项目的技术要求和项目成员的情况，确定是否需要进行项目培训，并制订培训计划。如不需要培训，应说明理由。</p>
<h1 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h1><p>本章应包含有助于理解本文档的一般信息(例如原理)。本章应包含为理解本文档需要的术语和定义，所有缩略语和它们在文档中的含义的字母序列表。</p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><p>附录可用来提供那些为便于文档维护而单独出版的信息(例如图表、分类数据)。为便于处理，附录可单独装订成册。附录应按字母顺序(A,<br>B等)编排。</p>
<h1 id="内容审核要点："><a href="#内容审核要点：" class="headerlink" title="内容审核要点："></a>内容审核要点：</h1><p>项目范围阐述与合同及其附件要求等是否一致；</p>
<p>工作任务分解与项目范围/需求是否一致；</p>
<p>工作任务分解、工作量估计和活动进度安排是否合理；</p>
<p>计划内容是否包括软件项目管理的各个必要的方面；</p>
<p>作产品定义是否包含需方所要求的各相关必要文档；</p>
<p>织机构和人力资源安排和分配是否合理并符合合同相关要求；</p>
<p>目日常跟踪管理是否具有可操作性；</p>
<p>目开发过程中的问题/bug处理机制是否具有可操作性；</p>
<p>案收集管理是否具有可操作性。</p>
<p>是否制定了合适的配置管理策略和质量保证策略。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a7984927cfb9">https://www.jianshu.com/p/a7984927cfb9</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2021/01/23/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E6%89%8B%E5%86%8C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/23/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2%E6%89%8B%E5%86%8C/" class="post-title-link" itemprop="url">软件安装部署手册</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-23 22:36:00" itemprop="dateCreated datePublished" datetime="2021-01-23T22:36:00+08:00">2021-01-23</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E5%AE%89%E8%A3%85%E9%83%A8%E7%BD%B2/" itemprop="url" rel="index"><span itemprop="name">软件安装部署</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>::: {.center}<br><strong>xx公司</strong></p>
<p><strong>2020-01-01</strong><br>:::</p>
<p><strong>文档管理</strong></p>
<p>合理地管理主文档，确保文档版本的及时更新，同时保持备份文档和源文档的一致性。</p>
<p><strong>版本管理</strong></p>
<hr>
<p>本版本修订日期   2019-08-12   生效日期   2019-08-12</p>
<hr>
<p>版本   生效日期     变更内容       编制人</p>
<hr>
<p>V1.0   2020-01-01   初稿编写完成   xx</p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="编写目的"><a href="#编写目的" class="headerlink" title="编写目的"></a>编写目的</h2><p>说明编写目的，指出本文档的预期读者。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>说明系统的项目背景，使用本系统所包含的用户。</p>
<h2 id="范围"><a href="#范围" class="headerlink" title="范围"></a>范围</h2><p>说明本文档的适用范围。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>列出所参考的文档，如其它的用户文档。</p>
<h2 id="软件清单"><a href="#软件清单" class="headerlink" title="软件清单"></a>软件清单</h2><p>列出所提交的软件产品的程序及其它必要的附件文件，包括可能的支持软件、第三方包、脚本文件、说明文档等，对清单中的名项给出必要的说明。</p>
<h1 id="运行环境要求"><a href="#运行环境要求" class="headerlink" title="运行环境要求"></a>运行环境要求</h1><p>说明系统进行安装部署时，对运行环境的要求，分为硬件环境和软件环境，包括服务器、客户端。</p>
<p>服务器端的运行环境，硬件方面需要指出最低参数要求，软件方面需要指出如操作系统、数据库软件、web应用服务器的名称、版本信息等。</p>
<p>客户端的运行环境，硬件方面需要指出最低参数要求，软件方面需要列出操作系统版本、运行依赖的浏览器版本、需要安装的驱动程序等。</p>
<h1 id="支撑软件的安装、部署和配置"><a href="#支撑软件的安装、部署和配置" class="headerlink" title="支撑软件的安装、部署和配置"></a>支撑软件的安装、部署和配置</h1><p>给出所有支撑软件的安装、部署和配置步聚，可以引用第三方文档。</p>
<h2 id="lt-支撑软件X-gt-的安装、部署和配置"><a href="#lt-支撑软件X-gt-的安装、部署和配置" class="headerlink" title="&lt;支撑软件X&gt;的安装、部署和配置"></a>&lt;支撑软件X&gt;的安装、部署和配置</h2><p>支撑软件X安装、部署和配置步聚。</p>
<h1 id="应用程序的安装、部署和配置"><a href="#应用程序的安装、部署和配置" class="headerlink" title="应用程序的安装、部署和配置"></a>应用程序的安装、部署和配置</h1><h2 id="lt-应用程序x-gt-的安装、部署和配置"><a href="#lt-应用程序x-gt-的安装、部署和配置" class="headerlink" title="&lt;应用程序x&gt;的安装、部署和配置"></a>&lt;应用程序x&gt;的安装、部署和配置</h2><h3 id="安装、部署前的准备工作"><a href="#安装、部署前的准备工作" class="headerlink" title="安装、部署前的准备工作"></a>安装、部署前的准备工作</h3><p>说明系统进行安装部署前，需要进行的前期准备工作。如对操作系统、数据库、web应用服务器进行相应的参数设置，数据库的初始化等等。</p>
<h3 id="部署环境概要说明"><a href="#部署环境概要说明" class="headerlink" title="部署环境概要说明"></a>部署环境概要说明</h3><p>可以对部署的服务器环境，如文件目录结构，进行概要说明。</p>
<h3 id="依赖"><a href="#依赖" class="headerlink" title="依赖"></a>依赖</h3><p>系统在进行安装、部署时，如果需要对外部系统运行或接口有依赖关系，在此列出。</p>
<h3 id="安装、部署和配置步聚"><a href="#安装、部署和配置步聚" class="headerlink" title="安装、部署和配置步聚"></a>安装、部署和配置步聚</h3><p>列出详细的安装、部署和配置过程，包括对相关配置文件内容的修改。</p>
<h1 id="程序的启动和停止"><a href="#程序的启动和停止" class="headerlink" title="程序的启动和停止"></a>程序的启动和停止</h1><p>给出软件的启动和停止说明</p>
<h1 id="内容审核要点："><a href="#内容审核要点：" class="headerlink" title="内容审核要点："></a>内容审核要点：</h1><p>所述运行环境和支撑软件是否详细完备；</p>
<p>部署前的准备工作是否详细完备；</p>
<p>安装过程是否详细易懂。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a7984927cfb9">https://www.jianshu.com/p/a7984927cfb9</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2021/01/22/%E6%BA%90%E4%BB%A3%E7%A0%81%E4%BA%A4%E4%BB%98%E8%AF%B4%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/22/%E6%BA%90%E4%BB%A3%E7%A0%81%E4%BA%A4%E4%BB%98%E8%AF%B4%E6%98%8E/" class="post-title-link" itemprop="url">源代码交付说明</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-22 00:00:00" itemprop="dateCreated datePublished" datetime="2021-01-22T00:00:00+08:00">2021-01-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/" itemprop="url" rel="index"><span itemprop="name">项目文档</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>::: {.center}<br><strong>xx公司</strong></p>
<p><strong>2020-01-01</strong><br>:::</p>
<p><strong>文档管理</strong></p>
<p>合理地管理主文档，<br>确保文档版本的及时更新，同时保持备份文档和源文档的一致性。</p>
<p><strong>版本管理</strong></p>
<hr>
<p>  本版本修订日期   2019-08-12   生效日期   2019-08-12</p>
<hr>
<p>  版本   生效日期     变更内容       编制人</p>
<hr>
<p>  V1.0   2020-01-01   初稿编写完成   xx</p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>说明系统的项目背景，本系统的使用和运维单位等。</p>
<h2 id="范围"><a href="#范围" class="headerlink" title="范围"></a>范围</h2><p>说明本文档的适用范围。</p>
<h1 id="源代码交付清单"><a href="#源代码交付清单" class="headerlink" title="源代码交付清单"></a>源代码交付清单</h1><p>以表格的形式，列出所提交的源代码光盘中所有的文件目录结构，对各目录和子目录加以说明。对主要源代码程序加以说明。对其它必要的附件（包括第三方包、类库、配置文件、程序的帮助说明文档等）也要加以说明。</p>
<h1 id="编译和打包的说明"><a href="#编译和打包的说明" class="headerlink" title="编译和打包的说明"></a>编译和打包的说明</h1><h2 id="编译环境和工具要求"><a href="#编译环境和工具要求" class="headerlink" title="编译环境和工具要求"></a>编译环境和工具要求</h2><p>如果需要，对编译环境和所需要工具进行简要说明。</p>
<h2 id="编译和打包步聚"><a href="#编译和打包步聚" class="headerlink" title="编译和打包步聚"></a>编译和打包步聚</h2><p>说明对源代码进行编译和打包的详细步聚，要能根据这些步骤生成可用的目标程序。尽量使用脚本方式生成目标程序。</p>
<h2 id="生成物说明"><a href="#生成物说明" class="headerlink" title="生成物说明"></a>生成物说明</h2><p>对编译生成的执行程序进行简要说明。</p>
<h1 id="内容审核要点："><a href="#内容审核要点：" class="headerlink" title="内容审核要点："></a>内容审核要点：</h1><p>交付清单是否详细完备；</p>
<p>说明文字是否明确易懂；</p>
<p>交付物版本是否和实际系统的程序版本一致（能根据本文档生成与实际生产系统一致的程序）；</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a7984927cfb9">https://www.jianshu.com/p/a7984927cfb9</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2021/01/22/%E7%B3%BB%E7%BB%9F%E4%B8%8A%E7%BA%BF%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%96%BD%E6%8A%A5%E5%91%8A/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/22/%E7%B3%BB%E7%BB%9F%E4%B8%8A%E7%BA%BF%E9%83%A8%E7%BD%B2%E5%AE%9E%E6%96%BD%E6%8A%A5%E5%91%8A/" class="post-title-link" itemprop="url">系统上线部署实施报告</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-22 00:00:00" itemprop="dateCreated datePublished" datetime="2021-01-22T00:00:00+08:00">2021-01-22</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/" itemprop="url" rel="index"><span itemprop="name">项目文档</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h1><p>::: {.center}<br><strong>xx公司</strong></p>
<p><strong>2020-01-01</strong><br>:::</p>
<p><strong>文档管理</strong></p>
<p>合理地管理主文档，确保文档版本的及时更新，同时保持备份文档和源文档的一致性。</p>
<p><strong>版本管理</strong></p>
<hr>
<p>  本版本修订日期   2019-08-12   生效日期   2019-08-12</p>
<hr>
<p>  版本   生效日期     变更内容       编制人</p>
<hr>
<p>  V1.0   2020-01-01   初稿编写完成   xx</p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="编写目的"><a href="#编写目的" class="headerlink" title="编写目的"></a>编写目的</h2><p>说明编写目的，指出预期的读者范围。</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>简要描述此次上线部署的背景。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>列出所参考的文档，如安装部署手册等。</p>
<h1 id="工作内容"><a href="#工作内容" class="headerlink" title="工作内容"></a>工作内容</h1><p>说明本次上线部署的工作内容。即要做哪几件事。</p>
<h1 id="实际完成情况"><a href="#实际完成情况" class="headerlink" title="实际完成情况"></a>实际完成情况</h1><p>对照工作内容，详细说明本次实际部署过程和工作任务完成情况。</p>
<h1 id="部署测试情况"><a href="#部署测试情况" class="headerlink" title="部署测试情况"></a>部署测试情况</h1><p>详细说明本次部署测试情况，测试内容是否都获通过。</p>
<h1 id="遗留工作和待解决问题"><a href="#遗留工作和待解决问题" class="headerlink" title="遗留工作和待解决问题"></a>遗留工作和待解决问题</h1><p>如果有遗留工作或问题，需要在此部分列出。</p>
<h1 id="签字栏"><a href="#签字栏" class="headerlink" title="签字栏"></a>签字栏</h1><p>本报告作为验收的依据，需要相关方的签字。应留有签字栏。</p>
<h1 id="内容审核要点："><a href="#内容审核要点：" class="headerlink" title="内容审核要点："></a>内容审核要点：</h1><p>任务描述是否明确；</p>
<p>部署实际完成情况是否描述清楚；</p>
<p>部署测试情况是否描述清楚；</p>
<p>部署部署过程是否与实际情况一致。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a7984927cfb9">https://www.jianshu.com/p/a7984927cfb9</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2021/01/20/%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E7%94%9F%E6%88%90%E8%AF%B4%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/20/%E5%8F%AF%E6%89%A7%E8%A1%8C%E7%A8%8B%E5%BA%8F%E7%94%9F%E6%88%90%E8%AF%B4%E6%98%8E/" class="post-title-link" itemprop="url">可执行程序生成说明</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-01-20T00:00:00+08:00">2021-01-20</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>::: {.center}<br><strong>xx公司</strong></p>
<p><strong>2020-01-01</strong><br>:::</p>
<p><strong>文档管理</strong></p>
<p>合理地管理主文档，<br>确保文档版本的及时更新，同时保持备份文档和源文档的一致性。</p>
<p><strong>版本管理</strong></p>
<hr>
<p>  本版本修订日期   2019-08-12   生效日期   2019-08-12</p>
<hr>
<p>  版本   生效日期     变更内容       编制人</p>
<hr>
<p>  V1.0   2020-01-01   初稿编写完成   xx</p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="编写目的"><a href="#编写目的" class="headerlink" title="编写目的"></a>编写目的</h2><p>说明编写目的。本文档主要供开发方项目组内部使用，其目的包括：</p>
<ul>
<li>  便于项目组测试人员通过版本控制机制，每次生成新的目标程序在干净的环境下进行自测（包括出厂测试）；</li>
<li>  便于今后源代码的交付。</li>
</ul>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>说明软件系统的名称和作用，以及本可执行程序属于软件系统的哪一部分。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>列出所参考的文档，如需求规格说明、设计说明等。</p>
<h1 id="工具和支撑软件要求"><a href="#工具和支撑软件要求" class="headerlink" title="工具和支撑软件要求"></a>工具和支撑软件要求</h1><p>指出目标程序生成的工具要求，如对于使用ant<br>脚本生成目标程序的方式，需要ant工具的支持。<br>指出目标程序执行的支撑软件要求，如虚拟机、应用服务器或其它底层软件支持。<br>注：建议尽量提供生成脚本而不依赖于可视化开发工具来生成目标代码，以便于测试方能根据版本控制库中的源码迅速生成目标程序进行测试和回归测试。</p>
<h1 id="源代码获取"><a href="#源代码获取" class="headerlink" title="源代码获取"></a>源代码获取</h1><p>指出从何处及如何获取源代码，包括脚本程序代码。一般情况下，在开发团队内部，源代码的获取方法和步骤与项目源代码配置管理方式相关。</p>
<h1 id="目标程序生成步骤"><a href="#目标程序生成步骤" class="headerlink" title="目标程序生成步骤"></a>目标程序生成步骤</h1><p>详细说明目标程序生成步骤，步骤的多少与项目复杂度、所编制脚本功能强弱等因素相关。<br>注：不管步骤多少，整个步骤应是明确和完备的，并提供方便的清除所生成目标程序的方法。</p>
<h1 id="目标程序的执行"><a href="#目标程序的执行" class="headerlink" title="目标程序的执行"></a>目标程序的执行</h1><p>说明如何运行生成的目标程序，一般包括以下内容：</p>
<ul>
<li>  从何处获取生成的目标程序；</li>
<li>  执行前的准备工作，如配置文件的修改、数据库表定义/删除的脚本的执行、数据库表的初始化数据生成/清除脚本的执行等；</li>
<li>  软硬件运行环境的建立；</li>
<li>  程序的部署和执行。</li>
</ul>
<h1 id="内容审核要点："><a href="#内容审核要点：" class="headerlink" title="内容审核要点："></a>内容审核要点：</h1><ul>
<li>  所述各目标程序生成说明文档是否涵盖项目整个软件系统；</li>
<li>  所述步骤是否明确和详细；</li>
<li>  是否内部有版本控制机制。</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a7984927cfb9">https://www.jianshu.com/p/a7984927cfb9</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2021/01/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/20/%E6%95%B0%E6%8D%AE%E5%BA%93%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E/" class="post-title-link" itemprop="url">数据库设计说明</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-20 00:00:00" itemprop="dateCreated datePublished" datetime="2021-01-20T00:00:00+08:00">2021-01-20</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%96%87%E6%A1%A3/" itemprop="url" rel="index"><span itemprop="name">软件文档</span></a>
                </span>
                  ，
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%BD%AF%E4%BB%B6%E6%96%87%E6%A1%A3/%E9%A1%B9%E7%9B%AE%E6%96%87%E6%A1%A3/" itemprop="url" rel="index"><span itemprop="name">项目文档</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>::: {.center}<br><strong>xx公司</strong></p>
<p><strong>2020-01-01</strong><br>:::</p>
<p><strong>文档管理</strong></p>
<p>合理地管理主文档，<br>确保文档版本的及时更新，同时保持备份文档和源文档的一致性。</p>
<p><strong>版本管理</strong></p>
<hr>
<p>  本版本修订日期   2019-08-12   生效日期   2019-08-12</p>
<hr>
<p>  版本   生效日期     变更内容       编制人</p>
<hr>
<p>  V1.0   2020-01-01   初稿编写完成   xx</p>
<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="编写目的"><a href="#编写目的" class="headerlink" title="编写目的"></a>编写目的</h2><p>描述该文档的编写目的。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>列出此文档所参考的文档，如软件需求规格说明、软件设计说明等。</p>
<h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><p>（若有）对存储数据分类进行简要说明（数据可以按照子系统进行划分）。</p>
<ul>
<li>  第全局类数据及其说明</li>
<li>  第二类数据及其说明</li>
<li>  第三类数据及其说明</li>
</ul>
<h2 id="使用它的程序"><a href="#使用它的程序" class="headerlink" title="使用它的程序"></a>使用它的程序</h2><p>描述对应不同分类的数据，所使用它的外部程序或者业务系统。</p>
<h2 id="约定"><a href="#约定" class="headerlink" title="约定"></a>约定</h2><p>描述数据库设计方面的标识约定、设计约定、特殊约定等。</p>
<h1 id="数据定义"><a href="#数据定义" class="headerlink" title="数据定义"></a>数据定义</h1><h2 id="全局数据"><a href="#全局数据" class="headerlink" title="全局数据"></a>全局数据</h2><p>主要应用范围： 作用： 数据库定义文件： ER图文件：</p>
<h3 id="表结构设计"><a href="#表结构设计" class="headerlink" title="表结构设计"></a>表结构设计</h3><ol>
<li><p>.1 表一与触发器</p>
<p> 表一结构说明，包括：表名、表说明（内容、作用）、索引、各列属性。<br> 各列属性，包括：列英文名、列中文名、 数据类型、长度、 列取值含义等。<br> 触发器列表，包括：名称、说明、定义等。</p>
</li>
<li><p>.2 表二与触发器</p>
<p> ……</p>
</li>
</ol>
<h3 id="视图设计"><a href="#视图设计" class="headerlink" title="视图设计"></a>视图设计</h3><ol>
<li><p>.1 视图一</p>
<p> 定义： 用途：</p>
</li>
<li><p>.1 视图二</p>
<p> ……</p>
</li>
</ol>
<h3 id="存储过程设计"><a href="#存储过程设计" class="headerlink" title="存储过程设计"></a>存储过程设计</h3><ol>
<li><p>.1 过程一</p>
<p> 定义： 用途： 输入： 输出：</p>
</li>
</ol>
<h3 id="2-过程二"><a href="#2-过程二" class="headerlink" title=".2 过程二"></a>.2 过程二</h3><p>……</p>
<h2 id="第二类数据"><a href="#第二类数据" class="headerlink" title="第二类数据"></a>第二类数据</h2><p>主要应用范围： 作用： 数据库定义文件： ER图文件：</p>
<h3 id="表结构设计-1"><a href="#表结构设计-1" class="headerlink" title="表结构设计"></a>表结构设计</h3><p>……</p>
<h3 id="视图设计-1"><a href="#视图设计-1" class="headerlink" title="视图设计"></a>视图设计</h3><p>……</p>
<h3 id="存储过程设计-1"><a href="#存储过程设计-1" class="headerlink" title="存储过程设计"></a>存储过程设计</h3><p>……</p>
<h1 id="数据库角色定义"><a href="#数据库角色定义" class="headerlink" title="数据库角色定义"></a>数据库角色定义</h1><h2 id="第一类角色"><a href="#第一类角色" class="headerlink" title="第一类角色"></a>第一类角色</h2><p>角色职能： 角色权限：</p>
<h2 id="第二类角色"><a href="#第二类角色" class="headerlink" title="第二类角色"></a>第二类角色</h2><p>……</p>
<h1 id="数据库安全设计"><a href="#数据库安全设计" class="headerlink" title="数据库安全设计"></a>数据库安全设计</h1><p>针对数据库安全方面的要求进行的设计，包括保密性、安全性等方面。</p>
<h1 id="数据库备份设计"><a href="#数据库备份设计" class="headerlink" title="数据库备份设计"></a>数据库备份设计</h1><p>针对数据的备份要求，描述数据库的备份策略、备份和恢复的手段、备份计划、操作步骤等方面的内容。</p>
<h1 id="内容审核要点："><a href="#内容审核要点：" class="headerlink" title="内容审核要点："></a>内容审核要点：</h1><ul>
<li>  本文档内容与软件设计文档、软件需求文档是否一致性；</li>
<li>  所述内容是否完备；</li>
<li>  本文档内容本身是否前后一致；</li>
<li>表结构描述是否清楚明确； （若有）触发器描述是否清楚明确；<br>  （若有）视图描述是否清楚明确； （若有）存储过程描述是否清楚明确；</li>
<li>  数据库角色设置是否清楚合理。</li>
<li>  是否满足了安全、备份的要求。</li>
</ul>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/a7984927cfb9">https://www.jianshu.com/p/a7984927cfb9</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2021/01/17/%E5%85%B3%E4%BA%8E%E6%8E%A5%E5%8F%A3%E6%8F%8F%E8%BF%B0%E7%9A%84%E6%96%87%E6%A1%A3%E5%86%85%E5%AE%B9%E8%A6%81%E6%B1%82/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2021/01/17/%E5%85%B3%E4%BA%8E%E6%8E%A5%E5%8F%A3%E6%8F%8F%E8%BF%B0%E7%9A%84%E6%96%87%E6%A1%A3%E5%86%85%E5%AE%B9%E8%A6%81%E6%B1%82/" class="post-title-link" itemprop="url">附: 关于接口描述的文档内容要求</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2021-01-17 00:00:00" itemprop="dateCreated datePublished" datetime="2021-01-17T00:00:00+08:00">2021-01-17</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="接口的概念"><a href="#接口的概念" class="headerlink" title="接口的概念"></a>接口的概念</h2><p>在应用软件系统中，接口是程序和系统与外界交互的窗口。本文中所阐述的接口，包括：</p>
<p>应用软件系统提供软件功能供外部软件程序调用；<br>应用软件系统调用外部系统提供的软件功能；<br>应用软件系统依据应用级别的交互协议与外系统进行功能和数据的交换；<br>应用软件系统通过公用文件目录或数据库与外部系统交换信息。</p>
<p>此处中所阐述的接口不包括：</p>
<p>应用软件系统内部功能模块之间的接口调用；<br>应用软件系统提供的人机交互界面。</p>
<h2 id="接口处理策略"><a href="#接口处理策略" class="headerlink" title="接口处理策略"></a>接口处理策略</h2><p>xxxxxxxxxxx是一个庞大的由众多应用子系统构成的复杂分布式系统。各应用子系统之间存在众多的软件接口关系。<br>在xxxxxxxxxxx中，我们采用SOA的体系架构来解决各应用子系统之间、应用子系统与外部系统之间的接口问题。通过基于ESB服务总线技术的应用支撑平台来发布和管理应用软件系统对外提供公用服务。在这里，服务系指精确定义、封装完善、独立于其他服务所处环境和状态的软件功能。接口服务系指以服务的方式提供的接口实现。<br>通过支撑平台，各业务子系统接口之间的点对点关系，变成了各业务子系统接口与支撑平台的关系，从而简化了系统间的逻辑关系，应用支撑平台是各业务子系统相互连接的中介和纽带。各业务子系统之间在进行服务请求和服务调用时所需的一些附加工作，如通信协议的转换、路由、消息格式转换、安全性保证等，也可以由应用支撑平台来提供支持。此外，应用支撑平台提供适配器方式以支持文件同步、数据库同步、JMS、FTP等,应用支持平台还提供定制适配器功能接入特殊的外部系统。<br>通过应用支持平台发布公用服务，将有利于接口服务的复用，以及接口服务的维护和管理。</p>
<h2 id="接口文档规范的必要性"><a href="#接口文档规范的必要性" class="headerlink" title="接口文档规范的必要性"></a>接口文档规范的必要性</h2><p>xxxxxxxxxxx建设过程中，各应用软件系统的接口定义、实现、发布和管理是处理好接口问题的四个关键环节，他们贯穿在软件生命周期的全过程。为了保证在这些环节对应用软件系统之间的接口问题进行有效的处理，保证接口的良好定义、合理实现、受控发布和方便管理，有必要对相关技术文档提出规范化要求。<br>涉及接口定义的技术文档主要有业务需求说明书、软件需求规格说明书；涉及接口实现的技术文档主要有软件概要设计说明书、软件详细设计说明书、用户手册；涉及接口服务发布和管理的技术文档包括接口服务发布和管理规范等。</p>
<h1 id="接口定义的文档规范要求"><a href="#接口定义的文档规范要求" class="headerlink" title="接口定义的文档规范要求"></a>接口定义的文档规范要求</h1><h2 id="业务需求说明书中的接口描述"><a href="#业务需求说明书中的接口描述" class="headerlink" title="业务需求说明书中的接口描述"></a>业务需求说明书中的接口描述</h2><p>在xxxxxxxxxxx中，业务需求说明书由业主方任命的子项目组负责编制。业务需求说明书中有关接口描述的要求：</p>
<ul>
<li>  宜有专门章节阐述子项目拟分包系统与其它子项目系统及外部系统之间的接口关系；</li>
<li>  在描述本系统与外部某系统接口关系时，宜：</li>
</ul>
<p>具体阐明本系统的哪项或哪些业务功能与所述外部系统存在接口关系；<br>阐明接口的类型，如向外系统提供数据、从外系统获取数据、对外系统提供功能服务、向外系统请求某项功能服务；<br>对所述接口作必要的文字解释。</p>
<h2 id="软件需求规格说明书中的接口描述"><a href="#软件需求规格说明书中的接口描述" class="headerlink" title="软件需求规格说明书中的接口描述"></a>软件需求规格说明书中的接口描述</h2><p>软件需求规格说明书系由承建方在业务需求说明书的基础上，在系统功能、性能、外部限制条件等方面的进一步明确和细化，作为系统设计、实现、测试的依据。是涉及接口定义的重要文档。<br>软件需求规格说明书中有关接口定义和描述的要求如下：</p>
<ul>
<li>  软件需求规格说明书中有关与外部系统接口定义的范围应涵盖业务需求说明书中有关接口的描述，并补充业务需求书中遗漏的接口内容；</li>
<li>  本系统作为接口对外提供的软件功能，应在软件需求规格说明书中明确阐明该功能。包括接口功能编号、名称、性质（功能服务、数据交换、文件交换等）、接口功能的各输入参数及数据类型，返回的结果数据类型等；</li>
<li>  如果接口是作为某种信息交互协议（如Z39.50）的服务端提供的功能，要求阐明支持的协议版本以及是否完全支持该协议，如果不完全支持，要明确列举支持或不支持的功能；</li>
<li>  如果接口是某种信息交互协议（如Z39.50）的客户端，且外部系统提供的相应协议服务端功能是本系统相关功能实现的必要条件，须将对外部系统的相关接口实现要求列入软件需求规格说明书中的限制条件部分；</li>
<li>  如果系统功能涉及到要使用或访问外部系统提供的功能，须将其列入需求规格说明书中限制条件部分。</li>
</ul>
<h2 id="接口定义的变更"><a href="#接口定义的变更" class="headerlink" title="接口定义的变更"></a>接口定义的变更</h2><p>如果在软件需求评审通过后的实施过程中，原定义或描述的接口发生了变化，须通过变更流程修改软件需求规格说明书；或编制需求文档的补充材料，与原需求规格说明书一起，作为测试和验收的依据。</p>
<h1 id="接口实现的文档规范要求"><a href="#接口实现的文档规范要求" class="headerlink" title="接口实现的文档规范要求"></a>接口实现的文档规范要求</h1><h2 id="软件设计说明书中的接口服务实现描述"><a href="#软件设计说明书中的接口服务实现描述" class="headerlink" title="软件设计说明书中的接口服务实现描述"></a>软件设计说明书中的接口服务实现描述</h2><p>在软件概要设计说明书中，有关接口实现的要求如下：</p>
<ul>
<li>  须覆盖软件需求说明书中所述对外提供接口功能；</li>
<li>确定接口的实现策略。如采用Web<br>  Service、EJB、通过网络端口连接对外提供服务、文件目录或数据库同步等。</li>
<li>  对外提供的接口功能，需要进行形式化描述，如果不能确定在软件概要设计说明书完全进行接口功能的形式化表述，应在该说明书中明示并在详细设计说明书中给出以供编码实现之用。</li>
</ul>
<h2 id="用户文档中的接口使用描述"><a href="#用户文档中的接口使用描述" class="headerlink" title="用户文档中的接口使用描述"></a>用户文档中的接口使用描述</h2><p>在设计说明书中描述的所有对外提供的接口功能，最终都要落实在用户文档中。具体的用户文档名称，取决于项目合同和软件开发计划中对最终交付文件的规定。如用户使用手册、用户参考手册、用户技术手册等。<br>各应用软件系统通过该系统的用户文档对外正式公布本系统对外的接口服务的功能和调用方式。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2019/08/18/shiro%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/18/shiro%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">shiro实战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-18 00:00:00" itemprop="dateCreated datePublished" datetime="2019-08-18T00:00:00+08:00">2019-08-18</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="基本设置-springboot整合"><a href="#基本设置-springboot整合" class="headerlink" title="基本设置 springboot整合"></a>基本设置 springboot整合</h1><ol>
<li> 引入依赖包</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- https://mvnrepository.com/artifact/org.apache.shiro/shiro-core --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.apache.shiro&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;shiro-spring&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;1.4.0&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>

<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><ol>
<li> 创建shiro.ini</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">#格式： 用户名=密码,角色1,角色2</span><br><span class="line">[users]</span><br><span class="line">ck=123456,admin</span><br><span class="line"></span><br><span class="line">#格式：角色=权限1,权限2</span><br><span class="line">[roles]</span><br><span class="line">admin=add</span><br><span class="line">teacher=update</span><br></pre></td></tr></table></figure>

<ol>
<li> 使用api测试验证</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public Map&lt;String,Object&gt; userLoginAction (String userName,String passWord)&#123;</span><br><span class="line"></span><br><span class="line">    Map&lt;String,Object&gt; resultMap = new HashMap&lt;&gt;();</span><br><span class="line">    //初始化SecurityManager对象</span><br><span class="line">    Factory&lt;SecurityManager&gt; factory = new IniSecurityManagerFactory(&quot;classpath:shiro.ini&quot;);</span><br><span class="line">    //通过SecurityManager工厂对象,获取SecurityManager实例对象.</span><br><span class="line">    SecurityManager securityManager =  factory.getInstance();</span><br><span class="line">    // 把 securityManager 实例 绑定到 SecurityUtils</span><br><span class="line">    SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line">    //组建Subject主体.</span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    //创建 token 令牌</span><br><span class="line">    UsernamePasswordToken token = new UsernamePasswordToken(userName,passWord);</span><br><span class="line">    //用户登录操作.</span><br><span class="line">    try&#123;</span><br><span class="line">        subject.login(token);</span><br><span class="line">        resultMap.put(&quot;code&quot;,&quot;200&quot;);</span><br><span class="line">        resultMap.put(&quot;msg&quot;,&quot;用户登录成功&quot;);</span><br><span class="line">    &#125;catch (AuthenticationException e)&#123;</span><br><span class="line">        //登录失败原因 1 用户不存在 2 用户密码不正确</span><br><span class="line">        resultMap.put(&quot;code&quot;,&quot;-1&quot;);</span><br><span class="line">        resultMap.put(&quot;msg&quot;,&quot;用户登录失败&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    return resultMap;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h1><ol>
<li> 自定义配置类</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line">import org.apache.shiro.mgt.SecurityManager;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.shiro.authc.*;</span><br><span class="line">import org.apache.shiro.authz.AuthorizationInfo;</span><br><span class="line">import org.apache.shiro.authz.SimpleAuthorizationInfo;</span><br><span class="line">import org.apache.shiro.realm.AuthorizingRealm;</span><br><span class="line">import org.apache.shiro.realm.SimpleAccountRealm;</span><br><span class="line">import org.apache.shiro.spring.LifecycleBeanPostProcessor;</span><br><span class="line">import org.apache.shiro.spring.security.interceptor.AuthorizationAttributeSourceAdvisor;</span><br><span class="line">import org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line">import org.apache.shiro.subject.PrincipalCollection;</span><br><span class="line">import org.apache.shiro.web.mgt.DefaultWebSecurityManager;</span><br><span class="line">import org.springframework.aop.framework.autoproxy.DefaultAdvisorAutoProxyCreator;</span><br><span class="line">import org.springframework.context.annotation.Bean;</span><br><span class="line">import org.springframework.context.annotation.Configuration;</span><br><span class="line">import org.springframework.context.annotation.DependsOn;</span><br><span class="line">import org.springframework.web.servlet.handler.SimpleMappingExceptionResolver;</span><br><span class="line"></span><br><span class="line">import java.util.LinkedHashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line">import java.util.Properties;</span><br><span class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">@Configuration</span><br><span class="line">public class CustomShiroConfiguration &#123;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">    * Filter Name	Class</span><br><span class="line">    * anon	org.apache.shiro.web.filter.authc.AnonymousFilter</span><br><span class="line">    * authc	org.apache.shiro.web.filter.authc.FormAuthenticationFilter</span><br><span class="line">    * authcBasic	org.apache.shiro.web.filter.authc.BasicHttpAuthenticationFilter</span><br><span class="line">    * perms	org.apache.shiro.web.filter.authz.PermissionsAuthorizationFilter</span><br><span class="line">    * port	org.apache.shiro.web.filter.authz.PortFilter</span><br><span class="line">    * rest	org.apache.shiro.web.filter.authz.HttpMethodPermissionFilter</span><br><span class="line">    * roles	org.apache.shiro.web.filter.authz.RolesAuthorizationFilter</span><br><span class="line">    * ssl	org.apache.shiro.web.filter.authz.SslFilter</span><br><span class="line">    * user	org.apache.shiro.web.filter.authc.UserFilter</span><br><span class="line">    * anon:所有 url 都都可以匿名访问</span><br><span class="line">    * authc: 需要认证才能进行访问</span><br><span class="line">    * user:配置记住我或认证通过可以访问</span><br><span class="line">    *</span><br><span class="line">    * @param securityManager</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">  @Bean</span><br><span class="line">  public ShiroFilterFactoryBean shiroFilter(SecurityManager securityManager) &#123;</span><br><span class="line">      log.info(&quot;注入Shiro的Web过滤器--&gt;shiroFilter&quot;, ShiroFilterFactoryBean.class);</span><br><span class="line">      ShiroFilterFactoryBean shiroFilterFactoryBean = new ShiroFilterFactoryBean();</span><br><span class="line"></span><br><span class="line">      //Shiro的核心安全接口,这个属性是必须的</span><br><span class="line">      shiroFilterFactoryBean.setSecurityManager(securityManager);</span><br><span class="line">      //要求登录时的链接(可根据项目的URL进行替换),非必须的属性,默认会自动寻找Web工程根目录下的&quot;/login.jsp&quot;页面</span><br><span class="line">      shiroFilterFactoryBean.setLoginUrl(&quot;/login&quot;);</span><br><span class="line">      //登录成功后要跳转的连接,逻辑也可以自定义，例如返回上次请求的页面</span><br><span class="line">      shiroFilterFactoryBean.setSuccessUrl(&quot;/index&quot;);</span><br><span class="line">      //用户访问未对其授权的资源时,所显示的连接</span><br><span class="line">      shiroFilterFactoryBean.setUnauthorizedUrl(&quot;/403&quot;);</span><br><span class="line">      /*定义shiro过滤器,例如实现自定义的FormAuthenticationFilter，需要继承FormAuthenticationFilter **本例中暂不自定义实现，在下一节实现验证码的例子中体现 */</span><br><span class="line"></span><br><span class="line">      /*定义shiro过滤链 Map结构 * Map中key(xml中是指value值)的第一个&#x27;/&#x27;代表的路径是相对于HttpServletRequest.getContextPath()的值来的 *</span><br><span class="line">      anon：它对应的过滤器里面是空的,什么都没做,这里.do和.jsp后面的*表示参数,比方说login.jsp?main这种 * authc：该过滤器下的页面必须验证后才能访问,它是Shiro内置的一个拦截器org</span><br><span class="line">      .apache.shiro.web.filter.authc.FormAuthenticationFilter */</span><br><span class="line">      Map&lt;String, String&gt; filterChainDefinitionMap = new LinkedHashMap&lt;String, String&gt;();</span><br><span class="line">      // 配置退出过滤器,其中的具体的退出代码Shiro已经替我们实现了</span><br><span class="line">      filterChainDefinitionMap.put(&quot;/logout&quot;, &quot;logout&quot;);</span><br><span class="line"></span><br><span class="line">      // &lt;!-- 过滤链定义，从上向下顺序执行，一般将 /**放在最为下边 --&gt;:这是一个坑呢，一不小心代码就不好使了;</span><br><span class="line">      // &lt;!-- authc:所有url都必须认证通过才可以访问; anon:所有url都都可以匿名访问--&gt;</span><br><span class="line">      filterChainDefinitionMap.put(&quot;/login&quot;, &quot;anon&quot;);//anon 可以理解为不拦截</span><br><span class="line">      filterChainDefinitionMap.put(&quot;/reg&quot;, &quot;anon&quot;);</span><br><span class="line">      filterChainDefinitionMap.put(&quot;/plugins/**&quot;, &quot;anon&quot;);</span><br><span class="line">      filterChainDefinitionMap.put(&quot;/pages/**&quot;, &quot;anon&quot;);</span><br><span class="line">      filterChainDefinitionMap.put(&quot;/api/**&quot;, &quot;anon&quot;);</span><br><span class="line">      filterChainDefinitionMap.put(&quot;/dists/img/*&quot;, &quot;anon&quot;);</span><br><span class="line">      filterChainDefinitionMap.put(&quot;/**&quot;, &quot;authc&quot;);</span><br><span class="line"></span><br><span class="line">      shiroFilterFactoryBean.setFilterChainDefinitionMap(filterChainDefinitionMap);</span><br><span class="line"></span><br><span class="line">      return shiroFilterFactoryBean;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">//    @Bean</span><br><span class="line">//    public EhCacheManager ehCacheManager() &#123;</span><br><span class="line">//        EhCacheManager cacheManager = new EhCacheManager();</span><br><span class="line">//        return cacheManager;</span><br><span class="line">//    &#125;</span><br><span class="line"></span><br><span class="line">  @Bean</span><br><span class="line">  public CustomShiroRealm customShiroRealm() &#123;</span><br><span class="line">      return new CustomShiroRealm();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Bean</span><br><span class="line">  public SecurityManager securityManager(CustomShiroRealm userRealm) &#123;</span><br><span class="line">      log.info(&quot;注入Shiro的Web过滤器--&gt;securityManager&quot;, ShiroFilterFactoryBean.class);</span><br><span class="line">      DefaultWebSecurityManager securityManager = new DefaultWebSecurityManager();</span><br><span class="line">      securityManager.setRealm(userRealm);</span><br><span class="line">      //注入缓存管理器;</span><br><span class="line">//        securityManager.setCacheManager(ehCacheManager());//这个如果执行多次，也是同样的一个对象;</span><br><span class="line">      return securityManager;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">    * Shiro生命周期处理器 * @return</span><br><span class="line">    */</span><br><span class="line">  @Bean</span><br><span class="line">  public LifecycleBeanPostProcessor lifecycleBeanPostProcessor() &#123;</span><br><span class="line">      return new LifecycleBeanPostProcessor();</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">    * 开启Shiro的注解</span><br><span class="line">    * (如@RequiresRoles,@RequiresPermissions),需借助SpringAOP扫描使用Shiro注解的类,并在必要时进行安全逻辑验证</span><br><span class="line">    * 配置以下两个bean(DefaultAdvisorAutoProxyCreator(可选)和AuthorizationAttributeSourceAdvisor)即可实现此功能</span><br><span class="line">    *</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">  @Bean</span><br><span class="line">  @DependsOn(&#123;&quot;lifecycleBeanPostProcessor&quot;&#125;)</span><br><span class="line">  public DefaultAdvisorAutoProxyCreator advisorAutoProxyCreator() &#123;</span><br><span class="line">      DefaultAdvisorAutoProxyCreator advisorAutoProxyCreator = new DefaultAdvisorAutoProxyCreator();</span><br><span class="line">      advisorAutoProxyCreator.setProxyTargetClass(true);</span><br><span class="line">      return advisorAutoProxyCreator;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @Bean</span><br><span class="line">  public AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor(SecurityManager securityManager) &#123;</span><br><span class="line">      AuthorizationAttributeSourceAdvisor authorizationAttributeSourceAdvisor =</span><br><span class="line">              new AuthorizationAttributeSourceAdvisor();</span><br><span class="line">      authorizationAttributeSourceAdvisor.setSecurityManager(securityManager);</span><br><span class="line">      return authorizationAttributeSourceAdvisor;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">    * 异常处理</span><br><span class="line">    *</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">  @Bean</span><br><span class="line">  public SimpleMappingExceptionResolver simpleMappingExceptionResolver() &#123;</span><br><span class="line">      SimpleMappingExceptionResolver r = new SimpleMappingExceptionResolver();</span><br><span class="line">      Properties mappings = new Properties();</span><br><span class="line">      mappings.setProperty(&quot;DatabaseException&quot;, &quot;databaseError&quot;);//数据库异常处理</span><br><span class="line">      mappings.setProperty(&quot;UnauthorizedException&quot;, &quot;403&quot;);</span><br><span class="line">      r.setExceptionMappings(mappings);  // None by default</span><br><span class="line">      r.setDefaultErrorView(&quot;error&quot;);    // No default</span><br><span class="line">      r.setExceptionAttribute(&quot;ex&quot;);     // Default is &quot;exception&quot;</span><br><span class="line">      //r.setWarnLogCategory(&quot;example.MvcLogger&quot;);     // No default</span><br><span class="line">      return r;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">    * 自定义方式</span><br><span class="line">    */</span><br><span class="line">  class CustomShiroRealm extends AuthorizingRealm &#123;</span><br><span class="line"></span><br><span class="line">      /**</span><br><span class="line">        * 授权, 通过角色授权, 这里设置角色信息即可</span><br><span class="line">        * 参考: https://gitee.com/ityouknow/spring-boot-examples/blob/master/spring-boot-shiro/src/main/java/com/neo</span><br><span class="line">        * /config/MyShiroRealm.java</span><br><span class="line">        * https://blog.csdn.net/fu_fei_wen/article/details/77571989</span><br><span class="line">        *</span><br><span class="line">        * @param principals</span><br><span class="line">        * @return</span><br><span class="line">        */</span><br><span class="line">      @Override</span><br><span class="line">      protected AuthorizationInfo doGetAuthorizationInfo(PrincipalCollection principals) &#123;</span><br><span class="line">          //在实际开发中，开发者根据自身情况自行获取用户信息。此处简化如下：</span><br><span class="line">          String role = &quot;admin&quot;;</span><br><span class="line">          String permission = &quot;add&quot;;</span><br><span class="line"></span><br><span class="line">          log.info(&quot;&#123;&#125;, role:&#123;&#125;, permission:&#123;&#125;&quot;, Thread.currentThread().getStackTrace()[1].getMethodName(), role,</span><br><span class="line">                  permission);</span><br><span class="line"></span><br><span class="line">          //设置权限信息</span><br><span class="line">          SimpleAuthorizationInfo simpleAuthorizationInfo = new SimpleAuthorizationInfo();</span><br><span class="line">          simpleAuthorizationInfo.addRole(role);</span><br><span class="line">          simpleAuthorizationInfo.addStringPermission(permission);</span><br><span class="line"></span><br><span class="line">          return simpleAuthorizationInfo;</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      /**</span><br><span class="line">        * 主要是用来进行身份认证的，也就是说验证用户输入的账号和密码是否正确。</span><br><span class="line">        *</span><br><span class="line">        * @param token</span><br><span class="line">        * @return</span><br><span class="line">        * @throws AuthenticationException</span><br><span class="line">        */</span><br><span class="line">      @Override</span><br><span class="line">      protected AuthenticationInfo doGetAuthenticationInfo(AuthenticationToken token)</span><br><span class="line">              throws AuthenticationException &#123;</span><br><span class="line">          //在实际开发中，开发者根据自身情况自行获取用户信息。此处简化如下：</span><br><span class="line">          String name = &quot;zhangsan&quot;;</span><br><span class="line">          String pwd = &quot;11&quot;;</span><br><span class="line"></span><br><span class="line">          UsernamePasswordToken upt = (UsernamePasswordToken) token;</span><br><span class="line">          String username = upt.getUsername();</span><br><span class="line">          String password = new String(upt.getPassword());</span><br><span class="line"></span><br><span class="line">          if (name.equals(username) &amp;&amp; pwd.equals(password)) &#123;</span><br><span class="line">              return new SimpleAuthenticationInfo(username, password, &quot;zhangsansan&quot;);</span><br><span class="line">          &#125;</span><br><span class="line">          return null;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li> 登录控制器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br></pre></td><td class="code"><pre><span class="line">package com.lx.demo.springbootshiro.web.controller;</span><br><span class="line"></span><br><span class="line">import com.lx.demo.springbootshiro.domain.User;</span><br><span class="line">import com.lx.demo.springbootshiro.service.UserService;</span><br><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.shiro.SecurityUtils;</span><br><span class="line">import org.apache.shiro.authc.*;</span><br><span class="line">import org.apache.shiro.subject.Subject;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.stereotype.Controller;</span><br><span class="line">import org.springframework.validation.BindingResult;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.PostMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.ResponseBody;</span><br><span class="line">import org.springframework.web.servlet.mvc.support.RedirectAttributes;</span><br><span class="line"></span><br><span class="line">import javax.validation.Valid;</span><br><span class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">@Controller</span><br><span class="line">public class SecurityController &#123;</span><br><span class="line"></span><br><span class="line">  @Autowired</span><br><span class="line">  private UserService userService;</span><br><span class="line"></span><br><span class="line">  @GetMapping(&quot;/login&quot;)</span><br><span class="line">  public String loginForm() &#123;</span><br><span class="line">      return &quot;login&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @GetMapping(&quot;/index&quot;)</span><br><span class="line">  public String index()&#123;</span><br><span class="line">      return &quot;index&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @PostMapping(&quot;/login&quot;)</span><br><span class="line">  public String login(@Valid User user, BindingResult bindingResult, RedirectAttributes redirectAttributes) &#123;</span><br><span class="line">      if (bindingResult.hasErrors()) &#123;</span><br><span class="line">          return &quot;login&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">      String loginName = user.getLoginName();</span><br><span class="line">      log.info(&quot;准备登陆用户 =&gt; &#123;&#125;&quot;, loginName);</span><br><span class="line">      UsernamePasswordToken token = new UsernamePasswordToken(loginName,user.getPassword());</span><br><span class="line">      //获取当前的Subject</span><br><span class="line">      Subject currentUser = SecurityUtils.getSubject();</span><br><span class="line">      try &#123;</span><br><span class="line">          //在调用了login方法后,SecurityManager会收到AuthenticationToken,并将其发送给已配置的Realm执行必须的认证检查</span><br><span class="line">          //每个Realm都能在必要时对提交的AuthenticationTokens作出反应</span><br><span class="line">          //所以这一步在调用login(token)方法时,它会走到MyRealm.doGetAuthenticationInfo()方法中,具体验证方式详见此方法</span><br><span class="line">          log.info(&quot;对用户[&quot; + loginName + &quot;]进行登录验证..验证开始&quot;);</span><br><span class="line">          currentUser.login(token);</span><br><span class="line">          log.info(&quot;对用户[&quot; + loginName + &quot;]进行登录验证..验证通过&quot;);</span><br><span class="line">      &#125; catch (UnknownAccountException uae) &#123;</span><br><span class="line">          log.info(&quot;对用户[&quot; + loginName + &quot;]进行登录验证..验证未通过,未知账户&quot;);</span><br><span class="line">          redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;未知账户&quot;);</span><br><span class="line">      &#125; catch (IncorrectCredentialsException ice) &#123;</span><br><span class="line">          log.info(&quot;对用户[&quot; + loginName + &quot;]进行登录验证..验证未通过,错误的凭证&quot;);</span><br><span class="line">          redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;密码不正确&quot;);</span><br><span class="line">      &#125; catch (LockedAccountException lae) &#123;</span><br><span class="line">          log.info(&quot;对用户[&quot; + loginName + &quot;]进行登录验证..验证未通过,账户已锁定&quot;);</span><br><span class="line">          redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;账户已锁定&quot;);</span><br><span class="line">      &#125; catch (ExcessiveAttemptsException eae) &#123;</span><br><span class="line">          log.info(&quot;对用户[&quot; + loginName + &quot;]进行登录验证..验证未通过,错误次数过多&quot;);</span><br><span class="line">          redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;用户名或密码错误次数过多&quot;);</span><br><span class="line">      &#125; catch (AuthenticationException ae) &#123;</span><br><span class="line">          //通过处理Shiro的运行时AuthenticationException就可以控制用户登录失败或密码错误时的情景</span><br><span class="line">          log.info(&quot;对用户[&quot; + loginName + &quot;]进行登录验证..验证未通过,堆栈轨迹如下&quot;);</span><br><span class="line">          ae.printStackTrace();</span><br><span class="line">          redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;用户名或密码不正确&quot;);</span><br><span class="line">      &#125;</span><br><span class="line">      //验证是否登录成功</span><br><span class="line">      if (currentUser.isAuthenticated()) &#123;</span><br><span class="line">          log.info(&quot;用户[&quot; + loginName + &quot;]登录认证通过(这里可以进行一些认证通过后的一些系统参数初始化操作)&quot;);</span><br><span class="line">          return &quot;redirect:/index&quot;;</span><br><span class="line">      &#125; else &#123;</span><br><span class="line">          token.clear();</span><br><span class="line">          return &quot;redirect:/login&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  @GetMapping(&quot;/logout&quot;)</span><br><span class="line">  public String logout(RedirectAttributes redirectAttributes) &#123;</span><br><span class="line">      //使用权限管理工具进行用户的退出，跳出登录，给出提示信息</span><br><span class="line">      SecurityUtils.getSubject().logout();</span><br><span class="line">      redirectAttributes.addFlashAttribute(&quot;message&quot;, &quot;您已安全退出&quot;);</span><br><span class="line">      return &quot;redirect:/login&quot;;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//    @GetMapping(&quot;/reg&quot;)</span><br><span class="line">//    @ResponseBody</span><br><span class="line">//    public Result&lt;String&gt; reg(@Valid User user, BindingResult bindingResult) &#123;</span><br><span class="line">//        if (bindingResult.hasErrors()) &#123;</span><br><span class="line">//            return Result.error(&quot;用户信息填写不完整&quot;);</span><br><span class="line">//        &#125;</span><br><span class="line">//        userService.save(user);</span><br><span class="line">//        return Result.ok();</span><br><span class="line">//    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li> 登录后一段时间内所有请求都可以通过</li>
</ol>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ol>
<li> 通过浏览器访问，正常登录即可</li>
<li>如果通过curl访问需要保留session信息，下次请求带入,否则需要一直校验<ul>
<li>curl -H Content-Type:application/json;charset=UTF-8 -d<br>  {&quot;loginName&quot;:&quot;zhangsan&quot;,&quot;password&quot;:&quot;11&quot;} -c mycookie -X<br>  POST <a target="_blank" rel="noopener" href="http://127.0.0.1:8080/login">http://127.0.0.1:8080/login</a></li>
<li>  curl -b mycookie -X GET <a target="_blank" rel="noopener" href="http://localhost:8080/users/all">http://localhost:8080/users/all</a></li>
</ul>
</li>
</ol>
<h1 id="集成redis-cache"><a href="#集成redis-cache" class="headerlink" title="集成redis-cache"></a>集成redis-cache</h1><h2 id="集成缓存"><a href="#集成缓存" class="headerlink" title="集成缓存"></a>集成缓存</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">  /**</span><br><span class="line">* cacheManager 缓存 redis实现</span><br><span class="line">* 使用的是shiro-redis开源插件</span><br><span class="line">*</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">public RedisCacheManager cacheManager() &#123;</span><br><span class="line">  RedisCacheManager redisCacheManager = new RedisCacheManager();</span><br><span class="line">  redisCacheManager.setRedisManager(redisManager());</span><br><span class="line">  return redisCacheManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* 配置shiro redisManager</span><br><span class="line">* 使用的是shiro-redis开源插件</span><br><span class="line">*</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">public RedisManager redisManager() &#123;</span><br><span class="line">  RedisManager redisManager = new RedisManager();</span><br><span class="line">  redisManager.setHost(&quot;localhost&quot;);</span><br><span class="line">  redisManager.setPort(6379);</span><br><span class="line">  redisManager.setExpire(1800);// 配置缓存过期时间</span><br><span class="line">  redisManager.setTimeout(0);</span><br><span class="line">  // redisManager.setPassword(password);</span><br><span class="line">  return redisManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* Session Manager</span><br><span class="line">* 使用的是shiro-redis开源插件</span><br><span class="line">*/</span><br><span class="line">@Bean</span><br><span class="line">public DefaultWebSessionManager sessionManager() &#123;</span><br><span class="line">  DefaultWebSessionManager sessionManager = new DefaultWebSessionManager();</span><br><span class="line">  sessionManager.setSessionDAO(redisSessionDAO());</span><br><span class="line">  return sessionManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* RedisSessionDAO shiro sessionDao层的实现 通过redis</span><br><span class="line">* 使用的是shiro-redis开源插件</span><br><span class="line">*/</span><br><span class="line">@Bean</span><br><span class="line">public RedisSessionDAO redisSessionDAO() &#123;</span><br><span class="line">  RedisSessionDAO redisSessionDAO = new RedisSessionDAO();</span><br><span class="line">  redisSessionDAO.setRedisManager(redisManager());</span><br><span class="line">  return redisSessionDAO;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="支持多客户端登录踢出"><a href="#支持多客户端登录踢出" class="headerlink" title="支持多客户端登录踢出"></a>支持多客户端登录踢出</h2><ol>
<li> 设置过滤器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line">package com.lx.demo.springbootshiro.filter;</span><br><span class="line"></span><br><span class="line">import com.lx.demo.springbootshiro.domain.User;</span><br><span class="line">import org.apache.shiro.cache.Cache;</span><br><span class="line">import org.apache.shiro.cache.CacheManager;</span><br><span class="line">import org.apache.shiro.session.Session;</span><br><span class="line">import org.apache.shiro.session.mgt.DefaultSessionKey;</span><br><span class="line">import org.apache.shiro.session.mgt.SessionManager;</span><br><span class="line">import org.apache.shiro.subject.Subject;</span><br><span class="line">import org.apache.shiro.web.filter.AccessControlFilter;</span><br><span class="line">import org.apache.shiro.web.util.WebUtils;</span><br><span class="line"></span><br><span class="line">import javax.servlet.ServletRequest;</span><br><span class="line">import javax.servlet.ServletResponse;</span><br><span class="line">import javax.servlet.http.HttpServletRequest;</span><br><span class="line">import java.io.IOException;</span><br><span class="line">import java.io.PrintWriter;</span><br><span class="line">import java.io.Serializable;</span><br><span class="line">import java.util.Deque;</span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.LinkedList;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* 踢出最好在chrome无痕模式下测试同一个用户, 这样可以保证每次都有新sessionid</span><br><span class="line">* 默认只允许一个用户登录在一个地方登录，　这样第二个登录后，第一个刷新页面发现被踢出</span><br><span class="line">*/</span><br><span class="line">public class KickoutSessionControlFilter extends AccessControlFilter &#123;</span><br><span class="line"></span><br><span class="line">private String kickoutUrl; //踢出后到的地址</span><br><span class="line">private boolean kickoutAfter = false; //踢出之前登录的/之后登录的用户 默认踢出之前登录的用户</span><br><span class="line">private int maxSession = 1; //同一个帐号最大会话数 默认1</span><br><span class="line"></span><br><span class="line">private SessionManager sessionManager;</span><br><span class="line">private Cache&lt;String, Deque&lt;Serializable&gt;&gt; cache;</span><br><span class="line"></span><br><span class="line">public void setKickoutUrl(String kickoutUrl) &#123;</span><br><span class="line">    this.kickoutUrl = kickoutUrl;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setKickoutAfter(boolean kickoutAfter) &#123;</span><br><span class="line">    this.kickoutAfter = kickoutAfter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setMaxSession(int maxSession) &#123;</span><br><span class="line">    this.maxSession = maxSession;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setSessionManager(SessionManager sessionManager) &#123;</span><br><span class="line">    this.sessionManager = sessionManager;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">//设置Cache的key的前缀</span><br><span class="line">public void setCacheManager(CacheManager cacheManager) &#123;</span><br><span class="line">    this.cache = cacheManager.getCache(&quot;shiro_redis_cache&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">protected boolean isAccessAllowed(ServletRequest request, ServletResponse response, Object mappedValue) throws Exception &#123;</span><br><span class="line">    return false;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">protected boolean onAccessDenied(ServletRequest request, ServletResponse response) throws Exception &#123;</span><br><span class="line">    Subject subject = getSubject(request, response);</span><br><span class="line">    if (!subject.isAuthenticated() &amp;&amp; !subject.isRemembered()) &#123;</span><br><span class="line">        //如果没有登录，直接进行之后的流程</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    Session session = subject.getSession();</span><br><span class="line">    String username = subject.getPrincipal().toString();</span><br><span class="line">    Serializable sessionId = session.getId();</span><br><span class="line"></span><br><span class="line">    //读取缓存   没有就存入</span><br><span class="line">    Deque&lt;Serializable&gt; deque = cache.get(username);</span><br><span class="line"></span><br><span class="line">    //如果此用户没有session队列，也就是还没有登录过，缓存中没有</span><br><span class="line">    //就new一个空队列，不然deque对象为空，会报空指针</span><br><span class="line">    if (deque == null) &#123;</span><br><span class="line">        deque = new LinkedList&lt;Serializable&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //如果队列里没有此sessionId，且用户没有被踢出；放入队列</span><br><span class="line">    if (!deque.contains(sessionId) &amp;&amp; session.getAttribute(&quot;kickout&quot;) == null) &#123;</span><br><span class="line">        //将sessionId存入队列</span><br><span class="line">        deque.push(sessionId);</span><br><span class="line">        //将用户的sessionId队列缓存</span><br><span class="line">        cache.put(username, deque);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //如果队列里的sessionId数超出最大会话数，开始踢人</span><br><span class="line">    while (deque.size() &gt; maxSession) &#123;</span><br><span class="line">        Serializable kickoutSessionId = null;</span><br><span class="line">        if (kickoutAfter) &#123; //如果踢出后者</span><br><span class="line">            kickoutSessionId = deque.removeFirst();</span><br><span class="line">            //踢出后再更新下缓存队列</span><br><span class="line">            cache.put(username, deque);</span><br><span class="line">        &#125; else &#123; //否则踢出前者</span><br><span class="line">            kickoutSessionId = deque.removeLast();</span><br><span class="line">            //踢出后再更新下缓存队列</span><br><span class="line">            cache.put(username, deque);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        try &#123;</span><br><span class="line">            //获取被踢出的sessionId的session对象</span><br><span class="line">            Session kickoutSession = sessionManager.getSession(new DefaultSessionKey(kickoutSessionId));</span><br><span class="line">            if (kickoutSession != null) &#123;</span><br><span class="line">                //设置会话的kickout属性表示踢出了</span><br><span class="line">                kickoutSession.setAttribute(&quot;kickout&quot;, true);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (Exception e) &#123;//ignore exception</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //如果被踢出了，直接退出，重定向到踢出后的地址</span><br><span class="line">    if (session.getAttribute(&quot;kickout&quot;) != null) &#123;</span><br><span class="line">        //会话被踢出了</span><br><span class="line">        try &#123;</span><br><span class="line">            //退出登录</span><br><span class="line">            subject.logout();</span><br><span class="line">        &#125; catch (Exception e) &#123; //ignore</span><br><span class="line">        &#125;</span><br><span class="line">        saveRequest(request);</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; resultMap = new HashMap&lt;String, String&gt;();</span><br><span class="line">        //判断是不是Ajax请求</span><br><span class="line">        if (&quot;XMLHttpRequest&quot;.equalsIgnoreCase(((HttpServletRequest) request).getHeader(&quot;X-Requested-With&quot;))) &#123;</span><br><span class="line">            resultMap.put(&quot;user_status&quot;, &quot;300&quot;);</span><br><span class="line">            resultMap.put(&quot;message&quot;, &quot;您已经在其他地方登录，请重新登录！&quot;);</span><br><span class="line">            //输出json串</span><br><span class="line">            out(response, resultMap);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            //重定向</span><br><span class="line">            WebUtils.issueRedirect(request, response, kickoutUrl);</span><br><span class="line">        &#125;</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">    return true;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void out(ServletResponse hresponse, Map&lt;String, String&gt; resultMap)</span><br><span class="line">        throws IOException &#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        hresponse.setCharacterEncoding(&quot;UTF-8&quot;);</span><br><span class="line">        PrintWriter out = hresponse.getWriter();</span><br><span class="line">//            out.println(JSON.toJSONString(resultMap));</span><br><span class="line">        out.flush();</span><br><span class="line">        out.close();</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        System.err.println(&quot;KickoutSessionFilter.class 输出JSON异常，可以忽略。&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol>
<li> 配置过滤器</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">  /**</span><br><span class="line">* 限制同一账号登录同时登录人数控制</span><br><span class="line">*</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">@Bean</span><br><span class="line">public KickoutSessionControlFilter kickoutSessionControlFilter() &#123;</span><br><span class="line">  KickoutSessionControlFilter kickoutSessionControlFilter = new KickoutSessionControlFilter();</span><br><span class="line">  kickoutSessionControlFilter.setCacheManager(cacheManager());</span><br><span class="line">  kickoutSessionControlFilter.setSessionManager(sessionManager());</span><br><span class="line">  kickoutSessionControlFilter.setKickoutAfter(false);</span><br><span class="line">  kickoutSessionControlFilter.setMaxSession(1);</span><br><span class="line">  kickoutSessionControlFilter.setKickoutUrl(&quot;/logout&quot;);</span><br><span class="line">  return kickoutSessionControlFilter;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li> springboot集成问题处理及注册</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">  /**</span><br><span class="line">* org.apache.shiro.UnavailableSecurityManagerException: No SecurityManager accessible to the calling code,</span><br><span class="line">* @return</span><br><span class="line">*/</span><br><span class="line">@Bean</span><br><span class="line">public FilterRegistrationBean delegatingFilterProxy()&#123;</span><br><span class="line">  FilterRegistrationBean filterRegistrationBean = new FilterRegistrationBean();</span><br><span class="line">  DelegatingFilterProxy proxy = new DelegatingFilterProxy();</span><br><span class="line">  proxy.setTargetFilterLifecycle(true);</span><br><span class="line">  proxy.setTargetBeanName(&quot;shiroFilter&quot;);</span><br><span class="line">  filterRegistrationBean.setFilter(proxy);</span><br><span class="line">  return filterRegistrationBean;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h2><p>通过无痕模式访问，每次变更sessionid,就被干出去了</p>
<h1 id="权限控制"><a href="#权限控制" class="headerlink" title="权限控制"></a>权限控制</h1><h2 id="注解方式"><a href="#注解方式" class="headerlink" title="注解方式"></a>注解方式</h2><p><strong>注: 处理顺序与标题顺序一致</strong></p>
<h3 id="RequiresRoles"><a href="#RequiresRoles" class="headerlink" title="RequiresRoles:"></a>RequiresRoles:</h3><p>当前Subject必须拥有所有指定的角色时，才能访问被该注解标注的方法。如果当天Subject不同时拥有所有指定角色，则方法不会执行还会抛出AuthorizationException异常。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//属于user角色</span><br><span class="line">@RequiresRoles(&quot;user&quot;)</span><br><span class="line"></span><br><span class="line">//必须同时属于user和admin角色</span><br><span class="line">@RequiresRoles(&#123;&quot;user&quot;,&quot;admin&quot;&#125;)</span><br><span class="line"></span><br><span class="line">//属于user或者admin之一;修改logical为OR 即可</span><br><span class="line">@RequiresRoles(value=&#123;&quot;user&quot;,&quot;admin&quot;&#125;,logical=Logical.OR)</span><br></pre></td></tr></table></figure>

<h3 id="RequiresPermissions"><a href="#RequiresPermissions" class="headerlink" title="RequiresPermissions:"></a>RequiresPermissions:</h3><p>当前Subject需要拥有某些特定的权限时，才能执行被该注解标注的方法。如果当前Subject不具有这样的权限，则方法不会被执行。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">//符合index:hello权限要求</span><br><span class="line">@RequiresPermissions(&quot;index:hello&quot;)</span><br><span class="line"></span><br><span class="line">//必须同时复核index:hello和index:world权限要求</span><br><span class="line">@RequiresPermissions(&#123;&quot;index:hello&quot;,&quot;index:world&quot;&#125;)</span><br><span class="line"></span><br><span class="line">//符合index:hello或index:world权限要求即可</span><br><span class="line">@RequiresPermissions(value=&#123;&quot;index:hello&quot;,&quot;index:world&quot;&#125;,logical=Logical.OR)</span><br></pre></td></tr></table></figure>

<h3 id="RequiresAuthentication"><a href="#RequiresAuthentication" class="headerlink" title="RequiresAuthentication:"></a>RequiresAuthentication:</h3><p>使用该注解标注的类，实例，方法在访问或调用时，当前Subject必须在当前session中已经过认证。</p>
<h3 id="RequiresUser"><a href="#RequiresUser" class="headerlink" title="RequiresUser"></a>RequiresUser</h3><p>当前Subject必须是应用的用户，才能访问或调用被该注解标注的类，实例，方法。</p>
<h3 id="RequiresGuest"><a href="#RequiresGuest" class="headerlink" title="RequiresGuest:"></a>RequiresGuest:</h3><p>使用该注解标注的类，实例，方法在访问或调用时，当前Subject可以是”gust”身份，不需要经过认证或者在原先的session中存在记录。</p>
<h2 id="动态权限控制"><a href="#动态权限控制" class="headerlink" title="动态权限控制"></a>动态权限控制</h2><p><strong>这里要特别注意/**的控制，必须放最后，否则后续的权限可能不起作用</strong></p>
<ol>
<li> 增加权限控制类</li>
</ol>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">import lombok.extern.slf4j.Slf4j;</span><br><span class="line">import org.apache.shiro.spring.web.ShiroFilterFactoryBean;</span><br><span class="line">import org.apache.shiro.web.filter.mgt.DefaultFilterChainManager;</span><br><span class="line">import org.apache.shiro.web.filter.mgt.PathMatchingFilterChainResolver;</span><br><span class="line">import org.apache.shiro.web.servlet.AbstractShiroFilter;</span><br><span class="line">import org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line">import org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line">import org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line">import java.util.HashMap;</span><br><span class="line">import java.util.Map;</span><br><span class="line"></span><br><span class="line">@Slf4j</span><br><span class="line">@RestController</span><br><span class="line">@RequestMapping(value = &quot;/filter&quot;)</span><br><span class="line">public class FilterManageController &#123;</span><br><span class="line"></span><br><span class="line">//加载自定义的拦截工厂</span><br><span class="line">@Autowired</span><br><span class="line">private ShiroFilterFactoryBean myShiroFilterFactoryBean;</span><br><span class="line"></span><br><span class="line">@GetMapping(&quot;/all&quot;)</span><br><span class="line">public Map&lt;String, String&gt; findAll() &#123;</span><br><span class="line">    return myShiroFilterFactoryBean.getFilterChainDefinitionMap();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@GetMapping(value = &quot;/add&quot;)</span><br><span class="line">public Map&lt;String, String&gt; addFilter() &#123;</span><br><span class="line">    Map&lt;String, String&gt; filterMap = new HashMap&lt;&gt;();</span><br><span class="line">    filterMap.put(&quot;/user/login**&quot;, &quot;anon&quot;);</span><br><span class="line">    filterMap.put(&quot;/admin/**&quot;, &quot;anon&quot;);//把 admin 设置成不需要拦截</span><br><span class="line">    filterMap.put(&quot;/super/**&quot;, &quot;authc,roles[super],perms[super:info]&quot;);</span><br><span class="line">    //管理员才可以操做</span><br><span class="line">    filterMap.put(&quot;/users/**&quot;, &quot;authc,roles[user]&quot;);</span><br><span class="line">    filterMap.put(&quot;/**&quot;, &quot;authc,kickout&quot;);</span><br><span class="line">    addAndUpdatePermission(filterMap);</span><br><span class="line"></span><br><span class="line">    return myShiroFilterFactoryBean.getFilterChainDefinitionMap();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">  * 动态更新新的权限, 更新原权限，增加新权限</span><br><span class="line">  *</span><br><span class="line">  * @param filterMap</span><br><span class="line">  */</span><br><span class="line">private synchronized void addAndUpdatePermission(Map&lt;String, String&gt; filterMap) &#123;</span><br><span class="line"></span><br><span class="line">    AbstractShiroFilter shiroFilter = null;</span><br><span class="line">    try &#123;</span><br><span class="line">        shiroFilter = (AbstractShiroFilter) myShiroFilterFactoryBean.getObject();</span><br><span class="line"></span><br><span class="line">        // 获取过滤管理器</span><br><span class="line">        PathMatchingFilterChainResolver filterChainResolver = (PathMatchingFilterChainResolver) shiroFilter</span><br><span class="line">                .getFilterChainResolver();</span><br><span class="line">        DefaultFilterChainManager filterManager =</span><br><span class="line">                (DefaultFilterChainManager) filterChainResolver.getFilterChainManager();</span><br><span class="line"></span><br><span class="line">        //清空拦截管理器中的存储</span><br><span class="line">        filterManager.getFilterChains().clear();</span><br><span class="line">        /*</span><br><span class="line">        清空拦截工厂中的存储,如果不清空这里,还会把之前的带进去</span><br><span class="line">        ps:如果仅仅是更新的话,可以根据这里的 map 遍历数据修改,重新整理好权限再一起添加</span><br><span class="line">          */</span><br><span class="line">//            myShiroFilterFactoryBean.getFilterChainDefinitionMap().clear();</span><br><span class="line"></span><br><span class="line">        Map&lt;String, String&gt; chains = myShiroFilterFactoryBean.getFilterChainDefinitionMap();</span><br><span class="line">        chains.remove(&quot;/**&quot;);</span><br><span class="line">        //把修改后的 map 放进去</span><br><span class="line">        filterMap.entrySet().forEach(fm -&gt; &#123;</span><br><span class="line">            chains.putIfAbsent(fm.getKey(), fm.getValue());</span><br><span class="line">        &#125;);</span><br><span class="line">//            chains.putAll(filterMap);</span><br><span class="line"></span><br><span class="line">        //这个相当于是全量添加</span><br><span class="line">        for (Map.Entry&lt;String, String&gt; entry : chains.entrySet()) &#123;</span><br><span class="line">            //要拦截的地址</span><br><span class="line">            String url = entry.getKey().trim().replace(&quot; &quot;, &quot;&quot;);</span><br><span class="line">            //地址持有的权限</span><br><span class="line">            String chainDefinition = entry.getValue().trim().replace(&quot; &quot;, &quot;&quot;);</span><br><span class="line">            //生成拦截</span><br><span class="line">            filterManager.createChain(url, chainDefinition);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; catch (Exception e) &#123;</span><br><span class="line">        log.error(&quot;updatePermission error,filterMap=&quot; + filterMap, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ol>
<li> 测试 修改前可直接删除用户, 修改权限后，删除用户的角色必须是user</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><ol>
<li> <a target="_blank" rel="noopener" href="https://blog.csdn.net/fu_fei_wen/article/details/77571989">https://blog.csdn.net/fu_fei_wen/article/details/77571989</a></li>
<li> <a target="_blank" rel="noopener" href="https://waylau.gitbooks.io/apache-shiro-1-2-x-reference/content/">https://waylau.gitbooks.io/apache-shiro-1-2-x-reference/content/</a></li>
</ol>
<h1 id="代码路径"><a href="#代码路径" class="headerlink" title="代码路径"></a>代码路径</h1><ul>
<li>  <a target="_blank" rel="noopener" href="https://github.com/microzhao/demo/tree/master/springboot/springboot-shiro">https://github.com/microzhao/demo/tree/master/springboot/springboot-shiro</a></li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2019/08/11/springboot+rabbitmq%E5%AE%9E%E6%88%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/11/springboot+rabbitmq%E5%AE%9E%E6%88%98/" class="post-title-link" itemprop="url">springboot+rabbitmq实战</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2019-08-11 00:00:00" itemprop="dateCreated datePublished" datetime="2019-08-11T00:00:00+08:00">2019-08-11</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="archlinux-安装启动"><a href="#archlinux-安装启动" class="headerlink" title="archlinux 安装启动"></a>archlinux 安装启动</h2><ul>
<li>  yaourt -S rabbitmq</li>
<li>  systemctl start rabbitmq.service</li>
<li>测试服务启动<ul>
<li>  rabbitmqctl status</li>
</ul>
</li>
<li>安装管理客户端<ul>
<li>  rabbitmq-plugins enable rabbitmq<del>management</del></li>
<li>  web访问地址 <a target="_blank" rel="noopener" href="http://127.0.0.1:15672/">http://127.0.0.1:15672</a></li>
</ul>
</li>
</ul>
<h2 id="centos-阿里ecs"><a href="#centos-阿里ecs" class="headerlink" title="centos(阿里ecs)"></a>centos(阿里ecs)</h2><ul>
<li>  yaourt -S rabbitmq-server</li>
<li>  systemctl start rabbitmq-server.service</li>
<li>  测试服务启动</li>
<li>安装管理客户端<ul>
<li>  rabbitmq-plugins enable rabbitmq<del>management</del></li>
<li>  web访问地址 <a target="_blank" rel="noopener" href="http://47.75.36.192:15672/">http://47.75.36.192:15672</a></li>
</ul>
</li>
<li>  参考: <a target="_blank" rel="noopener" href="https://www.rabbitmq.com/install-rpm.html">https://www.rabbitmq.com/install-rpm.html</a></li>
</ul>
<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><h2 id="增加用户并授权"><a href="#增加用户并授权" class="headerlink" title="增加用户并授权"></a>增加用户并授权</h2><ol>
<li> rabbitmqctl add<del>user</del> admin 123456 # 增加用户并设置用户名密码</li>
<li> rabbitmqctl set<del>usertags</del> admin administrator # 授权</li>
<li>rabbitmqctl set<del>permissions</del> -p / admin &#39;.*&#39; &#39;.*&#39; &#39;.*&#39; #<br> 不知道干啥的但是需要不然访问不了</li>
</ol>
<h1 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h1><h1 id="相关概念"><a href="#相关概念" class="headerlink" title="相关概念"></a>相关概念</h1><p>通常我们谈到队列服务, 会有三个概念： 发消息者、队列、收消息者，RabbitMQ<br>在这个基本概念之上, 多做了一层抽象, 在发消息者和 队列之间, 加入了交换器<br>(Exchange). 这样发消息者和队列就没有直接联系,<br>转而变成发消息者把消息给交换器, 交换器根据调度策略再把消息再给队列。</p>
<h2 id="虚拟主机"><a href="#虚拟主机" class="headerlink" title="虚拟主机"></a>虚拟主机</h2><p>一个虚拟主机持有一组交换机、队列和绑定。为什么需要多个虚拟主机呢？很简单，<br>RabbitMQ 当中，用户只能在虚拟主机的粒度进行权限控制。<br>因此，如果需要禁止A组访问B组的交换机/队列/绑定，必须为A和B分别创建一个虚拟主机。每一个<br>RabbitMQ 服务器都有一个默认的虚拟主机”/“。</p>
<h2 id="交换机-Exchange"><a href="#交换机-Exchange" class="headerlink" title="交换机(Exchange)"></a>交换机(Exchange)</h2><p>交换机的功能主要是接收消息并且转发到绑定的队列，交换机不存储消息，在启用ack模式后，交换机找不到队列会返回错误。交换机有四种类型：Direct,<br>topic, Headers and Fanout Direct：direct 类型的行为是”先匹配, 再投送”.<br>即在绑定时设定一个 routing<del>key</del>, 消息的routing<del>key</del> 匹配时,<br>才会被交换器投送到绑定的队列中去，　默认方式<br>Topic：按规则转发消息（最灵活）, 主要通过通配符 Headers：设置 header<br>attribute 参数类型的交换机 Fanout：转发消息到所有绑定队列</p>
<h1 id="springboot整合"><a href="#springboot整合" class="headerlink" title="springboot整合"></a>springboot整合</h1><h2 id="redirexchange-默认"><a href="#redirexchange-默认" class="headerlink" title="redirexchange 默认"></a>redirexchange 默认</h2><ol>
<li><p>引入依赖</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;spring-boot-starter-amqp&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure>
</li>
<li><p>配置rabbit地址, application.yaml</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">spring:</span><br><span class="line">  rabbitmq:</span><br><span class="line">    host: localhost</span><br><span class="line">    password: guest</span><br><span class="line">    port: 5672</span><br><span class="line">    username: guest</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>增加queue配置</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">public class RabbitConfig &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 创建一个叫hello的queue</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    @Bean</span><br><span class="line">    public Queue queue()&#123;</span><br><span class="line">        return new Queue(&quot;ttang&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>producer</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public class RabbitProducer &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    public void sendMsgString()&#123;</span><br><span class="line">        String context = &quot;ttang say: &quot; + new Date();</span><br><span class="line">        log.info(context);</span><br><span class="line">        rabbitTemplate.convertAndSend(&quot;ttang&quot;, context);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public void sendMsgInt(int i)&#123;</span><br><span class="line">        log.info(&quot;&#123;&#125;, &#123;&#125;&quot;, Thread.currentThread().getStackTrace()[1].getMethodName(), i);</span><br><span class="line">        rabbitTemplate.convertAndSend(&quot;ttang&quot;, i);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>consumer</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">*</span><br><span class="line">* 接收消息</span><br><span class="line">*</span><br><span class="line">*/</span><br><span class="line">@Component</span><br><span class="line">@RabbitListener(queues = &quot;ttang&quot;)</span><br><span class="line">@Slf4j</span><br><span class="line">public class RabbitConsumer &#123;</span><br><span class="line"></span><br><span class="line">    @RabbitHandler</span><br><span class="line">    public void receiveMsgString(String tt)&#123;</span><br><span class="line">        log.info(&quot;收到ttang消息, &#123;&#125;&quot;, tt);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * Caused by: org.springframework.amqp.AmqpException: Ambiguous methods for payload type: class java.lang.String:</span><br><span class="line">    * msg and msg2</span><br><span class="line">    * 1. 不能有两个payload同时匹配, 会根据消息类型自动匹配</span><br><span class="line">    * @param tt</span><br><span class="line">    */</span><br><span class="line">    @RabbitHandler</span><br><span class="line">    public void receiveMsgInt(Integer tt)&#123;</span><br><span class="line">        log.info(&quot;收到ttang消息2, &#123;&#125;&quot;, tt);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>test</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class RabbitConsumerTest &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RabbitProducer producer;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void msg() &#123;</span><br><span class="line">//        final ExecutorService fixedThreadPool = Executors.newFixedThreadPool(5);</span><br><span class="line">//        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">//            fixedThreadPool.execute(() -&gt; &#123;</span><br><span class="line">//                producer.sendMsgString();</span><br><span class="line">//            &#125;);</span><br><span class="line">//        &#125;</span><br><span class="line"></span><br><span class="line">        for (int i = 0; i &lt; 10; i++) &#123;</span><br><span class="line">            producer.sendMsgInt(i);</span><br><span class="line">            producer.sendMsgString();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="topicexchange-模式匹配订阅"><a href="#topicexchange-模式匹配订阅" class="headerlink" title="topicexchange 模式匹配订阅"></a>topicexchange 模式匹配订阅</h2><p>依赖、地址同上</p>
<ol>
<li><p>queue,exchange配置,　配置路由规则</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 需要三个bean实例 queue, exchange, bindexchange</span><br><span class="line">*</span><br><span class="line">* queue1比queue2只有一个字母之差，模拟匹配</span><br><span class="line">*/</span><br><span class="line">@Configuration</span><br><span class="line">public class TopicExchangeConfig &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 定制主题</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    @Bean</span><br><span class="line">    public TopicExchange topicExchange()&#123;</span><br><span class="line">        return new TopicExchange(&quot;topicExchange&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Queue queueMessage()&#123;</span><br><span class="line">        return new Queue(&quot;topic.message&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 精确匹配topic.message</span><br><span class="line">    * @param queueMessage</span><br><span class="line">    * @param topicExchange</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    @Bean</span><br><span class="line">    Binding bindingMessage(Queue queueMessage, TopicExchange topicExchange)&#123;</span><br><span class="line">        return BindingBuilder.bind(queueMessage).to(topicExchange).with(&quot;topic.message&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Bean</span><br><span class="line">    public Queue queueMessages()&#123;</span><br><span class="line">        return new Queue(&quot;topic.messages&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 匹配多个</span><br><span class="line">    * *表示一个词.</span><br><span class="line">    * #表示零个或多个词.</span><br><span class="line">    *</span><br><span class="line">    * 这个queue能接收多个消息</span><br><span class="line">    * @param queueMessages</span><br><span class="line">    * @param topicExchange</span><br><span class="line">    * @return</span><br><span class="line">    */</span><br><span class="line">    @Bean</span><br><span class="line">    Binding bindingMessages(Queue queueMessages, TopicExchange topicExchange)&#123;</span><br><span class="line">        return BindingBuilder.bind(queueMessages).to(topicExchange).with(&quot;topic.#&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>生产者</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public class TopicExchangeProducer &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 同时匹配 topic.message和 topic.# 所以会发到这两个queue里</span><br><span class="line">    * @param msg</span><br><span class="line">    */</span><br><span class="line">    public void sendMessage(String msg)&#123;</span><br><span class="line">        final StackTraceElement element = Thread.currentThread().getStackTrace()[1];</span><br><span class="line">        log.info(&quot;&#123;&#125;, &#123;&#125;&quot;, element.getMethodName(), msg);</span><br><span class="line">        rabbitTemplate.convertAndSend(&quot;topicExchange&quot;, &quot;topic.message&quot;</span><br><span class="line">                , String.join(&quot;,&quot;, Arrays.asList(element.getClassName(), element.getMethodName(), msg)));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 只能匹配到topic.#, 多了个s, 所以只会匹配发送到 queuemessages</span><br><span class="line">    * BindingBuilder.bind(queueMessages).to(topicExchange).with(&quot;topic.#&quot;);</span><br><span class="line">    * 相应的接收也只会是topic.messages</span><br><span class="line">    * @param msg</span><br><span class="line">    */</span><br><span class="line">    public void sendMessages(String msg)&#123;</span><br><span class="line">        final StackTraceElement element = Thread.currentThread().getStackTrace()[1];</span><br><span class="line">        log.info(&quot;&#123;&#125;, &#123;&#125;&quot;, element.getMethodName(), msg);</span><br><span class="line">        rabbitTemplate.convertAndSend(&quot;topicExchange&quot;, &quot;topic.messages&quot;</span><br><span class="line">                , String.join(&quot;,&quot;, Arrays.asList(element.getClassName(), element.getMethodName(), msg)));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>消费者</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 监听topic.message</span><br><span class="line">*/</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">@RabbitListener(queues = &quot;topic.message&quot;)</span><br><span class="line">public class TopicConsumerMessage &#123;</span><br><span class="line"></span><br><span class="line">  @RabbitHandler</span><br><span class="line">  public void receiveMsgString(String msg)&#123;</span><br><span class="line">      final StackTraceElement element = Thread.currentThread().getStackTrace()[1];</span><br><span class="line">      log.info(&quot;&#123;&#125;, &#123;&#125;&quot;, element.getMethodName(), msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">* 监听topic.message</span><br><span class="line">*/</span><br><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">@RabbitListener(queues = &quot;topic.messages&quot;)</span><br><span class="line">public class TopicConsumerMessages &#123;</span><br><span class="line"></span><br><span class="line">  @RabbitHandler</span><br><span class="line">  public void receiveMsgString(String msg)&#123;</span><br><span class="line">      final StackTraceElement element = Thread.currentThread().getStackTrace()[1];</span><br><span class="line">      log.info(&quot;&#123;&#125;, &#123;&#125;&quot;, element.getMethodName(), msg);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class TopicExchangeProducerTest &#123;</span><br><span class="line"></span><br><span class="line">  @Autowired</span><br><span class="line">  private TopicExchangeProducer topicExchangeProducer;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * 2019-08-11 12:54:46.482  INFO 18374 --- [           main] c.l.d.s.t.p.TopicExchangeProducer        :</span><br><span class="line">  * sendMessage, 我爱你　糖糖</span><br><span class="line">  * &lt;p&gt;</span><br><span class="line">  * &lt;p&gt;</span><br><span class="line">  * 2019-08-11 12:54:46.502  INFO 18374 --- [ntContainer#2-1] c.l.d.s.t.c.TopicConsumerMessages        :</span><br><span class="line">  * receiveMsgString, com.lx.demo.springbootrabbitmq.tpcexchange.producer.TopicExchangeProducer,sendMessage,我爱你　糖糖</span><br><span class="line">  * 2019-08-11 12:54:46.503  INFO 18374 --- [ntContainer#1-1] c.l.d.s.t.consumer.TopicConsumerMessage  :</span><br><span class="line">  * receiveMsgString, com.lx.demo.springbootrabbitmq.tpcexchange.producer.TopicExchangeProducer,sendMessage,我爱你　糖糖</span><br><span class="line">  * 这里producer发送用的routing_key topic.message匹配topic.message和topic.#, 所以可以干到两个queue里, 相应的消费两个queue的都能接收到</span><br><span class="line">  */</span><br><span class="line">  @Test</span><br><span class="line">  public void sendMessage() &#123;</span><br><span class="line">      topicExchangeProducer.sendMessage(&quot;我爱你　糖糖&quot;);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  /**</span><br><span class="line">  * 2019-08-11 12:57:00.110  INFO 18687 --- [           main] c.l.d.s.t.p.TopicExchangeProducer        :</span><br><span class="line">  * sendMessages, i love you, ttang</span><br><span class="line">  * &lt;p&gt;</span><br><span class="line">  * &lt;p&gt;</span><br><span class="line">  * 2019-08-11 12:57:00.128  INFO 18687 --- [       Thread-2] o.s.a.r.l.SimpleMessageListenerContainer : Waiting</span><br><span class="line">  * for workers to finish.</span><br><span class="line">  * 2019-08-11 12:57:00.128  INFO 18687 --- [ntContainer#2-1] c.l.d.s.t.c.TopicConsumerMessages        :</span><br><span class="line">  * receiveMsgString, com.lx.demo.springbootrabbitmq.tpcexchange.producer.TopicExchangeProducer,sendMessages,i</span><br><span class="line">  * love you, ttang</span><br><span class="line">  * messages的消息发送者用的routing_key只能匹配topic.#, 所以只能到topic.messages这个queue</span><br><span class="line">  */</span><br><span class="line">  @Test</span><br><span class="line">  public void sendMessages() &#123;</span><br><span class="line">      topicExchangeProducer.sendMessages(&quot;i love you, ttang&quot;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="fanoutexchange-发布订阅"><a href="#fanoutexchange-发布订阅" class="headerlink" title="fanoutexchange 发布订阅"></a>fanoutexchange 发布订阅</h2><p>依赖、地址同上</p>
<ol>
<li><p>queue配置</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">* 定义多个queue, 一个Fanoutexchange, 配置绑定binding</span><br><span class="line">* 这样发送到交换机上的消息都会传递到所有绑定queue</span><br><span class="line">*</span><br><span class="line">* 这个最像传统的主题订阅模式</span><br><span class="line">*/</span><br><span class="line">@Configuration</span><br><span class="line">public class FanoutExchangeConfig &#123;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">  * 创建交换机</span><br><span class="line">  * @return</span><br><span class="line">  */</span><br><span class="line">@Bean</span><br><span class="line">FanoutExchange fanoutExchange()&#123;</span><br><span class="line">    return new FanoutExchange(&quot;fanoutExchange&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">  * 创建queue</span><br><span class="line">  * @return</span><br><span class="line">  */</span><br><span class="line">@Bean</span><br><span class="line">Queue fanoutQueue1()&#123;</span><br><span class="line">    return new Queue(&quot;fanout.1&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">  * 这里不在需要指定binding_key, 就算配了也么得用</span><br><span class="line">  * @param fanoutQueue1</span><br><span class="line">  * @param fanoutExchange</span><br><span class="line">  * @return</span><br><span class="line">  */</span><br><span class="line">@Bean</span><br><span class="line">Binding binding1(Queue fanoutQueue1, FanoutExchange fanoutExchange)&#123;</span><br><span class="line">    return BindingBuilder.bind(fanoutQueue1).to(fanoutExchange);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">Queue fanoutQueue2()&#123;</span><br><span class="line">    return new Queue(&quot;fanout.2&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">Binding binding2(Queue fanoutQueue2, FanoutExchange fanoutExchange)&#123;</span><br><span class="line">    return BindingBuilder.bind(fanoutQueue2).to(fanoutExchange);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Bean</span><br><span class="line">Queue fanoutQueue3()&#123;</span><br><span class="line">    return new Queue(&quot;fanout.3&quot;);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">/**</span><br><span class="line">  * Description:</span><br><span class="line">  *</span><br><span class="line">  * Parameter 0 of method binding1 in com.lx.demo.springbootrabbitmq.fanoutexchange.config.FanoutExchangeConfig</span><br><span class="line">  * required a single bean, but 6 were found:</span><br><span class="line">  * 	- queue: defined by method &#x27;queue&#x27; in class path resource</span><br><span class="line">  * 	[com/lx/demo/springbootrabbitmq/direxchange/config/RabbitConfig.class]</span><br><span class="line">  * 	- fanoutQueue1: defined by method &#x27;fanoutQueue1&#x27; in class path resource</span><br><span class="line">  * 	[com/lx/demo/springbootrabbitmq/fanoutexchange/config/FanoutExchangeConfig.class]</span><br><span class="line">  * 	- fanoutQueue2: defined by method &#x27;fanoutQueue2&#x27; in class path resource</span><br><span class="line">  * 	[com/lx/demo/springbootrabbitmq/fanoutexchange/config/FanoutExchangeConfig.class]</span><br><span class="line">  * 	- fanoutQueue3: defined by method &#x27;fanoutQueue3&#x27; in class path resource</span><br><span class="line">  * 	[com/lx/demo/springbootrabbitmq/fanoutexchange/config/FanoutExchangeConfig.class]</span><br><span class="line">  * 	- queueMessage: defined by method &#x27;queueMessage&#x27; in class path resource</span><br><span class="line">  * 	[com/lx/demo/springbootrabbitmq/tpcexchange/config/TopicExchangeConfig.class]</span><br><span class="line">  * 	- queueMessages: defined by method &#x27;queueMessages&#x27; in class path resource</span><br><span class="line">  * 	[com/lx/demo/springbootrabbitmq/tpcexchange/config/TopicExchangeConfig.class]</span><br><span class="line">  *</span><br><span class="line">  * @param fanoutQueue3</span><br><span class="line">  * @param fanoutExchange</span><br><span class="line">  * @return</span><br><span class="line">  */</span><br><span class="line">@Bean</span><br><span class="line">Binding binding3(Queue fanoutQueue3, FanoutExchange fanoutExchange)&#123;</span><br><span class="line">    return BindingBuilder.bind(fanoutQueue3).to(fanoutExchange);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>生产者</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Component</span><br><span class="line">@Slf4j</span><br><span class="line">public class FanoutExchangeProducer &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private RabbitTemplate rabbitTemplate;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * fanout的方式不再需要routing-key</span><br><span class="line">    * @param msg</span><br><span class="line">    */</span><br><span class="line">    public void sendMsg(String msg)&#123;</span><br><span class="line">        log.info(&quot;&#123;&#125;, &#123;&#125;&quot;, Thread.currentThread().getStackTrace()[1].getMethodName(), msg);</span><br><span class="line">        // 这里一定要注意函数重载，只有三个参数时，第一个才是exchange</span><br><span class="line">        rabbitTemplate.convertAndSend(&quot;fanoutExchange&quot;,&quot;&quot;, msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p> <strong>注意，　发送时是三个参数</strong></p>
</li>
<li><p>消费者</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">@Slf4j</span><br><span class="line">@Component</span><br><span class="line">@RabbitListener(queues = &quot;fanout.1&quot;)</span><br><span class="line">public class FanoutConsumer1 &#123;</span><br><span class="line"></span><br><span class="line">    @RabbitHandler</span><br><span class="line">    public void receiveMessageString(String msg)&#123;</span><br><span class="line">        log.info(&quot;&#123;&#125;, &#123;&#125;&quot;, Thread.currentThread().getStackTrace()[1].getMethodName(), msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
</li>
<li><p>测试</p>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">@RunWith(SpringRunner.class)</span><br><span class="line">@SpringBootTest</span><br><span class="line">public class FanoutExchangeProducerTest &#123;</span><br><span class="line"></span><br><span class="line">    @Autowired</span><br><span class="line">    private FanoutExchangeProducer fanoutExchangeProducer;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">    * 2019-08-11 13:48:16.402  INFO 26183 --- [           main] c.l.d.s.f.p.FanoutExchangeProducer       : sendMsg,</span><br><span class="line">    * 大渣吼，我是范二特</span><br><span class="line">    *</span><br><span class="line">    *</span><br><span class="line">    * 2019-08-11 13:48:16.425  INFO 26183 --- [ntContainer#2-1] c.l.d.s.f.consumer.FanoutConsumer2       :</span><br><span class="line">    * receiveMessageString, 大渣吼，我是范二特</span><br><span class="line">    * 2019-08-11 13:48:16.425  INFO 26183 --- [ntContainer#1-1] c.l.d.s.f.consumer.FanoutConsumer1       :</span><br><span class="line">    * receiveMessageString, 大渣吼，我是范二特</span><br><span class="line">    * 2019-08-11 13:48:16.425  INFO 26183 --- [ntContainer#3-1] c.l.d.s.f.consumer.FanoutConsumer3       :</span><br><span class="line">    * receiveMessageString, 大渣吼，我是范二特</span><br><span class="line">    *</span><br><span class="line">    * 发送一条消息，上述三个消费者都收到了消息</span><br><span class="line">    */</span><br><span class="line">    @Test</span><br><span class="line">    public void sendMsg() &#123;</span><br><span class="line">        fanoutExchangeProducer.sendMsg(&quot;大渣吼，我是范二特&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="完整代码"><a href="#完整代码" class="headerlink" title="完整代码"></a>完整代码</h2><p><a target="_blank" rel="noopener" href="https://github.com/microzhao/demo/tree/master/springboot/springboot-rabbitmq">https://github.com/microzhao/demo/tree/master/springboot/springboot-rabbitmq</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="上一页"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mr.zhao"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Mr.zhao</p>
  <div class="site-description" itemprop="description">show me your code</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">86</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhaozhiwei1992" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhaozhiwei1992" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/p205/posts" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;p205&#x2F;posts" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/65f51bc73109" title="简书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;65f51bc73109" rel="noopener" target="_blank"><i class="fas fa-book-open fa-fw"></i>简书</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/qq347061329" title="博客园 → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;qq347061329" rel="noopener" target="_blank"><i class="fab fa-blog fa-fw"></i>博客园</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/u012768510" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;u012768510" rel="noopener" target="_blank"><i class="fas fa-code fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhaozhiweishanxi@gmail.com" title="E-Mail → mailto:zhaozhiweishanxi@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.zhao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
