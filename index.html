<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.2">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"zhaozhiwei1992.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="show me your code">
<meta property="og:type" content="website">
<meta property="og:title" content="离线de日常">
<meta property="og:url" content="http://zhaozhiwei1992.github.io/index.html">
<meta property="og:site_name" content="离线de日常">
<meta property="og:description" content="show me your code">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mr.zhao">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://zhaozhiwei1992.github.io/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>离线de日常</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">离线de日常</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/07/19/RooCode%E7%BB%93%E5%90%88NacosMCP%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/07/19/RooCode%E7%BB%93%E5%90%88NacosMCP%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">RooCode结合NacosMCP实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-07-19 08:00:00" itemprop="dateCreated datePublished" datetime="2025-07-19T08:00:00+08:00">2025-07-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>分别使用java和python实现mcp server并注册到nacos中，并通过roo code使用。</p>
<h1 id="使用docker-compose安装nacos"><a href="#使用docker-compose安装nacos" class="headerlink" title="使用docker-compose安装nacos"></a>使用docker-compose安装nacos</h1><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>3.0+版本以上的nacos需要配置NACOS_AUTH_IDENTITY_KEY等，参考官方手册配置即可</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nacos:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nacos/nacos-server:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nacos-standalone</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">PREFER_HOST_MODE=hostname</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">MODE=standalone</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NACOS_AUTH_IDENTITY_KEY=serverIdentity</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NACOS_AUTH_IDENTITY_VALUE=security</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">NACOS_AUTH_TOKEN=VGhpc0lzTXlDdXN0b21TZWNyZXRLZXkwMTIzNDU2Nzg=</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./standalone-logs/:/home/nacos/logs</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./init.d/custom.properties:/home/nacos/init.d/custom.properties</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8080:8080&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8848:8848&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;9848:9848&quot;</span></span><br></pre></td></tr></table></figure>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight plaintext"><figcaption><span>org-language</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h1 id="使用-Spring-AI-Alibaba-Nacos-MCP-框架开发-MCP-Server"><a href="#使用-Spring-AI-Alibaba-Nacos-MCP-框架开发-MCP-Server" class="headerlink" title="使用 Spring AI Alibaba Nacos MCP 框架开发 MCP Server"></a>使用 Spring AI Alibaba Nacos MCP 框架开发 MCP Server</h1><h2 id="依赖引入"><a href="#依赖引入" class="headerlink" title="依赖引入"></a>依赖引入</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.alibaba.cloud.ai&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-ai-alibaba-starter-nacos-mcp-server&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0.1&lt;/version&gt;</span><br><span class="line">    &lt;exclusions&gt;</span><br><span class="line">        &lt;exclusion&gt;</span><br><span class="line">            &lt;artifactId&gt;commons-logging&lt;/artifactId&gt;</span><br><span class="line">            &lt;groupId&gt;commons-logging&lt;/groupId&gt;</span><br><span class="line">        &lt;/exclusion&gt;</span><br><span class="line">    &lt;/exclusions&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- MCP Server (WebMVC) --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.ai&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-ai-starter-mcp-server-webmvc&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.0-RC1&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;ch.qos.logback&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;logback-classic&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.5.18&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="服务定义"><a href="#服务定义" class="headerlink" title="服务定义"></a>服务定义</h2><p>实现一个获取天气信息的tool</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.ai.tool.annotation.Tool;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.tool.annotation.ToolParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WeatherService</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Tool(description = &quot;Get weather information by city name&quot;)</span></span><br><span class="line">  <span class="keyword">public</span> String <span class="title function_">getWeather</span><span class="params">(<span class="meta">@ToolParam(description = &quot;City name&quot;)</span> String cityName)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;Sunny in &quot;</span> + cityName;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自动注册参数配置"><a href="#自动注册参数配置" class="headerlink" title="自动注册参数配置"></a>自动注册参数配置</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">application:</span></span><br><span class="line">    <span class="attr">name:</span> <span class="string">springboot-nacos-mcp</span></span><br><span class="line">  <span class="attr">ai:</span></span><br><span class="line">    <span class="attr">mcp:</span></span><br><span class="line">      <span class="attr">server:</span></span><br><span class="line">        <span class="attr">name:</span> <span class="string">webmvc-mcp-server</span>   <span class="comment"># MCP服务名称</span></span><br><span class="line">        <span class="attr">version:</span> <span class="number">1.0</span><span class="number">.0</span>            <span class="comment"># 服务版本</span></span><br><span class="line">        <span class="attr">type:</span> <span class="string">SYNC</span>                <span class="comment"># 调用类型：SYNC（同步）或ASYNC（异步）</span></span><br><span class="line">    <span class="attr">alibaba:</span></span><br><span class="line">      <span class="attr">mcp:</span></span><br><span class="line">        <span class="attr">nacos:</span></span><br><span class="line">          <span class="attr">server-addr:</span> <span class="string">localhost:8848</span>         <span class="comment"># 替换为你的 Nacos 地址</span></span><br><span class="line">          <span class="attr">namespace:</span> <span class="string">public</span>    <span class="comment"># Nacos 命名空间 ID（默认为public）</span></span><br><span class="line">          <span class="attr">username:</span> <span class="string">nacos</span>          <span class="comment"># 开源控制台用户名</span></span><br><span class="line">          <span class="attr">password:</span> <span class="string">nacos</span>          <span class="comment"># 开源控制台密码</span></span><br><span class="line">          <span class="attr">registry:</span></span><br><span class="line">            <span class="attr">enabled:</span> <span class="literal">true</span>   <span class="comment"># 是否开启服务注册</span></span><br></pre></td></tr></table></figure>

<h2 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">  <span class="keyword">import</span> com.example.demo.service.WeatherService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.tool.ToolCallbackProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.ai.tool.method.MethodToolCallbackProvider;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.SpringApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Title</span>: Application</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Package</span> com/example/demo/Application.java</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: </span></span><br><span class="line"><span class="comment"> *     &quot;webmvc-mcp-server&quot;: &#123;</span></span><br><span class="line"><span class="comment"> *       &quot;url&quot;: &quot;http://localhost:8081/sse&quot;,</span></span><br><span class="line"><span class="comment"> *       &quot;type&quot;: &quot;sse&quot;,</span></span><br><span class="line"><span class="comment"> *       &quot;alwaysAllow&quot;: [],</span></span><br><span class="line"><span class="comment"> *       &quot;disabled&quot;: false</span></span><br><span class="line"><span class="comment"> *     &#125;,</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> zhaozhiwei</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2025/7/19 13:58</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span> V1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Application</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> ToolCallbackProvider <span class="title function_">weatherTools</span><span class="params">(WeatherService weatherService)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> MethodToolCallbackProvider.builder().toolObjects(weatherService).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="在nacos中查看注册情况"><a href="#在nacos中查看注册情况" class="headerlink" title="在nacos中查看注册情况"></a>在nacos中查看注册情况</h2><h3 id="查看mcp列表"><a href="#查看mcp列表" class="headerlink" title="查看mcp列表"></a>查看mcp列表</h3><p><img src="http://43.143.194.245:9000/images/MCP/images/02_001.png"></p>
<h3 id="mcp-server详情"><a href="#mcp-server详情" class="headerlink" title="mcp server详情"></a>mcp server详情</h3><p><img src="http://43.143.194.245:9000/images/MCP/images/02_002.png"></p>
<h3 id="动态变更工具开关"><a href="#动态变更工具开关" class="headerlink" title="动态变更工具开关"></a>动态变更工具开关</h3><p>MCP Server 自动注册到 Nacos 之后，可以在控制台上动态变更 MCP Server<br>Tools 的描述和开关，相关修改将会在运行时中动态应用到 MCP Server<br>中，无需重启服务 <img src="http://43.143.194.245:9000/images/MCP/images/02_003.png"></p>
<h1 id="使用-Nacos-MCP-Wrapper-Python-开发-MCP-Server"><a href="#使用-Nacos-MCP-Wrapper-Python-开发-MCP-Server" class="headerlink" title="使用 Nacos MCP Wrapper Python 开发 MCP Server"></a>使用 Nacos MCP Wrapper Python 开发 MCP Server</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 这里python环境一定要在3.12+</span></span><br><span class="line">pip install nacos-mcp-wrapper-python</span><br></pre></td></tr></table></figure>

<h2 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">使用nacos注册的mcp server</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;nacos-mcp-python&quot;: &#123;</span></span><br><span class="line"><span class="string">      &quot;url&quot;: &quot;http://localhost:18001/sse&quot;,</span></span><br><span class="line"><span class="string">      &quot;type&quot;: &quot;sse&quot;,</span></span><br><span class="line"><span class="string">      &quot;alwaysAllow&quot;: [],</span></span><br><span class="line"><span class="string">      &quot;disabled&quot;: false</span></span><br><span class="line"><span class="string">    &#125;,</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> nacos_mcp_wrapper.server.nacos_mcp <span class="keyword">import</span> NacosMCP</span><br><span class="line"><span class="keyword">from</span> nacos_mcp_wrapper.server.nacos_settings <span class="keyword">import</span> NacosSettings</span><br><span class="line"></span><br><span class="line"><span class="comment"># Create an MCP server instance</span></span><br><span class="line">nacos_settings = NacosSettings()</span><br><span class="line">nacos_settings.SERVER_ADDR = <span class="string">&quot;127.0.0.1:8848&quot;</span> <span class="comment"># &lt;nacos_server_addr&gt; e.g. 127.0.0.1:8848</span></span><br><span class="line">nacos_settings.USERNAME=<span class="string">&quot;nacos&quot;</span></span><br><span class="line">nacos_settings.PASSWORD=<span class="string">&quot;nacos&quot;</span></span><br><span class="line">mcp = NacosMCP(<span class="string">&quot;nacos-mcp-python&quot;</span>, nacos_settings=nacos_settings, port=<span class="number">18001</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register an addition tool</span></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two integers together&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="comment"># Register a subtraction tool</span></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">minus</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Subtract two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> a - b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="comment"># 服务保持运行</span></span><br><span class="line">        mcp.run(transport=<span class="string">&quot;sse&quot;</span>)</span><br><span class="line">        <span class="comment"># mcp.run(transport=&quot;stdio&quot;)</span></span><br><span class="line">        <span class="comment"># mcp.run(transport=&quot;streamable-http&quot;)</span></span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&quot;Runtime error: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="在nacos中查看注册情况-1"><a href="#在nacos中查看注册情况-1" class="headerlink" title="在nacos中查看注册情况"></a>在nacos中查看注册情况</h2><h3 id="查看mcp列表-1"><a href="#查看mcp列表-1" class="headerlink" title="查看mcp列表"></a>查看mcp列表</h3><p><img src="http://43.143.194.245:9000/images/MCP/images/02_001.png"></p>
<h3 id="mcp-server详情-1"><a href="#mcp-server详情-1" class="headerlink" title="mcp server详情"></a>mcp server详情</h3><p><img src="http://43.143.194.245:9000/images/MCP/images/02_004.png"></p>
<h3 id="动态变更工具开关-1"><a href="#动态变更工具开关-1" class="headerlink" title="动态变更工具开关"></a>动态变更工具开关</h3><p>MCP Server 自动注册到 Nacos 之后，可以在控制台上动态变更 MCP Server<br>Tools 的描述和开关，相关修改将会在运行时中动态应用到 MCP Server<br>中，无需重启服务 <img src="http://43.143.194.245:9000/images/MCP/images/02_005.png"></p>
<h1 id="在RooCode插件中配置MCP"><a href="#在RooCode插件中配置MCP" class="headerlink" title="在RooCode插件中配置MCP"></a>在RooCode插件中配置MCP</h1><h2 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h2><p>在mcp_setting.json文件中配置自己的server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;mcpServers&quot;: &#123;</span><br><span class="line">    &quot;nacos-mcp-python&quot;: &#123;</span><br><span class="line">      &quot;url&quot;: &quot;http://localhost:18001/sse&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;sse&quot;,</span><br><span class="line">      &quot;alwaysAllow&quot;: [],</span><br><span class="line">      &quot;disabled&quot;: false</span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;webmvc-mcp-server&quot;: &#123;</span><br><span class="line">      &quot;url&quot;: &quot;http://localhost:8081/sse&quot;,</span><br><span class="line">      &quot;type&quot;: &quot;sse&quot;,</span><br><span class="line">      &quot;alwaysAllow&quot;: [],</span><br><span class="line">      &quot;disabled&quot;: false</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="检查是否成功"><a href="#检查是否成功" class="headerlink" title="检查是否成功"></a>检查是否成功</h2><p>配置完成后，mcpServer会显示绿色图标,如下</p>
<p><img src="http://43.143.194.245:9000/images/MCP/images/02_006.png"></p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><h2 id="求和"><a href="#求和" class="headerlink" title="求和"></a>求和</h2><p>使用demo工具, 计算100和201的和, 效果如下</p>
<p><img src="http://43.143.194.245:9000/images/MCP/images/02_007.png" alt="显示求和"></p>
<h2 id="查看天气"><a href="#查看天气" class="headerlink" title="查看天气"></a>查看天气</h2><p><img src="http://43.143.194.245:9000/images/MCP/images/02_008.png" alt="查看北京天气"></p>
<h1 id="代码地址"><a href="#代码地址" class="headerlink" title="代码地址"></a>代码地址</h1><p><a target="_blank" rel="noopener" href="https://github.com/zhaozhiwei1992/python/tree/master/demo/llm/mcp">https://github.com/zhaozhiwei1992/python/tree/master/demo/llm/mcp</a></p>
<p><a target="_blank" rel="noopener" href="https://github.com/zhaozhiwei1992/demo/tree/master/springboot/springboot-nacos-mcp">https://github.com/zhaozhiwei1992/demo/tree/master/springboot/springboot-nacos-mcp</a></p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://nacos.io/docs/latest/manual/user/ai/mcp-auto-register/?spm=5238cd80.2ef5001f.0.0.3f613b7cth6gs3">https://nacos.io/docs/latest/manual/user/ai/mcp-auto-register/?spm=5238cd80.2ef5001f.0.0.3f613b7cth6gs3</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/06/18/Dify0.15.1%E5%8D%87%E7%BA%A71.4.3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/06/18/Dify0.15.1%E5%8D%87%E7%BA%A71.4.3/" class="post-title-link" itemprop="url">Dify0.15.1升级1.4.3版本</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-06-18 08:00:00" itemprop="dateCreated datePublished" datetime="2025-06-18T08:00:00+08:00">2025-06-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="安装1-4-3"><a href="#安装1-4-3" class="headerlink" title="安装1.4.3"></a>安装1.4.3</h1><p><a target="_blank" rel="noopener" href="https://codeload.github.com/langgenius/dify/tar.gz/refs/tags/1.4.3">https://codeload.github.com/langgenius/dify/tar.gz/refs/tags/1.4.3</a></p>
<p>下载后在原dify-0.15.1同级目录解压</p>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>cd dify-1.4.3/docker</p>
<p>cp .env.example .env # 公司环境需要调整nginx expose端口</p>
<p>docker-compose up -d # 等待启动完成，正常访问页面即可</p>
<h1 id="压缩原挂载目录"><a href="#压缩原挂载目录" class="headerlink" title="压缩原挂载目录"></a>压缩原挂载目录</h1><p>cd dify-0.15.1/docker</p>
<p>tar -zcvf volumes.tar.gz volumes</p>
<h1 id="用0-15-1的挂载目录覆盖1-4-3的挂载"><a href="#用0-15-1的挂载目录覆盖1-4-3的挂载" class="headerlink" title="用0.15.1的挂载目录覆盖1.4.3的挂载"></a>用0.15.1的挂载目录覆盖1.4.3的挂载</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 备份1.4.3挂载目录</span><br><span class="line">tar -zcvf volumes143.tar.gz volumes</span><br><span class="line"></span><br><span class="line">2. 删除挂载目录</span><br><span class="line">rm -rf volumes</span><br><span class="line"></span><br><span class="line">3. 用0.15.1的挂载覆盖当前挂载目录，如果是开发本地使用，可以用官方提供的方式测试。</span><br><span class="line">cp dify-0.15.1/docker/volumes.tar.gz .</span><br><span class="line"></span><br><span class="line">tar -zxvf volumes.tar.gz</span><br><span class="line"></span><br><span class="line">4. 启动服务访问测试</span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="启动后操作"><a href="#启动后操作" class="headerlink" title="启动后操作"></a>启动后操作</h1><ol>
<li> 原项目中一些llm，embedding等都没有配置，需要自己在界面增加供应商再次配置即可，配置后重新刷新页面。</li>
</ol>
<h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><ol>
<li> 如果是内网环境，docker需要在公网环境下载好后，通过load方式加载到内网，对于插件同理。</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a target="_blank" rel="noopener" href="https://docs.dify.ai/zh-hans/development/migration/migrate-to-v1">https://docs.dify.ai/zh-hans/development/migration/migrate-to-v1</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/04/28/RooCode%E7%BB%93%E5%90%88%E6%9C%AC%E5%9C%B0MCP%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/28/RooCode%E7%BB%93%E5%90%88%E6%9C%AC%E5%9C%B0MCP%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">RooCode结合本地MCP实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-28 08:00:00" itemprop="dateCreated datePublished" datetime="2025-04-28T08:00:00+08:00">2025-04-28</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
                </span>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>目前MCP也炒了一段时间，是骡子是马得拉出来溜溜。这篇文章偏向点技术，如果没有一点开发经验听个响就好。</p>
<h1 id="实现两个简单功能"><a href="#实现两个简单功能" class="headerlink" title="实现两个简单功能"></a>实现两个简单功能</h1><h2 id="计算求和"><a href="#计算求和" class="headerlink" title="计算求和"></a>计算求和</h2><h2 id="显示本地目录列表"><a href="#显示本地目录列表" class="headerlink" title="显示本地目录列表"></a>显示本地目录列表</h2><h1 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h1><h2 id="通过python实现一个server"><a href="#通过python实现一个server" class="headerlink" title="通过python实现一个server"></a>通过python实现一个server</h2><h3 id="文件创建"><a href="#文件创建" class="headerlink" title="文件创建"></a>文件创建</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/workspace/python/demo</span><br><span class="line"><span class="built_in">mkdir</span> mcp &amp;&amp; <span class="built_in">cd</span> mcp</span><br><span class="line"><span class="built_in">touch</span> SumMCP.py</span><br></pre></td></tr></table></figure>

<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">一个MCP Server, SumMCP.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> fastmcp <span class="keyword">import</span> FastMCP</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">mcp = FastMCP(<span class="string">&quot;Demo&quot;</span>, log_level=<span class="string">&quot;ERROR&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;add&quot;</span>, a, b)</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">listdir</span>(<span class="params">path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;show user dir list 显示用户文件列表&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> os.listdir(path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># mcp.run()</span></span><br><span class="line">    <span class="comment"># mcp.run(transport=&quot;sse&quot;, port=9123)</span></span><br><span class="line">    <span class="comment"># 基于标准输入输出实现，本地小工具推荐这种方式</span></span><br><span class="line">    mcp.run(transport=<span class="string">&#x27;stdio&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h3><p>我这里使用的是anaconda，其它依赖管理都行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda create -n py_3.12 python=3.12</span><br><span class="line"><span class="built_in">source</span> /opt/anaconda/bin/activate py_3.12</span><br><span class="line">pip install fastmcp</span><br></pre></td></tr></table></figure>

<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a target="_blank" rel="noopener" href="https://github.com/jlowin/fastmcp">https://github.com/jlowin/fastmcp</a></p>
<h2 id="vscode安装RooCode插件"><a href="#vscode安装RooCode插件" class="headerlink" title="vscode安装RooCode插件"></a>vscode安装RooCode插件</h2><h2 id="在RooCode插件中配置MCP"><a href="#在RooCode插件中配置MCP" class="headerlink" title="在RooCode插件中配置MCP"></a>在RooCode插件中配置MCP</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在mcp_setting.json文件中配置自己的server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;mcpServers&quot;: &#123;</span><br><span class="line">    &quot;demo&quot;: &#123;</span><br><span class="line">      &quot;command&quot;: &quot;~/.conda/envs/py_3.12/bin/fastmcp&quot;,</span><br><span class="line">      &quot;args&quot;: [&quot;run&quot;, &quot;~/workspace/python/demo/mcp/SumMCP.py&quot;],</span><br><span class="line">      &quot;disabled&quot;: false,</span><br><span class="line">      &quot;alwaysAllow&quot;: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查是否成功"><a href="#检查是否成功" class="headerlink" title="检查是否成功"></a>检查是否成功</h3><p>配置完成后，mcpServer会显示绿色图标,如下</p>
<p><img src="https://19921514.xyz/minio/images/roocode_mcp.png" alt="mcp配置"></p>
<p>如果在之前SumMCP.py中增加了工具，一定要在这里刷新下，显示出新的工具，然后在插件中使用才会读取到。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="求和"><a href="#求和" class="headerlink" title="求和"></a>求和</h3><p>使用demo工具, 计算99和98的和, 效果如下</p>
<p><img src="https://19921514.xyz/minio/images/roocode_mcp_sum.png" alt="显示求和"></p>
<h3 id="显示文件列表"><a href="#显示文件列表" class="headerlink" title="显示文件列表"></a>显示文件列表</h3><p>使用listdir工具显示 /home/xx/Documents下的文件列表，效果如下</p>
<p><img src="https://19921514.xyz/minio/images/roocode_mcp_listdir.png" alt="显示文件列表"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>使用mcp的方式可以按照自己要求实现一些插件本身做不了或者不好实现的功能。目的是为了让外部交互的返回更好的跟模型上下文结合，从而产生更好的效果。如果对话过程中，模型能够自动识别是需要使用哪个mcp那么效果应该会更好。目前是需要明确告诉插件使用mcp，有时候甚至得告诉它具体是哪个tool。</p>
<p>这里只是一个最简单的使用，企业项目中能否使用该方式扩展业务，如何扩展，且听下回分解。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/04/22/Vaultwarden%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/04/22/Vaultwarden%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">本地密码管理器-Vaultwarden</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-04-22 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-22T00:00:00+08:00">2025-04-22</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前主要使用lastpass，目前是浏览器端免费，其它都要收费，而且密码存在别人服务器总是不放心。</p>
<p>所以我们要本地部署vaultwarden并且可以在各种Bitwarden正常使用。这里使用vaultwarden是因为相比原生更加轻量，占用资源极少。</p>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="环境准备​​"><a href="#环境准备​​" class="headerlink" title="环境准备​​"></a>环境准备​​</h2><p>​​服务器要求​​：腾讯云服务器（1核2GB内存，Ubuntu/Debian系统）。</p>
<p>​​开放端口​​：80（HTTP）、443（HTTPS），通过腾讯云控制台配置安全组</p>
<p>注:<br>如果家里本身就有公网ip，或者只是本地玩玩，是不需要公网服务器的。我这里公网服务器资源紧张，用来做转发，实际服务部署到内网机，所以公网和内网交互需要内网穿透，我这里使用的是zerotier。</p>
<h2 id="内网机部署"><a href="#内网机部署" class="headerlink" title="内网机部署"></a>内网机部署</h2><p>为了方便从云服务器转发到内网，所以通过nginx包一层，给vaultwarden套一个前缀，比如:/bitwarden。否则云服务nginx转发会很乱</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx-proxy:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx-proxy</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8000:80&quot;</span>    <span class="comment"># 对外暴露 HTTPS 端口</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./ssl:/etc/nginx/ssl</span>   <span class="comment"># 证书存储目录</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">vaultwarden-net</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">vaultwarden</span></span><br><span class="line">  <span class="attr">vaultwarden:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">vaultwarden/server:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">vaultwarden</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">vaultwarden-net</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./vw-data/:/data/</span></span><br><span class="line">    <span class="attr">expose:</span>          <span class="comment"># 仅内部暴露端口，nginx能访问即可</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3012&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义网络（实现容器间通信）</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">vaultwarden-net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<h3 id="挂载目录结构如下"><a href="#挂载目录结构如下" class="headerlink" title="挂载目录结构如下"></a>挂载目录结构如下</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vaultwarden/</span><br><span class="line">├── docker-compose.yaml</span><br><span class="line">└── volumes</span><br><span class="line">    ├── nginx</span><br><span class="line">    │   ├── conf.d</span><br><span class="line">    │   │   └── default.conf</span><br><span class="line">    │   ├── ssl</span><br><span class="line">    │   │   ├── certificate.crt</span><br><span class="line">    │   │   └── private.key</span><br><span class="line">    │   └── uwsgi_params</span><br><span class="line">    └── vw-data</span><br></pre></td></tr></table></figure>

<h3 id="conf-d-default-conf配置"><a href="#conf-d-default-conf配置" class="headerlink" title="conf.d/default.conf配置"></a>conf.d/default.conf配置</h3><p>这里nginx.conf会默认引入所有conf.d/*.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    listen  [::]:80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> 301 https://$host<span class="variable">$request_uri</span>;  <span class="comment"># 301 永久重定向</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPS 主配置</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    listen [::]:443 ssl http2;</span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 证书配置（自签名示例，生产环境替换为 Let&#x27;s Encrypt）</span></span><br><span class="line">    <span class="comment">#ssl_certificate /etc/nginx/ssl/cert.pem;</span></span><br><span class="line">    <span class="comment">#ssl_certificate_key /etc/nginx/ssl/privkey.pem;</span></span><br><span class="line">    ssl_certificate /etc/nginx/ssl/certificate.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/private.key;</span><br><span class="line">    ssl_session_cache shared:SSL:1m;</span><br><span class="line">    ssl_session_timeout 10m;</span><br><span class="line">    ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 静态文件服务（可选）</span></span><br><span class="line">    location / &#123;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Vaultwarden 代理配置（核心修正）</span></span><br><span class="line">    location /bitwarden/ &#123;</span><br><span class="line">        proxy_pass http://vaultwarden/;  <span class="comment"># 末尾斜杠确保移除路径前缀</span></span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 解决路径前缀导致的资源加载问题</span></span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        sub_filter_once off;</span><br><span class="line">        sub_filter_types *;</span><br><span class="line">        sub_filter <span class="string">&#x27;href=&quot;/&#x27;</span> <span class="string">&#x27;href=&quot;/bitwarden/&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;src=&quot;/&#x27;</span> <span class="string">&#x27;src=&quot;/bitwarden/&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># WebSocket 支持（实时同步）, 自 v1.31.0 起，已移除对 3012 端口 WebSocket 流量的支持，因为它已集成至主 HTTP 端口。</span></span><br><span class="line">    location /bitwarden/notifications/hub &#123;</span><br><span class="line">        proxy_pass http://vaultwarden:3012;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 错误页面配置（保持原样）</span></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置自签名证书"><a href="#配置自签名证书" class="headerlink" title="配置自签名证书"></a>配置自签名证书</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在docker-compose同级目录执行</span></span><br><span class="line">sudo openssl req -x509 -nodes -days 365 -newkey rsa:2048 \</span><br><span class="line">  -keyout ./volumes/nginx/ssl/private.key \</span><br><span class="line">  -out ./volumes/nginx/ssl/certificate.crt</span><br></pre></td></tr></table></figure>

<h3 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h3 id="测试访问"><a href="#测试访问" class="headerlink" title="测试访问"></a>测试访问</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://10.241.189.234:8443/bitwarden</span><br></pre></td></tr></table></figure>

<h2 id="公网ECS配置nginx-无域名"><a href="#公网ECS配置nginx-无域名" class="headerlink" title="公网ECS配置nginx(无域名)"></a>公网ECS配置nginx(无域名)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加 234-proxy-443.conf, 这里一定要注意，把nginx.conf中server啥的都干掉，避免影响。</span></span><br><span class="line"></span><br><span class="line">[root@VM-8-12-centos conf.d]<span class="comment"># cat 234-proxy-443.conf</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name 替换为你的公网域名或IP;  <span class="comment"># 替换为你的公网域名或IP</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 证书配置（必须使用有效证书，如 Let&#x27;s Encrypt）</span></span><br><span class="line">    <span class="comment"># ssl_certificate /etc/letsencrypt/live/your-public-domain.com/fullchain.pem;</span></span><br><span class="line">    <span class="comment"># ssl_certificate_key /etc/letsencrypt/live/your-public-domain.com/privkey.pem;</span></span><br><span class="line">    ssl_certificate /etc/nginx/ssl/certificate.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/private.key;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理到内网服务</span></span><br><span class="line">    location /bitwarden &#123;</span><br><span class="line">    proxy_pass https://10.241.189.234:8443;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 信任内网服务的自签名证书（可选）</span></span><br><span class="line">        proxy_ssl_verify off;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他安全头配置</span></span><br><span class="line">    add_header Strict-Transport-Security <span class="string">&quot;max-age=63072000; includeSubDomains; preload&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="nginx-s-reload"><a href="#nginx-s-reload" class="headerlink" title="nginx -s reload"></a>nginx -s reload</h3><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://ECS公网IP/bitwarden</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这种方式配置后，在浏览器可以直接使用，包括插件。但是会提示证书不安全，手机端除非手动能安装自建证书，否则无法直接使用。</span></span><br></pre></td></tr></table></figure>

<h2 id="公网ECS配置nginx-有域名"><a href="#公网ECS配置nginx-有域名" class="headerlink" title="公网ECS配置nginx(有域名)"></a>公网ECS配置nginx(有域名)</h2><p>以腾讯ECS为例</p>
<h3 id="域名配置"><a href="#域名配置" class="headerlink" title="域名配置"></a>域名配置</h3><p>根据官方提示，将域名绑定到ECS机器</p>
<p>进行域名备案</p>
<h3 id="调整nginx配置"><a href="#调整nginx配置" class="headerlink" title="调整nginx配置"></a>调整nginx配置</h3><p>使用免费或者付费的ssl证书，下载后替换nginx中配置的证书信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SSL 证书配置（必须使用有效证书）</span></span><br><span class="line">ssl_certificate /etc/nginx/ssl/自己的域名.crt;</span><br><span class="line">ssl_certificate_key /etc/nginx/ssl/自己的域名.xyz.key;</span><br></pre></td></tr></table></figure>

<h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><ol>
<li> 下载安装bitwarden相关客户端，包括app端，浏览器插件等</li>
<li> 配置为自托管，然后按照自己设置的用户密码登录即可</li>
</ol>
<h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><p>找一个自己觉得安全的地方备份自己的挂载(volumes目录)，比如NAS或者网盘，U盘等</p>
<h1 id="问题处理"><a href="#问题处理" class="headerlink" title="问题处理"></a>问题处理</h1><h2 id="console-log-service-ts-53-Unhandled-error-in-angular-Error-Could-not-instantiate-WebCryptoFunctionService-Could-not-locate-Subtle-crypto"><a href="#console-log-service-ts-53-Unhandled-error-in-angular-Error-Could-not-instantiate-WebCryptoFunctionService-Could-not-locate-Subtle-crypto" class="headerlink" title="console-log.service.ts:53 Unhandled error in angular Error: Could not instantiate WebCryptoFunctionService. Could not locate Subtle crypto."></a>console-log.service.ts:53 Unhandled error in angular Error: Could not instantiate WebCryptoFunctionService. Could not locate Subtle crypto.</h2><h3 id="分析处理"><a href="#分析处理" class="headerlink" title="分析处理"></a>分析处理</h3><p>必须使用https访问，否则报错</p>
<h2 id="安卓客户端无法访问，提示无法验证服务器证书"><a href="#安卓客户端无法访问，提示无法验证服务器证书" class="headerlink" title="安卓客户端无法访问，提示无法验证服务器证书"></a>安卓客户端无法访问，提示无法验证服务器证书</h2><h3 id="分析处理-1"><a href="#分析处理-1" class="headerlink" title="分析处理"></a>分析处理</h3><p>这个真得有域名了。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/03/30/%E4%B8%9A%E5%8A%A1+AI%E4%BC%81%E4%B8%9A%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/30/%E4%B8%9A%E5%8A%A1+AI%E4%BC%81%E4%B8%9A%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">从业务视角看AI落地：避免技术狂欢，聚焦真实需求</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-03-30 00:00:00" itemprop="dateCreated datePublished" datetime="2025-03-30T00:00:00+08:00">2025-03-30</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2025-04-01 20:40:59" itemprop="dateModified" datetime="2025-04-01T20:40:59+08:00">2025-04-01</time>
              </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言：为什么企业需要警惕”AI军备竞赛”？"><a href="#前言：为什么企业需要警惕”AI军备竞赛”？" class="headerlink" title="前言：为什么企业需要警惕”AI军备竞赛”？"></a>前言：为什么企业需要警惕”AI军备竞赛”？</h1><p>当前AI技术发展呈现”技术狂欢”态势，今天Deepseek火了跟一把，明天出来个其它看着高级的东西又跟一把。但企业实践中最常出现的问题在于：投入大量资源训练模型后，业务价值却难以量化。本文从业务出发，探讨如何让AI真正成为业务增长的助推器。</p>
<h1 id="为什么AI是业务的必选项"><a href="#为什么AI是业务的必选项" class="headerlink" title="为什么AI是业务的必选项?"></a>为什么AI是业务的必选项?</h1><p>现在网上AI技术层出不穷，很多人通过ai来做一些日常工作，比如写写文章，查查资料，做做总结。高级一点的自己通过coze之类的平台做一些自己的AI工作流，智能体，通过各种组合提高自己的工作效率。</p>
<p>对于企业来说，如果自己在业务上能跟AI结合，能够从各方面提高自己产品的竞争力。</p>
<p>就以客服系统来说，有时候机器人客服回复的内容比较死板，很多都是通过内容匹配给出结果。但是使用AI以后能够充分利用AI的分析总结能力，将一些散落的知识分析总结，更加合理的提供给用户，甚至不仔细观察都以为是真人。相对于之前冷冰冰的知识，通过AI可以更好的提高客户体验，增强客户满意度和忠诚度。</p>
<h1 id="为什么AI很难在企业中落地"><a href="#为什么AI很难在企业中落地" class="headerlink" title="为什么AI很难在企业中落地?"></a>为什么AI很难在企业中落地?</h1><p>这里不是说落不了地，而是这么久了还没有爆炸性落地的产品。之前Deepseek火了，出来一拨”落地”热，基本上就是自己自己部署个模型或者搭建个简单知识库就敢说是落地。</p>
<p>其实AI无法落地主要的问题在于找不到切入点，还有行动力不足。首先是切入点问题，有些领导认为AI无所不能，上来就是高难度操作，认为只要部署个模型，挂个知识库，就可以让自己的产品智能了，用户问啥能干啥，也不需要那么多开发，测试，运营了。这种是完全被洗脑的，觉得AI就是神仙，无所不能，并不是所有场景适合硬往AI上套。还有一种是行动力不足，觉得AI现在发展还看不懂，不够成熟，准备再观察观察。</p>
<p>那么怎么让业务能跟AI更好的结合呢，下面我会给出一些自己在实践中的理解。</p>
<h1 id="AI如何重塑核心场景"><a href="#AI如何重塑核心场景" class="headerlink" title="AI如何重塑核心场景?"></a>AI如何重塑核心场景?</h1><h2 id="正确认识AI"><a href="#正确认识AI" class="headerlink" title="正确认识AI"></a>正确认识AI</h2><p>首先我们要对AI有个正确的认识，AI不是无所不能，并不是所有的场景都适合AI。AI本生是科技的产物，可以把它理解为一个拥有海量通用知识的业务小白。业务太庞杂了，对于一个行业内摸爬滚打多年的人都不敢说样样精通，并且很多业务不公开或者还需要随机应变，一些网上能下载到的通用大模型根本没有经过业务训练，不可能一上来就解决业务问题。</p>
<h2 id="识别关键业务场景"><a href="#识别关键业务场景" class="headerlink" title="识别关键业务场景"></a>识别关键业务场景</h2><p>之前说道网上有很多把AI玩出花的场景，也有很多解决实际问题的场景。为什么能出现这些东西，是因为大家会思考，能动手，知道自己要什么。比如我在没有AI之前也会通过程序脚本之类的各种玩意儿来解决自己实际问题，提高效率。对个人来说会思考，知道自己要什么，加一点点动手能力才能用好AI。</p>
<p>对于企业来说本身在行业深耕多年，业务就是企业最大的优势，应深入分析业务，在业务中找到与AI的结合点。AI的能力应该是解决实际问题，而不是为了应用AI而强行整合。再炫酷的操作如何用户不买账没有任何意义。最好是找三五个业务专家，再配合三五个对AI了解的工程师大家坐在一起，互相分享下业务场景，AI相关知识，多次分享讨论研究最终找出中间的结合点。</p>
<p>一定不要刚开始就给自己上强度，可以先找点场景试试demo，在做的过程中发现真正需要的场景再去挖掘。中小公司千万不要一上来就微调训练模型。刚开始的目标应该是业务+AI，业务为主，AI为辅，用业务驱动AI更快落地，最终让AI成为系统中一项不可分割的能力。</p>
<h2 id="AI技术的应用案例"><a href="#AI技术的应用案例" class="headerlink" title="AI技术的应用案例"></a>AI技术的应用案例</h2><p>下边我给出一些业务中使用的案例，供大家参考，不同的企业有不同的业务，这里只抛砖引玉。</p>
<h3 id="AI助理"><a href="#AI助理" class="headerlink" title="AI助理"></a>AI助理</h3><p>首先是问答类的AI助理，这种是对知识库的应用。企业在多年发展过程中本身积累了不少行业知识，那么就可以整理调整为知识库供AI使用。如何做知识库之前文章也说过，最重要的是知识库的准确性，一般来说，整理成QA方式最方便知识库使用，可以先将一些系统操作手册，问题解决方案之类的东西做知识库，后边再扩展。</p>
<h3 id="智能风控"><a href="#智能风控" class="headerlink" title="智能风控"></a>智能风控</h3><p>在很多领域都有风控的处理，好一点的会使用一些规则库进行处理，如果差的直接就是硬编码了，这些规则一般都是来源于一些业务或者政策文件，需要翻译成程序能识别的规则才能使用。如果用AI，我们只需要把这些政策做到人能理解的程度，那么AI就可以结合规则在数据流转中进行控制，并按照预设的要求进行反馈，比如生成一个风控报告之类的。这种方式比通过程序处理更方便，不用单独再通过程序实现报告功能，还得需要程序去主动调用。</p>
<h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><p>每个企业的业务都不一样，主要是从业务入手，去发现。一定是奔着简化用户操作，优化用户体验去的场景，而不是为了AI而造出来的业务。</p>
<h1 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h1><p>业务再整合模型时一定不会只使用一种模型走天下，不同的模型有不同的优势。所以前期可以选择市面好用的编排工具，比如DIFY之类的，配置比较灵活，可以整合市面上绝大部分模型。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/03/13/AI%E6%A8%A1%E5%9E%8B%E8%90%BD%E5%9C%B0%E6%80%9D%E8%80%83/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/13/AI%E6%A8%A1%E5%9E%8B%E8%90%BD%E5%9C%B0%E6%80%9D%E8%80%83/" class="post-title-link" itemprop="url">从"我要去山西旅游"看AI智能体的未来之旅：大模型如何重构自动化服务生态</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-03-13 00:00:00" itemprop="dateCreated datePublished" datetime="2025-03-13T00:00:00+08:00">2025-03-13</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这篇文章主要是基于目前AI发展现状做出的一些思考，如何才能让模型更智能?</p>
<p>我们基于一个旅游场景来设想模型应该如何实现: 我要去山西旅游</p>
<h1 id="任务分解"><a href="#任务分解" class="headerlink" title="任务分解"></a>任务分解</h1><p>模型首先要基于”我要去山西旅游”这个要求进行分解，整理成一个类似操作列表的东西。下边是基于实际情况给出的一个设想。</p>
<ol>
<li>TODO 要问用户是什么时间去，要去的具体地方。</li>
<li>TODO 确定时间和地方后帮用户查看当地的天气情况，给出穿衣建议。</li>
<li>TODO 帮用户自动查询交通工具，给出合理的建议，供用户选择。</li>
<li>TODO 用户选择后自动去请求接口订票。</li>
<li>TODO 给用户提供一些当地的特色，游玩，美食等。</li>
</ol>
<h1 id="应该如何实现"><a href="#应该如何实现" class="headerlink" title="应该如何实现"></a>应该如何实现</h1><ol>
<li>需要模型能够理解用户的意图，并能分解成计划。(现在一些通用的大模型，可以通过多轮的方式实现类似效果。)</li>
<li>跟用户逐步确定计划中需要的点，比如具体要去的地方等，完成一条计划就标记为DONE。</li>
<li>根据计划选择合适的外部工具，比如调用实时查询天气的工具，订票的工具等，完成后同样标记完成。</li>
<li>按照模型自己给出的计划，依次完成知道任务结束。</li>
</ol>
<h1 id="实现难点"><a href="#实现难点" class="headerlink" title="实现难点"></a>实现难点</h1><ol>
<li>如何让模型能够识别系统中注册的工具或者agent(如果是企业级，可能会有很多)</li>
<li>如何定义合理的接口，能让模型理解接口的输入输出，从而自动产生相应的参数，将整个计划自动串联起来。</li>
</ol>
<h1 id="一个技术人的设想"><a href="#一个技术人的设想" class="headerlink" title="一个技术人的设想"></a>一个技术人的设想</h1><ol>
<li>定义一个统一的工具交互规范，模型能够理解，并能根据需要方便识别到。</li>
<li>提供一个注册中心，个人或者企业能够按照业务创建很多智能体，然后注册。</li>
<li>参考面向对象的思想，智能体应该是独立的个体，没有中间调度也可以独立使用。</li>
<li>模型可以根据用户要求分解任务，并在注册中心中找到合理的智能体进行调度。</li>
</ol>
<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1><p>现在很多落地的东西是一条条的工作流，只能体现一部分模型的能力，虽然可以对外交互，也只是人为干预的结果。当然也可能有很多优秀的方案没有发现。虽然网上有很多基于cursor实现的一些类似场景的效果，但是对于普通人使用还是不方便，很多敏感数据也不能交出去，自己玩玩可以，生产实践不行。</p>
<p>如何一句话让模型把事儿干好，才是未来发展的方向。</p>
<p>如果大家有合适的方案可以沟通交流，共勉。</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/03/10/OpenManus%E5%B0%9D%E9%B2%9C/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/03/10/OpenManus%E5%B0%9D%E9%B2%9C/" class="post-title-link" itemprop="url">OpenManus+DeepSeek体验</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-03-10 00:00:00" itemprop="dateCreated datePublished" datetime="2025-03-10T00:00:00+08:00">2025-03-10</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>这篇文章偏技术，如果跟着文章操作有难度，建议找网上找相关视频操作。</p>
<h1 id="什么是OpenManus，为什么要使用"><a href="#什么是OpenManus，为什么要使用" class="headerlink" title="什么是OpenManus，为什么要使用"></a>什么是OpenManus，为什么要使用</h1><p>说到OpenManus就不得不先提下Manus，Manus是全球首款真正意义上的通用型AI Agent，由中国的创业公司Monica开发，看官方的演示感觉很6，但是10w的邀请吗告诉我，我不配。</p>
<p>幸好有大佬连夜整出来一个OpenManus，引用官方一句描述: Manus 非常棒，但 OpenManus 无需邀请码即可实现任何创意 ！</p>
<h2 id="那么OpenManus能做什么呢"><a href="#那么OpenManus能做什么呢" class="headerlink" title="那么OpenManus能做什么呢"></a>那么OpenManus能做什么呢</h2><p>复杂任务规划与执行：它可以把复杂的任务拆解成多个小步骤，自动规划并执行，最后给出完整的成果。</p>
<p>工具调用与自动化：很多工作离不开外部工具。 OpenManus 能灵活调动 各种工具，比如浏览器、数据分析软件等，完全不用你担心技术细节。</p>
<p>智能信息收集与处理：OpenManus 不仅能浏览网页、提取信息，还能进行精准的内容整理。</p>
<h1 id="安装使用"><a href="#安装使用" class="headerlink" title="安装使用"></a>安装使用</h1><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><h3 id="os-archlinux"><a href="#os-archlinux" class="headerlink" title="os: archlinux"></a>os: archlinux</h3><h2 id="安装OpenManus"><a href="#安装OpenManus" class="headerlink" title="安装OpenManus"></a>安装OpenManus</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 源码下载</span><br><span class="line">git clone https://github.com/mannaandpoem/OpenManus.git</span><br><span class="line"></span><br><span class="line">2. 进入项目根目录</span><br><span class="line">cd OpenManus</span><br><span class="line"></span><br><span class="line">3. 创建新的 conda 环境</span><br><span class="line">conda create -n open_manus python=3.12</span><br><span class="line"></span><br><span class="line">4. 等待完成后，设置当前python环境</span><br><span class="line">source /opt/anaconda/bin/activate open_manus</span><br><span class="line"></span><br><span class="line">5. 安装依赖</span><br><span class="line">pip install -r requirements.txt</span><br></pre></td></tr></table></figure>
<h2 id="购买DeepSeekApi"><a href="#购买DeepSeekApi" class="headerlink" title="购买DeepSeekApi"></a>购买DeepSeekApi</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1. 访问DeepSeek官网 https://www.deepseek.com./ 。</span><br><span class="line"></span><br><span class="line">2. 点击右上角API开放平台，左边充值即可，测试充个10元就勾了。</span><br><span class="line"></span><br><span class="line">3. 充值完毕后，点击API Keys，创建自己的key，我这里起名字就是OpenManus(可以看看这玩意儿消耗tokens的量)</span><br></pre></td></tr></table></figure>

<h2 id="配置OpenManus"><a href="#配置OpenManus" class="headerlink" title="配置OpenManus"></a>配置OpenManus</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">OpenManus 需要配置使用的 LLM API，请按以下步骤设置：</span><br><span class="line"></span><br><span class="line">1. 保证当前还在项目跟目录下</span><br><span class="line"></span><br><span class="line">2. 创建config.toml文件：</span><br><span class="line">cp config/config.example.toml config/config.toml</span><br><span class="line"></span><br><span class="line">3. 编辑 config/config.toml 添加 API 密钥和自定义设置：(注: model和base_url在deepseek充值界面接口文档就可以看到)</span><br><span class="line"></span><br><span class="line"># Global LLM configuration</span><br><span class="line">[llm]</span><br><span class="line">model = &quot;deepseek-chat&quot;</span><br><span class="line">base_url = &quot;https://api.deepseek.com&quot;</span><br><span class="line">api_key = &quot;sk-8.....9ff89&quot;</span><br><span class="line">max_tokens = 4096</span><br><span class="line">temperature = 0.0</span><br><span class="line"></span><br><span class="line"># [llm] #AZURE OPENAI:</span><br><span class="line"># api_type= &#x27;azure&#x27;</span><br><span class="line"># model = &quot;YOUR_MODEL_NAME&quot; #&quot;gpt-4o-mini&quot;</span><br><span class="line"># base_url = &quot;&#123;YOUR_AZURE_ENDPOINT.rstrip(&#x27;/&#x27;)&#125;/openai/deployments/&#123;AZURE_DEPOLYMENT_ID&#125;&quot;</span><br><span class="line"># api_key = &quot;AZURE API KEY&quot;</span><br><span class="line"># max_tokens = 8096</span><br><span class="line"># temperature = 0.0</span><br><span class="line"># api_version=&quot;AZURE API VERSION&quot; #&quot;2024-08-01-preview&quot;</span><br><span class="line"></span><br><span class="line"># Optional configuration for specific LLM models</span><br><span class="line">[llm.vision]</span><br><span class="line">model = &quot;claude-3-5-sonnet&quot;</span><br><span class="line">base_url = &quot;https://api.openai.com/v1&quot;</span><br><span class="line">api_key = &quot;sk-...&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python main.py</span><br></pre></td></tr></table></figure>

<p>输出如下: </p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">INFO     [browser_use] BrowserUse logging setup complete with level info</span><br><span class="line">INFO     [root] Anonymized telemetry enabled. See https://docs.browser-use.com/development/telemetry for more information.</span><br><span class="line">Enter your prompt (or &#x27;exit&#x27;/&#x27;quit&#x27; to quit): (这里就是发挥创意的地方了)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="一些小问题处理"><a href="#一些小问题处理" class="headerlink" title="一些小问题处理"></a>一些小问题处理</h1><h2 id="目前内部默认采用的是google搜索，国内不好用，调整为bing搜索"><a href="#目前内部默认采用的是google搜索，国内不好用，调整为bing搜索" class="headerlink" title="目前内部默认采用的是google搜索，国内不好用，调整为bing搜索"></a>目前内部默认采用的是google搜索，国内不好用，调整为bing搜索</h2><ol>
<li>在app/tool/目录，加bing_search.py<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> asyncio</span><br><span class="line"><span class="keyword">from</span> typing <span class="keyword">import</span> <span class="type">List</span></span><br><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> quote</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line"><span class="keyword">from</span> app.tool.base <span class="keyword">import</span> BaseTool</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BingSearch</span>(<span class="title class_ inherited__">BaseTool</span>):</span><br><span class="line">    name: <span class="built_in">str</span> = <span class="string">&quot;bing_search&quot;</span></span><br><span class="line">    description: <span class="built_in">str</span> = <span class="string">&quot;&quot;&quot;执行必应搜索并返回相关链接列表。</span></span><br><span class="line"><span class="string">当需要获取国际信息或英文内容时建议使用此工具。</span></span><br><span class="line"><span class="string">工具返回与搜索查询匹配的URL列表。&quot;&quot;&quot;</span></span><br><span class="line">    parameters: <span class="built_in">dict</span> = &#123;</span><br><span class="line">        <span class="string">&quot;type&quot;</span>: <span class="string">&quot;object&quot;</span>,</span><br><span class="line">        <span class="string">&quot;properties&quot;</span>: &#123;</span><br><span class="line">            <span class="string">&quot;query&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;string&quot;</span>,</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;(必填) 提交给必应的搜索关键词&quot;</span></span><br><span class="line">            &#125;,</span><br><span class="line">            <span class="string">&quot;num_results&quot;</span>: &#123;</span><br><span class="line">                <span class="string">&quot;type&quot;</span>: <span class="string">&quot;integer&quot;</span>,</span><br><span class="line">                <span class="string">&quot;description&quot;</span>: <span class="string">&quot;(可选) 返回的搜索结果数量，默认10&quot;</span>,</span><br><span class="line">                <span class="string">&quot;default&quot;</span>: <span class="number">10</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="string">&quot;required&quot;</span>: [<span class="string">&quot;query&quot;</span>]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">async</span> <span class="keyword">def</span> <span class="title function_">execute</span>(<span class="params">self, query: <span class="built_in">str</span>, num_results: <span class="built_in">int</span> = <span class="number">10</span></span>) -&gt; <span class="type">List</span>[<span class="built_in">str</span>]:</span><br><span class="line">        <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">        执行必应搜索并返回URL列表</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            query: 搜索关键词</span></span><br><span class="line"><span class="string">            num_results: 返回结果数量</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            匹配搜索结果的URL列表</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">def</span> <span class="title function_">sync_search</span>():</span><br><span class="line">            headers = &#123;</span><br><span class="line">                <span class="string">&#x27;User-Agent&#x27;</span>: <span class="string">&#x27;Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36&#x27;</span>,</span><br><span class="line">                <span class="string">&#x27;Accept-Language&#x27;</span>: <span class="string">&#x27;en-US,en;q=0.9&#x27;</span></span><br><span class="line">            &#125;</span><br><span class="line">            url = <span class="string">f&#x27;https://www.bing.com/search?q=<span class="subst">&#123;quote(query)&#125;</span>&#x27;</span></span><br><span class="line">            links = []</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> page <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, num_results // <span class="number">10</span> + <span class="number">1</span>):</span><br><span class="line">                resp = requests.get(</span><br><span class="line">                    <span class="string">f&#x27;<span class="subst">&#123;url&#125;</span>&amp;first=<span class="subst">&#123;page * <span class="number">10</span>&#125;</span>&#x27;</span>,</span><br><span class="line">                    headers=headers,</span><br><span class="line">                    timeout=<span class="number">10</span></span><br><span class="line">                )</span><br><span class="line">                soup = BeautifulSoup(resp.text, <span class="string">&#x27;html.parser&#x27;</span>)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">for</span> result <span class="keyword">in</span> soup.select(<span class="string">&#x27;.b_algo&#x27;</span>):</span><br><span class="line">                    link = result.find(<span class="string">&#x27;a&#x27;</span>, href=<span class="literal">True</span>)</span><br><span class="line">                    <span class="keyword">if</span> link <span class="keyword">and</span> <span class="string">&#x27;href&#x27;</span> <span class="keyword">in</span> link.attrs:</span><br><span class="line">                        links.append(link[<span class="string">&#x27;href&#x27;</span>])</span><br><span class="line">                        <span class="keyword">if</span> <span class="built_in">len</span>(links) &gt;= num_results:</span><br><span class="line">                            <span class="keyword">return</span> links</span><br><span class="line">            rst = links[:num_results]</span><br><span class="line">            <span class="keyword">return</span> rst</span><br><span class="line"></span><br><span class="line">        loop = asyncio.get_event_loop()</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">await</span> loop.run_in_executor(<span class="literal">None</span>, sync_search)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>agent/manus.py 中添加 BingSearch<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pydantic <span class="keyword">import</span> Field</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> app.agent.toolcall <span class="keyword">import</span> ToolCallAgent</span><br><span class="line"><span class="keyword">from</span> app.prompt.manus <span class="keyword">import</span> NEXT_STEP_PROMPT, SYSTEM_PROMPT</span><br><span class="line"><span class="keyword">from</span> app.tool <span class="keyword">import</span> Terminate, ToolCollection</span><br><span class="line"><span class="keyword">from</span> app.tool.browser_use_tool <span class="keyword">import</span> BrowserUseTool</span><br><span class="line"><span class="keyword">from</span> app.tool.file_saver <span class="keyword">import</span> FileSaver</span><br><span class="line"><span class="keyword">from</span> app.tool.google_search <span class="keyword">import</span> GoogleSearch</span><br><span class="line"><span class="comment"># 一定要先引入</span></span><br><span class="line"><span class="keyword">from</span> app.tool.bing_search <span class="keyword">import</span> BingSearch</span><br><span class="line"><span class="keyword">from</span> app.tool.python_execute <span class="keyword">import</span> PythonExecute</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Manus</span>(<span class="title class_ inherited__">ToolCallAgent</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    A versatile general-purpose agent that uses planning to solve various tasks.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    This agent extends PlanningAgent with a comprehensive set of tools and capabilities,</span></span><br><span class="line"><span class="string">    including Python execution, web browsing, file operations, and information retrieval</span></span><br><span class="line"><span class="string">    to handle a wide range of user requests.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    name: <span class="built_in">str</span> = <span class="string">&quot;Manus&quot;</span></span><br><span class="line">    description: <span class="built_in">str</span> = (</span><br><span class="line">        <span class="string">&quot;A versatile agent that can solve various tasks using multiple tools&quot;</span></span><br><span class="line">    )</span><br><span class="line"></span><br><span class="line">    system_prompt: <span class="built_in">str</span> = SYSTEM_PROMPT</span><br><span class="line">    next_step_prompt: <span class="built_in">str</span> = NEXT_STEP_PROMPT</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Add general-purpose tools to the tool collection</span></span><br><span class="line">    <span class="comment"># 注意这里添加BingSearch</span></span><br><span class="line">    available_tools: ToolCollection = Field(</span><br><span class="line">        default_factory=<span class="keyword">lambda</span>: ToolCollection(</span><br><span class="line">            PythonExecute(), GoogleSearch(), BingSearch(), BrowserUseTool(), FileSaver(), Terminate()</span><br><span class="line">        )</span><br><span class="line">    )</span><br></pre></td></tr></table></figure></li>
<li>prompt/manus.py 修改GoogleSearch为BingSearch<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/GoogleSearch/BingSearch/g&#x27;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>参考: <a target="_blank" rel="noopener" href="https://github.com/mannaandpoem/OpenManus/issues/277">https://github.com/mannaandpoem/OpenManus/issues/277</a></p>
<h1 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h1><ol>
<li>查找中国 前十高校，通过csv格式返回到跟目录，只需要有学校名称 、排名、官网即可</li>
</ol>
<p>实际测试，这玩意儿还是bug不少，跑了十几分钟结果没出结果，白瞎了我的token :D。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>速度真的是挺慢，但是能够自己主动去搜索解决问题也算是挺牛了，对于技术人员来说又多了一个玩具。</p>
<p>这种主动去思考解决问题的思想比较有意思，在其它平台定义工作流时候可以借鉴这种方案，创建自己的manus，加油!!</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/02/27/%E6%8A%80%E6%9C%AF%E7%9A%84%E6%9D%82%E4%B8%8E%E7%B2%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/27/%E6%8A%80%E6%9C%AF%E7%9A%84%E6%9D%82%E4%B8%8E%E7%B2%BE/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-02-27 00:06:39" itemprop="dateCreated datePublished" datetime="2025-02-27T00:06:39+08:00">2025-02-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/02/27/%E6%9C%89%E4%BA%86AI%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E8%80%83%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/27/%E6%9C%89%E4%BA%86AI%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E8%80%83%E8%AF%81/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-02-27 00:06:39" itemprop="dateCreated datePublished" datetime="2025-02-27T00:06:39+08:00">2025-02-27</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/02/26/%E4%BC%81%E4%B8%9A%E7%9F%A5%E8%AF%86%E5%BA%93%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2025/02/26/%E4%BC%81%E4%B8%9A%E7%9F%A5%E8%AF%86%E5%BA%93%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">企业知识库落地实践</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2025-02-26 00:00:00" itemprop="dateCreated datePublished" datetime="2025-02-26T00:00:00+08:00">2025-02-26</time>
            </span>

          

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="为什么企业要搭建本地知识库"><a href="#为什么企业要搭建本地知识库" class="headerlink" title="为什么企业要搭建本地知识库"></a>为什么企业要搭建本地知识库</h1><p>在当今信息爆炸的时代，企业面临着海量数据和知识的管理挑战。搭建本地知识库已成为企业提升效率和竞争力的重要手段。以下是企业搭建本地知识库的几个核心原因：</p>
<h2 id="解决碎片化问题"><a href="#解决碎片化问题" class="headerlink" title="解决碎片化问题"></a>解决碎片化问题</h2><p>企业多年积累的知识比较碎片化，很多也慢慢流于形式。使用知识库可以将这些碎片化知识重新整合，并且通过大模型学习进行分类整合，充分发挥知识的价值。</p>
<h2 id="提升效率和创新能力"><a href="#提升效率和创新能力" class="headerlink" title="提升效率和创新能力"></a>提升效率和创新能力</h2><p>通过知识库的整合，员工不需要在茫茫的文档中查找，可以基于统一的入口去查找需要的东西。而且随着知识越发丰富，模型也会越来越强大，可以将海量知识组合，创造出新的想法。</p>
<h2 id="提高安全性"><a href="#提高安全性" class="headerlink" title="提高安全性"></a>提高安全性</h2><p>相对于将知识全部放在公网知识库中，本地知识库可以有效保护企业的核心知识和技术，防止人员流动以及公网安全性导致的知识缺失。</p>
<h1 id="企业知识库的目标"><a href="#企业知识库的目标" class="headerlink" title="企业知识库的目标"></a>企业知识库的目标</h1><p>不同于通用大模型，企业知识库最重要的就是，专业性和准确性。知识库应该是垂直领域的，基于企业的核心业务，结合各种内部的文档进行知识的整合，使得行业知识逻辑更加清晰完整，并且数据来源是内部文档，所以对比通用大模型会更加准确。</p>
<h1 id="搭建知识库的痛点"><a href="#搭建知识库的痛点" class="headerlink" title="搭建知识库的痛点"></a>搭建知识库的痛点</h1><h2 id="技术难度"><a href="#技术难度" class="headerlink" title="技术难度"></a>技术难度</h2><p>个人原型搭建相对简单，但企业级部署需考虑权限管理、版本控制、审计追踪等复杂需求。</p>
<h2 id="回答不够准确"><a href="#回答不够准确" class="headerlink" title="回答不够准确"></a>回答不够准确</h2><p>回答准确性问题可能是知识库构建最麻烦的地方，不同的人，不同的团队写出的文档格式千奇百怪。而且有些知识是从网上下载，没有专门做整理就作为知识文档保留下来。知识库采用RAG（检索增强生成）技术，通过语义检索获取相关文档片段，再结合生成模型输出答案，不同分块的方式，大小都会导致知识库的回答不一定准确。下面以用户使用手册为例，来解决这些问题。</p>
<h1 id="合理文档格式的重要性及模板参考"><a href="#合理文档格式的重要性及模板参考" class="headerlink" title="合理文档格式的重要性及模板参考"></a>合理文档格式的重要性及模板参考</h1><p>一般网上搜到知识库的搭建都是给你搞个embedding模型，或者根据什么换行之类的东西直接分块，但是这种方式对于企业知识库没什么用，因为文档真的太乱了。可能你换行的、用模型处理后的内容语义本身就不连续，有的段落内容多，有的少，有的可能多个分段是一个语义环境。目前只是专业的人才能够去理解真正哪些内容是一个语义环境。所以目前我的想法是可以通过人工干预，将文档按照格式整理，在通过程序增加分割符，然后在文档分块时，通过分割符号来处理，保证语义的完整性。下边给出一个简单的操作手册片段:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">** 功能1：[功能名称]</span><br><span class="line"></span><br><span class="line">*** 功能描述</span><br><span class="line">简要描述功能1的主要用途和实现目标。</span><br><span class="line"></span><br><span class="line">*** 菜单路径</span><br><span class="line">- 主菜单：[具体菜单路径]</span><br><span class="line">- 快捷方式：[快捷键或图标]</span><br><span class="line"></span><br><span class="line">*** 操作步骤</span><br><span class="line">1. 打开软件，进入主界面。</span><br><span class="line">   [[file:功能1_步骤1.png]]</span><br><span class="line">2. 点击“[菜单名称]”，选择“[子菜单名称]”。</span><br><span class="line">   [[file:功能1_步骤2.png]]</span><br><span class="line">3. 在弹出的窗口中，输入相关信息（如用户名、密码等）。</span><br><span class="line">   [[file:功能1_步骤3.png]]</span><br><span class="line">4. 点击“确定”按钮，完成操作。</span><br><span class="line">   [[file:功能1_步骤4.png]]</span><br><span class="line"></span><br><span class="line">*** 注意事项</span><br><span class="line">- 确保输入的信息准确无误。</span><br><span class="line">- 如果遇到错误提示，请参考“常见问题”部分。</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line"></span><br><span class="line">** 功能2：[功能名称]</span><br><span class="line"></span><br><span class="line">*** 功能描述</span><br><span class="line">简要描述功能2的主要用途和实现目标。</span><br><span class="line"></span><br><span class="line">*** 菜单路径</span><br><span class="line">- 主菜单：[具体菜单路径]</span><br><span class="line">- 快捷方式：[快捷键或图标]</span><br><span class="line"></span><br><span class="line">*** 操作步骤</span><br><span class="line">1. 打开软件，进入主界面。</span><br><span class="line">   [[file:功能2_步骤1.png]]</span><br><span class="line">2. 点击“[菜单名称]”，选择“[子菜单名称]”。</span><br><span class="line">   [[file:功能2_步骤2.png]]</span><br><span class="line">3. 在弹出的窗口中，选择所需选项（如文件类型、格式等）。</span><br><span class="line">   [[file:功能2_步骤3.png]]</span><br><span class="line">4. 点击“保存”按钮，完成操作。</span><br><span class="line">   [[file:功能2_步骤4.png]]</span><br><span class="line"></span><br><span class="line">*** 注意事项</span><br><span class="line">- 在保存文件时，建议选择合适的文件格式。</span><br><span class="line">- 如果文件过大，可能会导致保存时间较长。</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>对于上述文档，我们可以按照层次结构添加分隔符，比如按照<em>的个数，两个</em>作为二级标题，然后在功能2前增加======split=====作为分隔符，效果如下。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">** 功能1：[功能名称]</span><br><span class="line">内容同上</span><br><span class="line">---</span><br><span class="line">=====split=====</span><br><span class="line">** 功能2：[功能名称]</span><br><span class="line">内容同上</span><br><span class="line">=====split=====</span><br><span class="line">** 功能3：[功能名称]</span><br><span class="line">内容同上</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>此时将上述内容按照=====split=====分隔传入知识库，会将相同语义的内容放到单独的块中。在中知识搜索时，通过向量匹配的内容就会相对完整准确。</p>
<h1 id="如何让知识库模型不乱说"><a href="#如何让知识库模型不乱说" class="headerlink" title="如何让知识库模型不乱说"></a>如何让知识库模型不乱说</h1><p>其实光是知识库内容完整还不够，将知识库搜索结果作为提问的上下文仍然无法阻止模型自己的”发明创造”，这种结果是企业知识库无法接受的。这时候就需要对模型增加一些约束，此时就是prompt大显身手了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">你是xx企业业务专家。你的回答应基于以下规则：</span><br><span class="line">1. 使用提供的上下文（&lt;context&gt;&lt;/context&gt;）作为你的知识来源。</span><br><span class="line">2. 如果上下文中有相关信息，请直接根据上下文回答。</span><br><span class="line">3. 如果上下文中没有相关信息，请直接说“我不知道”或请求用户提供更多信息。</span><br><span class="line">4. 当且仅当上下文包含相关信息时，用自然对话方式输出答案；否则明确告知&#x27;该问题不在知识库覆盖范围内。</span><br><span class="line">5. 根据用户提问的语言（如中文或英文）来回答。</span><br><span class="line">必需行为:</span><br><span class="line">- 知识库存在的内容必须全部包含，并且不能改变上下文语义</span><br><span class="line">禁止行为：</span><br><span class="line">- 禁止任何形式的内容编造</span><br><span class="line">- 禁止使用&quot;根据我的知识&quot;等模糊表述</span><br><span class="line">- 禁止扩展知识库外的信息</span><br><span class="line">- 禁止引入聊天上下文中无关内容，优先使用context中内容</span><br><span class="line"></span><br><span class="line">Context: &lt;context&gt;</span><br><span class="line">&#123;&#123;#context#&#125;&#125;</span><br><span class="line">&lt;/context&gt;</span><br></pre></td></tr></table></figure>

<p>仔细看下上述prompt就知道它是怎么工作了，其它限制可以按照企业需要继续扩展，按照知识库返回结果逐步优化。</p>
<h1 id="实施计划"><a href="#实施计划" class="headerlink" title="实施计划"></a>实施计划</h1><h2 id="分阶段实施建议"><a href="#分阶段实施建议" class="headerlink" title="分阶段实施建议"></a>分阶段实施建议</h2><ol>
<li>知识盘点阶段（1-2周）：成立跨部门小组，梳理核心知识资产</li>
<li>规范制定阶段（2-4周）：建立文档编写标准和审核流程</li>
<li>试点运行阶段（4-8周）：选择3-5个关键业务模块进行验证</li>
<li>全面推广阶段（8-12周）：基于试点经验完善系统后全面部署<h2 id="质量评估"><a href="#质量评估" class="headerlink" title="质量评估"></a>质量评估</h2></li>
<li>准确率（Accuracy）：人工抽检回答正确性</li>
<li>召回率（Recall）：测试集问题解决率<h1 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h1>希望本文的分享能帮助大家在搭建和使用本地知识库时更加得心应手，祝大家实践成功！</li>
</ol>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mr.zhao"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Mr.zhao</p>
  <div class="site-description" itemprop="description">show me your code</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">58</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">31</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">86</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/zhaozhiwei1992" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhaozhiwei1992" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/p205/posts" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;p205&#x2F;posts" rel="noopener" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/65f51bc73109" title="简书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;65f51bc73109" rel="noopener" target="_blank"><i class="fas fa-book-open fa-fw"></i>简书</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/qq347061329" title="博客园 → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;qq347061329" rel="noopener" target="_blank"><i class="fab fa-blog fa-fw"></i>博客园</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/u012768510" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;u012768510" rel="noopener" target="_blank"><i class="fas fa-code fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhaozhiweishanxi@gmail.com" title="E-Mail → mailto:zhaozhiweishanxi@gmail.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Mr.zhao</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script size="300" alpha="0.6" zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
