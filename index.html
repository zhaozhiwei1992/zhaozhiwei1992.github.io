<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"zhaozhiwei1992.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"style":null,"show_result":false},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="show me your code">
<meta property="og:type" content="website">
<meta property="og:title" content="离线de日常">
<meta property="og:url" content="http://zhaozhiwei1992.github.io/index.html">
<meta property="og:site_name" content="离线de日常">
<meta property="og:description" content="show me your code">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="Mr.zhao">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://zhaozhiwei1992.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>离线de日常</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">离线de日常</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Mr.zhao"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">Mr.zhao</p>
  <div class="site-description" itemprop="description">show me your code</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">59</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">33</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">88</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/zhaozhiwei1992" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;zhaozhiwei1992" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.zhihu.com/people/p205/posts" title="知乎 → https:&#x2F;&#x2F;www.zhihu.com&#x2F;people&#x2F;p205&#x2F;posts" rel="noopener me" target="_blank"><i class="fab fa-zhihu fa-fw"></i>知乎</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.jianshu.com/u/65f51bc73109" title="简书 → https:&#x2F;&#x2F;www.jianshu.com&#x2F;u&#x2F;65f51bc73109" rel="noopener me" target="_blank"><i class="fas fa-book-open fa-fw"></i>简书</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://www.cnblogs.com/qq347061329" title="博客园 → https:&#x2F;&#x2F;www.cnblogs.com&#x2F;qq347061329" rel="noopener me" target="_blank"><i class="fab fa-blog fa-fw"></i>博客园</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/u012768510" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;u012768510" rel="noopener me" target="_blank"><i class="fas fa-code fa-fw"></i>CSDN</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:zhaozhiweishanxi@gmail.com" title="E-Mail → mailto:zhaozhiweishanxi@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2026/02/25/openclaw%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2026/02/25/openclaw%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">openclaw实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2026-02-25 08:00:00" itemprop="dateCreated datePublished" datetime="2026-02-25T08:00:00+08:00">2026-02-25</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/penclaw%E3%80%81AI/" itemprop="url" rel="index"><span itemprop="name">penclaw、AI</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="什么是openclaw以及能做什么"><a href="#什么是openclaw以及能做什么" class="headerlink" title="什么是openclaw以及能做什么"></a>什么是openclaw以及能做什么</h1><p>OpenClaw（曾用名：Clawdbot、Moltbot），一款可以部署在个人电脑上的AI代理，采用”龙虾”图标设计，slogan是”The<br>AI that actually does things”，由程序员彼得·斯坦伯格开发。</p>
<p>个人主要关注它能够关联telegram，飞书等作为客户端，这样能够很方便的通过移动端来进行控制。它本身权限也足够，理论上可以在个人电脑操作一切，一些运维工作，文档处理，聊天，邮件等都可以进行处理。但是一定要注意安全性，安全性，安全性。</p>
<h1 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h1><h2 id="环境准备"><a href="#环境准备" class="headerlink" title="环境准备"></a>环境准备</h2><figure class="highlight plaintext"><figcaption><span>org-language</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># node版本要在22+, 为了避免环境依赖，并且本地存在多个node版本，可以考虑用nvm来管理</span><br><span class="line">nvm use 22.14.0</span><br><span class="line"></span><br><span class="line"># 操作系统</span><br><span class="line">archlinux</span><br></pre></td></tr></table></figure>

<h2 id="apikey"><a href="#apikey" class="headerlink" title="apikey"></a>apikey</h2><p>我这里使用的是智谱的那个code plan,<br>glm4.7，多说一句，这个plan只支持部分工具，包括claude code, openclaw,<br>cline等，不能直接在dify等工作流使用的，一定要注意，按需选择。</p>
<h2 id="清理"><a href="#清理" class="headerlink" title="清理"></a>清理</h2><p>如果之前安装过但是没成功，最好先备份配置目录，然后全部删除，防止影响。</p>
<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><p>目前其实存在两个版本，如果不纠结英文可以用原版，或者可以考虑中文版本。</p>
<h2 id="安装配置"><a href="#安装配置" class="headerlink" title="安装配置"></a>安装配置</h2><figure class="highlight plaintext"><figcaption><span>org-language</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">1. install</span><br><span class="line">  pnpm add -g openclaw@latest</span><br><span class="line">2. Run the onboarding wizard</span><br><span class="line">  openclaw onboard --install-daemon</span><br></pre></td></tr></table></figure>

<h2 id="快速开始引导"><a href="#快速开始引导" class="headerlink" title="快速开始引导"></a>快速开始引导</h2><p>快速开始保持默认设置：</p>
<p>本地网关（回环） 工作区默认设置（或现有工作区） 网关端口 18789<br>网关认证令牌（自动生成，即使是回环） Tailscale 暴露关闭 Telegram +<br>WhatsApp 私信默认为白名单（这里第一次可以先不配置,<br>如果需要可以看对接telegram配置部分）</p>
<p>配置模型key</p>
<h2 id="检查网关"><a href="#检查网关" class="headerlink" title="检查网关"></a>检查网关</h2><figure class="highlight plaintext"><figcaption><span>org-language</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">如果您安装了服务，它应该已经在运行：</span><br><span class="line">openclaw gateway status</span><br></pre></td></tr></table></figure>

<h2 id="界面访问"><a href="#界面访问" class="headerlink" title="界面访问"></a>界面访问</h2><figure class="highlight plaintext"><figcaption><span>org-language</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 国内版</span><br><span class="line">openclaw-cn dashboard --no-open |xclip -selection c</span><br><span class="line"></span><br><span class="line"># linux下使用下述命令会生成一个url, 直接浏览器访问即可, windows下可以直接查看openclaw.json配置文件中的token</span><br><span class="line">openclaw dashboard --no-open |xclip -selection c</span><br><span class="line"></span><br><span class="line">http://127.0.0.1:18789/?token=58bfd507741fae2e3ee10aaab291c5d1765aae0a731f2b5b</span><br></pre></td></tr></table></figure>

<p>此时在界面上发一个简单的测试，正常有回复即表示成功。后续怎么使用就看个人发挥了。</p>
<h1 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h1><h2 id="检查网关-1"><a href="#检查网关-1" class="headerlink" title="检查网关"></a>检查网关</h2><figure class="highlight plaintext"><figcaption><span>org-language</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">openclaw gateway status</span><br></pre></td></tr></table></figure>

<h2 id="重启网关"><a href="#重启网关" class="headerlink" title="重启网关"></a>重启网关</h2><p>openclaw gateway restart</p>
<h2 id="更新-国内版"><a href="#更新-国内版" class="headerlink" title="更新(国内版)"></a>更新(国内版)</h2><p>有坑，国内版升级1.6.0直接噶了。 npm i -g openclaw-cn@latest<br>–registry&#x3D;<a href="https://registry.npmmirror.com/">https://registry.npmmirror.com</a> &amp;&amp; openclaw-cn doctor &amp;&amp;<br>openclaw-cn gateway restart</p>
<h1 id="配置文件-重要"><a href="#配置文件-重要" class="headerlink" title="配置文件(重要)"></a>配置文件(重要)</h1><p>~&#x2F;.openclaw&#x2F;openclaw.json</p>
<h1 id="对接telegram"><a href="#对接telegram" class="headerlink" title="对接telegram"></a>对接telegram</h1><p>通过telegram作为openclaw的前端，可以远程通过telegram查看一些本地内容。比如查看自己的待办事项，添加一些小想法。甚至如果是开发人员，都可以用手机来控制电脑写代码。</p>
<p>默认使用长轮询；如果有公网更推荐使用webhook来处理。</p>
<h2 id="创建机器人"><a href="#创建机器人" class="headerlink" title="创建机器人"></a>创建机器人</h2><ol>
<li>打开 Telegram 并与 @BotFather对话。确认用户名确实是 @BotFather。</li>
<li>运行 &#x2F;newbot，然后按照提示操作（名称 + 以 bot 结尾的用户名）。</li>
<li>复制 token 并安全保存。</li>
</ol>
<h2 id="设置-token"><a href="#设置-token" class="headerlink" title="设置 token"></a>设置 token</h2><p>环境变量：TELEGRAM_BOT_TOKEN&#x3D;… 或配置：channels.telegram.botToken:<br>&quot;…&quot;。</p>
<h2 id="重启-Gateway-网关"><a href="#重启-Gateway-网关" class="headerlink" title="重启 Gateway 网关"></a>重启 Gateway 网关</h2><p>私信访问默认使用配对模式；首次联系时需要批准配对码。</p>
<h2 id="最小配置"><a href="#最小配置" class="headerlink" title="最小配置"></a>最小配置</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">channels:</span> &#123;</span><br><span class="line">    <span class="attr">telegram:</span> &#123;</span><br><span class="line">      <span class="attr">enabled:</span> <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">botToken:</span> <span class="string">&quot;123:abc&quot;</span>,</span><br><span class="line">      <span class="attr">dmPolicy:</span> <span class="string">&quot;pairing&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;proxy&quot;:</span> <span class="string">&quot;http://10.11.12.164:7890&quot;</span> <span class="comment"># 注意这里如果环境不允许，需要增加一个属性，否则一直无法给telegram发消息。</span></span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;<span class="string">​</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="生成配对码"><a href="#生成配对码" class="headerlink" title="生成配对码"></a>生成配对码</h2><p>在telgram机器人选择start,首次访问会生成配对码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">OpenClaw: access not configured.</span><br><span class="line"></span><br><span class="line">Your Telegram user id: xxxx6</span><br><span class="line"></span><br><span class="line">Pairing code: XGxxxkxj</span><br><span class="line"></span><br><span class="line">Ask the bot owner to approve with:</span><br><span class="line">openclaw pairing approve telegram XGxxxkxj</span><br></pre></td></tr></table></figure>

<h2 id="使用openclaw进行配对"><a href="#使用openclaw进行配对" class="headerlink" title="使用openclaw进行配对"></a>使用openclaw进行配对</h2><p>openclaw pairing list telegram</p>
<p>openclaw pairing approve telegram XGxxxkxj</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>此时就可以直接通过telegram给openclaw下达指令了，可以先发一个<br>测试，等待能够正常回复即可。</p>
<h1 id="其它使用场景"><a href="#其它使用场景" class="headerlink" title="其它使用场景"></a>其它使用场景</h1><h2 id="管理邮件gmail"><a href="#管理邮件gmail" class="headerlink" title="管理邮件gmail"></a>管理邮件gmail</h2><p>生成一些脚本，做一些邮件之类的清理工作。这个用claudecode也行，后续可以不通过openclaw触发。</p>
<h2 id="待续"><a href="#待续" class="headerlink" title="待续"></a>待续</h2><h1 id="问题处理"><a href="#问题处理" class="headerlink" title="问题处理"></a>问题处理</h1><h2 id="Webchat-UI-fails-to-authenticate-gateway-token-missing-even-with-token-in-URL-1690"><a href="#Webchat-UI-fails-to-authenticate-gateway-token-missing-even-with-token-in-URL-1690" class="headerlink" title="Webchat UI fails to authenticate: &#39;gateway token missing&#39; even with token in URL #1690"></a>Webchat UI fails to authenticate: &#39;gateway token missing&#39; even with token in URL #1690</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">使用命令行获取带令牌的链接</span><br><span class="line">在终端中运行以下命令：</span><br><span class="line">openclaw-cn dashboard --no-open</span><br><span class="line">此命令会：</span><br><span class="line">自动生成带令牌的仪表板链接</span><br><span class="line">将链接复制到剪贴板</span><br><span class="line">显示链接但不会自动打开浏览器</span><br><span class="line">然后复制输出的链接并在浏览器中打开，即可自动带令牌访问 Web 页面。</span><br></pre></td></tr></table></figure>

<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://clawd.org.cn/gateway/token-mismatch-troubleshooting">https://clawd.org.cn/gateway/token-mismatch-troubleshooting</a></p>
<p><a href="https://clawd.org.cn/">https://clawd.org.cn/</a></p>
<p><a href="https://github.com/openclaw/openclaw">https://github.com/openclaw/openclaw</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/11/12/%E6%B5%8B%E8%AF%95blog/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/12/%E6%B5%8B%E8%AF%95blog/" class="post-title-link" itemprop="url">测试blog</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-12 16:55:59" itemprop="dateCreated datePublished" datetime="2025-11-12T16:55:59+08:00">2025-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>一个测试112</p>
<p>测试评论</p>
<p>测试nas下jenkins打包2</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/11/12/%E8%BD%AF%E4%BB%B6%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/12/%E8%BD%AF%E4%BB%B6%E6%A6%82%E8%A6%81%E8%AE%BE%E8%AE%A1%E8%AF%B4%E6%98%8E/" class="post-title-link" itemprop="url">软件概要设计说明</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-12 15:40:02" itemprop="dateCreated datePublished" datetime="2025-11-12T15:40:02+08:00">2025-11-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">软件设计</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="封面"><a href="#封面" class="headerlink" title="封面"></a>封面</h1><p>::: {.center}<br><strong>xx公司</strong></p>
<p><strong>2020-01-01</strong><br>:::</p>
<p><strong>文档管理</strong></p>
<p>合理地管理主文档，确保文档版本的及时更新，同时保持备份文档和源文档的一致性。</p>
<p><strong>版本管理</strong></p>
<hr>
<p>本版本修订日期   2019-08-12   生效日期   2019-08-12</p>
<hr>
<p>版本   生效日期     变更内容       编制人</p>
<hr>
<p>V1.0   2020-01-01   初稿编写完成   xx</p>
<h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><h2 id="编写目的"><a href="#编写目的" class="headerlink" title="编写目的"></a>编写目的</h2><p>说明编写这份概要设计说明书的目的，指出预期的读者。（对于由多个子系统构成的系统，可以根据需要针对子系统编写单独的软件概要设计说明）</p>
<h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>说明：</p>
<p>待开发软件系统的名称；</p>
<p>列出此项目的任务提出者、开发者、用户以及将运行该软件的位置；</p>
<h2 id="术语和缩略语"><a href="#术语和缩略语" class="headerlink" title="术语和缩略语"></a>术语和缩略语</h2><p>列出本文件中用到的专门术语的定义和外文首字母组词的原词组。</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p>列出有关的参考文件，如：</p>
<p>本项目的经核准的计划任务书或合同，上级机关的批文；</p>
<p>属于本项目的其他已编制文件；</p>
<p>本文件中各处引用的文件、资料，包括所要用到的软件开发标准、专业技术标准。列出这些文件的标题、文件编号、发表日期、出版单位和来源。</p>
<h1 id="总体设计"><a href="#总体设计" class="headerlink" title="总体设计"></a>总体设计</h1><h2 id="需求规定"><a href="#需求规定" class="headerlink" title="需求规定"></a>需求规定</h2><p>说明对本系统的主要的输入输出项目、处理的功能性能要求。可以引用软件规格说明文档以避免重复。</p>
<h2 id="运行环境"><a href="#运行环境" class="headerlink" title="运行环境"></a>运行环境</h2><p>简要地说明对本系统的运行环境（包括硬件环境和支持环境）的规定。</p>
<h2 id="设计思想"><a href="#设计思想" class="headerlink" title="设计思想"></a>设计思想</h2><h3 id="系统构思"><a href="#系统构思" class="headerlink" title="系统构思"></a>系统构思</h3><p>说明本系统设计的系统构思。</p>
<h3 id="关键技术与算法"><a href="#关键技术与算法" class="headerlink" title="关键技术与算法"></a>关键技术与算法</h3><p>说明本系统设计采用的关键技术和主要算法。</p>
<h3 id="关键数据结构"><a href="#关键数据结构" class="headerlink" title="关键数据结构"></a>关键数据结构</h3><p>简要说明本系统实现中的最主要的数据结构。</p>
<h2 id="系统总体结构"><a href="#系统总体结构" class="headerlink" title="系统总体结构"></a>系统总体结构</h2><p>以图表的形式说明本系统的系统元素（各层模块、子模块、公用模块等）的划分，扼要说明各系统元素的标识和功能，分层次说明各系统元素之间的关系。</p>
<h2 id="基本处理流程"><a href="#基本处理流程" class="headerlink" title="基本处理流程"></a>基本处理流程</h2><h3 id="系统流程图"><a href="#系统流程图" class="headerlink" title="系统流程图"></a>系统流程图</h3><p>用流程图的方式说明本系统的主要控制流程和处理流程。</p>
<h3 id="数据流程图"><a href="#数据流程图" class="headerlink" title="数据流程图"></a>数据流程图</h3><p>根据需要，用数据流程图说明本系统的主要数据及其流转过程，并说明流转过程中的处理动作。</p>
<h2 id="功能需求与模块的关系"><a href="#功能需求与模块的关系" class="headerlink" title="功能需求与模块的关系"></a>功能需求与模块的关系</h2><p>说明各项功能需求的实现同各模块的分配关系。要与软件规格说明中的功能编号相一致。</p>
<h2 id="尚未解决的问题"><a href="#尚未解决的问题" class="headerlink" title="尚未解决的问题"></a>尚未解决的问题</h2><p>说明在概要设计过程中尚未解决而设计者认为在系统完成之前必须解决的各个问题。</p>
<h1 id="接口设计"><a href="#接口设计" class="headerlink" title="接口设计"></a>接口设计</h1><h2 id="外部接口"><a href="#外部接口" class="headerlink" title="外部接口"></a>外部接口</h2><p>说明本系统同外界的所有接口设计。包括本系统与硬件之间的接口设计、本系统与各支持软件之间的接口设计、对外提供的接口服务的设计。</p>
<h2 id="内部接口"><a href="#内部接口" class="headerlink" title="内部接口"></a>内部接口</h2><p>说明本系统之内的各个系统元素之间的接口的安排。</p>
<h1 id="性能设计及质量属性考虑"><a href="#性能设计及质量属性考虑" class="headerlink" title="性能设计及质量属性考虑"></a>性能设计及质量属性考虑</h1><p>通过设计落实在软件规格说明中的各种性能及质量属性规定。</p>
<h1 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h1><p>说明本系统内所使用的数据结构设计要点及与程序模块间的关系。对数据库表的设计一般以另文方式（数据库设计说明）给出。</p>
<h1 id="内容审核要点："><a href="#内容审核要点：" class="headerlink" title="内容审核要点："></a>内容审核要点：</h1><p>是否全面考虑了软件需求规格说明文档的功能需求；</p>
<p>所述功能名称及编号与软件需求规格说明文档是否一致；</p>
<p>总体结构是否清晰合理；</p>
<p>是否包括对外提供的接口服务的形式化表述和设计内容；</p>
<p>数据结构设计内容的全面性及合理性；</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://www.jianshu.com/p/a7984927cfb9">https://www.jianshu.com/p/a7984927cfb9</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/11/12/%E6%8A%80%E6%9C%AF%E7%9A%84%E6%9D%82%E4%B8%8E%E7%B2%BE/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/12/%E6%8A%80%E6%9C%AF%E7%9A%84%E6%9D%82%E4%B8%8E%E7%B2%BE/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-12 15:40:02" itemprop="dateCreated datePublished" datetime="2025-11-12T15:40:02+08:00">2025-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/11/12/%E6%9C%89%E4%BA%86AI%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E8%80%83%E8%AF%81/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/11/12/%E6%9C%89%E4%BA%86AI%E6%9B%B4%E4%BC%98%E9%9B%85%E7%9A%84%E8%80%83%E8%AF%81/" class="post-title-link" itemprop="url">未命名</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-11-12 15:40:02" itemprop="dateCreated datePublished" datetime="2025-11-12T15:40:02+08:00">2025-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          
      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/10/30/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/10/30/%E4%BC%81%E4%B8%9A%E5%BE%AE%E4%BF%A1%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%BC%80%E5%8F%91%E6%96%87%E6%A1%A3/" class="post-title-link" itemprop="url">企业微信机器人开发文档</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-10-30 08:00:00" itemprop="dateCreated datePublished" datetime="2025-10-30T08:00:00+08:00">2025-10-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI-%E6%9C%BA%E5%99%A8%E4%BA%BA/" itemprop="url" rel="index"><span itemprop="name">AI,机器人</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="摘要"><a href="#摘要" class="headerlink" title="摘要"></a>摘要</h1><p>如果想让机器人的回复更加灵活可控，使用个人或企业内部的数据资料等，那么就需要构建自己的企业微信机器人。文章列举了构建机器人的过程，如果只是想直接使用，可以直接下载代码构建即可。</p>
<h1 id="前置准备"><a href="#前置准备" class="headerlink" title="前置准备"></a>前置准备</h1><h2 id="环境要求"><a href="#环境要求" class="headerlink" title="环境要求"></a>环境要求</h2><ol>
<li>企业微信管理员权限（用于创建API模式的智能机器人）</li>
<li>具备域名的可公开访问项目</li>
<li>Java 9以下版本需要下载JCE无限制权限策略文件（我直接java17）</li>
</ol>
<h2 id="技术准备"><a href="#技术准备" class="headerlink" title="技术准备"></a>技术准备</h2><h3 id="引入官方代码"><a href="#引入官方代码" class="headerlink" title="引入官方代码"></a>引入官方代码</h3><ol>
<li>从企业微信开发者中心下载官方提供的加解密代码<br><img src="http://43.143.194.245:9000/images/20251030/001_001.png"><br><img src="http://43.143.194.245:9000/images/20251030/001_002.png"></li>
<li>将 com&#x2F;qq&#x2F;weixin&#x2F;mp&#x2F;aes 目录下的所有Java文件复制到您的项目中<br><img src="http://43.143.194.245:9000/images/20251030/001_003.png"></li>
<li>确保相关导入没有问题，无编译错误</li>
</ol>
<h1 id="交互流程"><a href="#交互流程" class="headerlink" title="交互流程"></a>交互流程</h1><p><img src="http://43.143.194.245:9000/images/20251030/001_004.png"></p>
<h1 id="URL验证接口实现"><a href="#URL验证接口实现" class="headerlink" title="URL验证接口实现"></a>URL验证接口实现</h1><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * URL验证接口 (GET请求)</span></span><br><span class="line"><span class="comment">     * 企业微信会调用此接口验证URL有效性</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/push/wechat&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">wechatGet</span><span class="params">(</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;msg_signature&quot;)</span> String msgSignature,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;timestamp&quot;)</span> String timestamp,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;corpid&quot;)</span> String corpid, // 企业id</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;nonce&quot;)</span> String nonce,</span></span><br><span class="line"><span class="params">            <span class="meta">@RequestParam(&quot;echostr&quot;)</span> String echostr)</span> &#123;</span><br><span class="line">        log.info(<span class="string">&quot;验证URL请求的corpid：&#123;&#125;, 签名: &#123;&#125;, 时间戳: &#123;&#125;, 随机数: &#123;&#125;&quot;</span>, </span><br><span class="line">                corpid, msgSignature, timestamp, nonce);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// 使用URL中的corpid初始化加解密工具</span></span><br><span class="line">            <span class="type">WXBizJsonMsgCrypt</span> <span class="variable">wxcpt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WXBizJsonMsgCrypt</span>(sToken, sEncodingAESKey, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            <span class="comment">// 验证URL并获取明文echostr</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">sEchoStr</span> <span class="operator">=</span> wxcpt.VerifyURL(msgSignature, timestamp, nonce, echostr);</span><br><span class="line">            log.info(<span class="string">&quot;验证URL成功, 返回明文: &#123;&#125;&quot;</span>, sEchoStr);</span><br><span class="line">            <span class="keyword">return</span> sEchoStr;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            log.error(<span class="string">&quot;验证URL失败&quot;</span>, e);</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">关键点说明</span><br><span class="line">corpid参数：必须从URL参数中获取，不能使用固定值</span><br><span class="line">返回值：必须返回解密后的明文echostr，不能包含其他内容</span><br><span class="line">异常处理：必须捕获所有异常并记录日志，但对外返回简洁信息</span><br></pre></td></tr></table></figure>

<h1 id="接收消息接口实现"><a href="#接收消息接口实现" class="headerlink" title="接收消息接口实现"></a>接收消息接口实现</h1><h2 id="数据结构定义"><a href="#数据结构定义" class="headerlink" title="数据结构定义"></a>数据结构定义</h2><figure class="highlight plaintext"><figcaption><span>org-language</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@Data</span><br><span class="line">public static class RobotData &#123;</span><br><span class="line">    private String tousername; // 接收方企业微信ID</span><br><span class="line">    private String encrypt;    // 加密的消息内容</span><br><span class="line">    private String agentid;    // 应用ID</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="接口代码"><a href="#接口代码" class="headerlink" title="接口代码"></a>接口代码</h2><p>这里代码如果看着比较复杂，可以直接下载tag:<br>v0.1版本，只是做了简单的文本回复测试。这里代码是已经打通百炼。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 接收消息接口 (POST请求)</span></span><br><span class="line"><span class="comment"> * 企业微信会将用户发送给机器人的消息推送到此接口</span></span><br><span class="line"><span class="comment"> * &#123;</span></span><br><span class="line"><span class="comment"> *     &quot;msgid&quot;: &quot;CAIQ16HMjQYY/NGagIOAgAMgq4KM0AI=&quot;,</span></span><br><span class="line"><span class="comment"> *     &quot;aibotid&quot;: &quot;AIBOTID&quot;,</span></span><br><span class="line"><span class="comment"> *     &quot;chatid&quot;: &quot;CHATID&quot;,</span></span><br><span class="line"><span class="comment"> *     &quot;chattype&quot;: &quot;group&quot;,</span></span><br><span class="line"><span class="comment"> *     &quot;from&quot;: &#123;</span></span><br><span class="line"><span class="comment"> *         &quot;userid&quot;: &quot;USERID&quot;</span></span><br><span class="line"><span class="comment"> *     &#125;,</span></span><br><span class="line"><span class="comment"> *     &quot;msgtype&quot;: &quot;text&quot;,</span></span><br><span class="line"><span class="comment"> *     &quot;text&quot;: &#123;</span></span><br><span class="line"><span class="comment"> *         &quot;content&quot;: &quot;<span class="doctag">@RobotA</span> hello robot&quot;</span></span><br><span class="line"><span class="comment"> *     &#125;</span></span><br><span class="line"><span class="comment"> * &#125;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment">  curl -X POST http://127.0.0.1:8080/wx/work/robot/push/wechat?msg_signature=65173e4c8284b36c27ea1565a12fe9b98da7b760&amp;timestamp=1698044465&amp;nonce=1698044465 -H &quot;Content-Type: application/json&quot; -d &#x27;&#123;&quot;encrypt&quot;:&quot;1/eL5o4f0xYunv/GG/9AVW+UXnj3ZCntsFmkLcTW8Ekm8nenhQ2IcTzeZNQujFiXgjrEMAnxFX55pHnYZHxmlEl6K9k+gjLiS8k2gKn4hqmATH8WcQgJW+pahiqg3jH4WMuk6RSgZ6QpL4x21LgUB3SimB5DM4SkkrIDt+sWgM2L0JjJqK9vFio0txS12CW5GBjlpVhg1kcvJP9JZ9c/VYU0eJ9R8I3GfI377UlINYHgwwfFTyRIpeWz8gS9lybijk7vFcNrW+qyvRKOKZeT3Mi7OXuLu4MKuVLL8fDy45E=&quot;&#125;&#x27;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@PostMapping(&quot;/push/wechat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> String <span class="title function_">wechatPost</span><span class="params">(</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(&quot;msg_signature&quot;)</span> String msgSignature,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(&quot;timestamp&quot;)</span> String timestamp,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestParam(&quot;nonce&quot;)</span> String nonce,</span></span><br><span class="line"><span class="params">        <span class="meta">@RequestBody</span> RobotData postData)</span> &#123;</span><br><span class="line"></span><br><span class="line">    log.info(<span class="string">&quot;接收消息请求的签名: &#123;&#125;, 时间戳: &#123;&#125;, 随机数: &#123;&#125;&quot;</span>, msgSignature, timestamp, nonce);</span><br><span class="line">    log.info(<span class="string">&quot;接收到的加密消息: &#123;&#125;&quot;</span>, JSON.toJSONString(postData));</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">// 加解密库要求传 receiveid 参数，企业自建智能机器人的使用场景里，receiveid直接传空字符串即可；。</span></span><br><span class="line">        <span class="type">WXBizJsonMsgCrypt</span> <span class="variable">wxcpt</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WXBizJsonMsgCrypt</span>(sToken, sEncodingAESKey, <span class="string">&quot;&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解密消息</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">sMsg</span> <span class="operator">=</span> wxcpt.DecryptMsg(msgSignature, timestamp, nonce, JSON.toJSONString(postData));</span><br><span class="line">        log.info(<span class="string">&quot;消息解密后内容: &#123;&#125;&quot;</span>, sMsg);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解析消息内容</span></span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">json</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>(sMsg);</span><br><span class="line">        <span class="type">String</span> <span class="variable">msgType</span> <span class="operator">=</span> json.getString(<span class="string">&quot;msgtype&quot;</span>);</span><br><span class="line">        <span class="type">String</span> <span class="variable">chatType</span> <span class="operator">=</span> json.getString(<span class="string">&quot;chattype&quot;</span>); <span class="comment">// 聊天类型: single/group</span></span><br><span class="line">        log.info(<span class="string">&quot;消息类型: &#123;&#125;, 聊天类型: &#123;&#125;&quot;</span>, msgType, chatType);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 处理文本消息</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;text&quot;</span>.equals(msgType)) &#123;</span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">textObj</span> <span class="operator">=</span> json.getJSONObject(<span class="string">&quot;text&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">content</span> <span class="operator">=</span> textObj.getString(<span class="string">&quot;content&quot;</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> json.getJSONObject(<span class="string">&quot;from&quot;</span>).getString(<span class="string">&quot;userid&quot;</span>);</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">&quot;用户[&#123;&#125;]在[&#123;&#125;]聊天中发送消息: &#123;&#125;&quot;</span>, userId, chatType, content);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 构建回复消息</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">replyMsg</span> <span class="operator">=</span> replyMessageStream.reply(json);</span><br><span class="line"></span><br><span class="line">            log.info(<span class="string">&quot;加密前的回复消息: &#123;&#125;&quot;</span>, replyMsg);</span><br><span class="line">            <span class="comment">// 加密回复消息</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">encryptMsg</span> <span class="operator">=</span> wxcpt.EncryptMsg(replyMsg, timestamp, nonce);</span><br><span class="line">            log.info(<span class="string">&quot;加密后的回复消息: &#123;&#125;&quot;</span>, encryptMsg);</span><br><span class="line">            <span class="keyword">return</span> encryptMsg;</span><br><span class="line">        &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;stream&quot;</span>.equals(msgType))&#123;</span><br><span class="line">            <span class="comment">// 企业微信官方文档显示如果首次返回stream，则后续的stream消息会返回stream_id，且stream_id不变</span></span><br><span class="line">            <span class="type">JSONObject</span> <span class="variable">streamObj</span> <span class="operator">=</span> json.getJSONObject(<span class="string">&quot;stream&quot;</span>);</span><br><span class="line">            String streamId= streamObj.getString(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">            <span class="comment">// 通过streamId获取数据栈，返回结果</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">poll</span> <span class="operator">=</span> streamMapRepository.poll(streamId);</span><br><span class="line">            <span class="type">String</span> <span class="variable">streamText</span> <span class="operator">=</span> streamMapRepository.getStreamText(streamId);</span><br><span class="line">            log.info(<span class="string">&quot;streamId: &#123;&#125;, pull: &#123;&#125;, streamText: &#123;&#125;&quot;</span>, streamId, poll, streamText);</span><br><span class="line">            String replyMsg;</span><br><span class="line">            <span class="keyword">if</span>(!StringUtils.hasText(streamText))&#123;</span><br><span class="line">                replyMsg = replyMessageStream.buildStreamMessage(<span class="string">&quot;你好呀！我是智能机器人，有什么可以帮您的吗？ 当前时间是&quot;</span> + <span class="keyword">new</span> <span class="title class_">Date</span>(), streamId, <span class="literal">true</span>, <span class="literal">null</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(<span class="string">&quot;messageend&quot;</span>.equals(poll))&#123;</span><br><span class="line">                replyMsg = replyMessageStream.buildStreamMessage(streamText, streamId, <span class="literal">true</span>, <span class="literal">null</span>);</span><br><span class="line">                <span class="comment">// 结束后清理数据</span></span><br><span class="line">                streamMapRepository.delete(streamId);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                replyMsg = replyMessageStream.buildStreamMessage(streamText, streamId, <span class="literal">false</span>, <span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            log.info(<span class="string">&quot;streamId: &#123;&#125;, 加密前的回复消息: &#123;&#125;&quot;</span>, streamId, replyMsg);</span><br><span class="line">            <span class="comment">// 加密回复消息</span></span><br><span class="line">            <span class="type">String</span> <span class="variable">encryptMsg</span> <span class="operator">=</span> wxcpt.EncryptMsg(replyMsg, timestamp, nonce);</span><br><span class="line">            log.info(<span class="string">&quot;streamId: &#123;&#125;, 加密后的回复消息: &#123;&#125;&quot;</span>, streamId, encryptMsg);</span><br><span class="line">            <span class="keyword">return</span> encryptMsg;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;处理消息失败&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="消息格式说明"><a href="#消息格式说明" class="headerlink" title="消息格式说明"></a>消息格式说明</h2><p>企业微信推送的消息格式示例：实际以官方最新内容为准。</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;msgid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CAIQ16HMjQYY/NGagIOAgAMgq4KM0AI=&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;aibotid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;AIBOTID&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;chatid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CHATID&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;chattype&quot;</span><span class="punctuation">:</span> <span class="string">&quot;group&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;from&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;userid&quot;</span><span class="punctuation">:</span> <span class="string">&quot;USERID&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;msgtype&quot;</span><span class="punctuation">:</span> <span class="string">&quot;text&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;text&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;content&quot;</span><span class="punctuation">:</span> <span class="string">&quot;@RobotA hello robot&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line">参数  说明</span><br><span class="line">msgid   本次回调的唯一性标志，开发者需据此进行事件排重（可能因为网络等原因重复回调）</span><br><span class="line">aibotid 智能机器人id</span><br><span class="line">chatid  会话id，仅群聊类型时候返回</span><br><span class="line">chattype    会话类型，single\group，分别表示：单聊\群聊</span><br><span class="line">from    该事件触发者的信息</span><br><span class="line">from.userid 操作者的userid</span><br><span class="line">msgtype 消息类型，此时固定是text</span><br><span class="line">text.content    消息内容</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="修改加解密工具类"><a href="#修改加解密工具类" class="headerlink" title="修改加解密工具类"></a>修改加解密工具类</h1><p>修改 JsonParse 类的 extract 方法：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 提取出 JSON 包中的加密消息</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> jsontext 待提取的json字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 提取出的加密消息字符串</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> AesException </span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Object[] extract(String jsontext) <span class="keyword">throws</span> AesException &#123;</span><br><span class="line">    Object[] result = <span class="keyword">new</span> <span class="title class_">Object</span>[<span class="number">3</span>];</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">JSONObject</span> <span class="variable">json</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JSONObject</span>(jsontext);</span><br><span class="line">        <span class="type">String</span> <span class="variable">encrypt_msg</span> <span class="operator">=</span> json.getString(<span class="string">&quot;encrypt&quot;</span>);</span><br><span class="line">        <span class="comment">// 企业微信机器人消息格式中不包含tousername和agentid</span></span><br><span class="line">        result[<span class="number">0</span>] = <span class="string">&quot;&quot;</span>; <span class="comment">// tousername</span></span><br><span class="line">        result[<span class="number">1</span>] = encrypt_msg;</span><br><span class="line">        result[<span class="number">2</span>] = <span class="string">&quot;&quot;</span>; <span class="comment">// agentid</span></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;json解析出错！&quot;</span>, e);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">AesException</span>(AesException.ParseJsonError);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="代码路径"><a href="#代码路径" class="headerlink" title="代码路径"></a>代码路径</h1><p>如果有帮助，点点star <a href="https://github.com/zhaozhiwei1992/weixin-work-bot">https://github.com/zhaozhiwei1992/weixin-work-bot</a></p>
<h1 id="配置与测试"><a href="#配置与测试" class="headerlink" title="配置与测试"></a>配置与测试</h1><h2 id="应用部署"><a href="#应用部署" class="headerlink" title="应用部署"></a>应用部署</h2><p>将应用部署到具备域名的服务器上并确保应用可通过HTTPS访问（企业微信要求回调URL必须是HTTPS）</p>
<h2 id="机器人配置"><a href="#机器人配置" class="headerlink" title="机器人配置"></a>机器人配置</h2><ol>
<li>在企业微信管理后台创建API模式的智能机器人 <img src="http://43.143.194.245:9000/images/20251030/001_005.png"></li>
<li>随机生成Token和EncodingAESKey，在application.yml中填入生成的Token和EncodingAESKey</li>
<li>设置回调URL为：https:&#x2F;&#x2F;您的域名&#x2F;robot&#x2F;push&#x2F;wechat?corpid&#x3D;$CORPID$<br><img src="http://43.143.194.245:9000/images/20251030/001_006.png"></li>
</ol>
<h2 id="测试验证"><a href="#测试验证" class="headerlink" title="测试验证"></a>测试验证</h2><p>URL验证测试：保存机器人配置时，企业微信会自动调用验证接口</p>
<h3 id="消息接收测试："><a href="#消息接收测试：" class="headerlink" title="消息接收测试："></a>消息接收测试：</h3><p>在企业微信中单聊或群聊中@机器人发送消息，查看后台日志确认收到并正确处理消息，验证机器人是否能正确回复。</p>
<p><img src="http://43.143.194.245:9000/images/20251030/001_007.png"> <img src="/./images/001_008.png"></p>
<h2 id="常见问题排查"><a href="#常见问题排查" class="headerlink" title="常见问题排查"></a>常见问题排查</h2><ol>
<li>URL验证失败：检查Token、EncodingAESKey和corpid是否正确</li>
<li>解密失败：检查提取加密消息的方法是否正确修改</li>
<li>无法回复消息：检查回复消息的格式是否符合企业微信要求，回复msgtype一定要用stream，否则可能出现都访问通了，但是客户端收不到消息。</li>
<li>HTTPS证书问题：确保证书有效且受信任</li>
</ol>
<h1 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h1><p>性能考虑：消息处理应尽量高效，避免超时（企业微信默认超时时间为5秒）<br>安全考虑： 验证消息签名确保请求来自企业微信<br>对用户输入进行适当过滤和转义，防止注入攻击<br>错误处理：妥善处理所有异常，避免服务崩溃<br>日志记录：详细记录请求和响应信息，便于排查问题<br>通过以上步骤，您可以成功开发并部署一个企业微信智能机器人，实现接收消息和自动回复的功能。</p>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://developer.work.weixin.qq.com/community/question/detail?content_id=16740110965903826290">https://developer.work.weixin.qq.com/community/question/detail?content_id=16740110965903826290</a></p>
<p><a href="https://blog.csdn.net/qq_52011411/article/details/150932697">https://blog.csdn.net/qq_52011411/article/details/150932697</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/06/18/Dify0.15.1%E5%8D%87%E7%BA%A71.4.3/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/06/18/Dify0.15.1%E5%8D%87%E7%BA%A71.4.3/" class="post-title-link" itemprop="url">Dify0.15.1升级1.4.3版本</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-06-18 08:00:00" itemprop="dateCreated datePublished" datetime="2025-06-18T08:00:00+08:00">2025-06-18</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="安装1-4-3"><a href="#安装1-4-3" class="headerlink" title="安装1.4.3"></a>安装1.4.3</h1><p><a href="https://codeload.github.com/langgenius/dify/tar.gz/refs/tags/1.4.3">https://codeload.github.com/langgenius/dify/tar.gz/refs/tags/1.4.3</a></p>
<p>下载后在原dify-0.15.1同级目录解压</p>
<h2 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h2><p>cd dify-1.4.3&#x2F;docker</p>
<p>cp .env.example .env # 公司环境需要调整nginx expose端口</p>
<p>docker-compose up -d # 等待启动完成，正常访问页面即可</p>
<h1 id="压缩原挂载目录"><a href="#压缩原挂载目录" class="headerlink" title="压缩原挂载目录"></a>压缩原挂载目录</h1><p>cd dify-0.15.1&#x2F;docker</p>
<p>tar -zcvf volumes.tar.gz volumes</p>
<h1 id="用0-15-1的挂载目录覆盖1-4-3的挂载"><a href="#用0-15-1的挂载目录覆盖1-4-3的挂载" class="headerlink" title="用0.15.1的挂载目录覆盖1.4.3的挂载"></a>用0.15.1的挂载目录覆盖1.4.3的挂载</h1><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1. 备份1.4.3挂载目录</span><br><span class="line">tar -zcvf volumes143.tar.gz volumes</span><br><span class="line"></span><br><span class="line">2. 删除挂载目录</span><br><span class="line">rm -rf volumes</span><br><span class="line"></span><br><span class="line">3. 用0.15.1的挂载覆盖当前挂载目录，如果是开发本地使用，可以用官方提供的方式测试。</span><br><span class="line">cp dify-0.15.1/docker/volumes.tar.gz .</span><br><span class="line"></span><br><span class="line">tar -zxvf volumes.tar.gz</span><br><span class="line"></span><br><span class="line">4. 启动服务访问测试</span><br><span class="line">docker-compose up -d</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h1 id="启动后操作"><a href="#启动后操作" class="headerlink" title="启动后操作"></a>启动后操作</h1><ol>
<li>原项目中一些llm，embedding等都没有配置，需要自己在界面增加供应商再次配置即可，配置后重新刷新页面。</li>
</ol>
<h1 id="备注"><a href="#备注" class="headerlink" title="备注"></a>备注</h1><ol>
<li>如果是内网环境，docker需要在公网环境下载好后，通过load方式加载到内网，对于插件同理。</li>
</ol>
<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p><a href="https://docs.dify.ai/zh-hans/development/migration/migrate-to-v1">https://docs.dify.ai/zh-hans/development/migration/migrate-to-v1</a></p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/04/28/RooCode%E7%BB%93%E5%90%88%E6%9C%AC%E5%9C%B0MCP%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/28/RooCode%E7%BB%93%E5%90%88%E6%9C%AC%E5%9C%B0MCP%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">RooCode结合本地MCP实践</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-04-28 08:00:00" itemprop="dateCreated datePublished" datetime="2025-04-28T08:00:00+08:00">2025-04-28</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/AI/" itemprop="url" rel="index"><span itemprop="name">AI</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="引言"><a href="#引言" class="headerlink" title="引言"></a>引言</h1><p>目前MCP也炒了一段时间，是骡子是马得拉出来溜溜。这篇文章偏向点技术，如果没有一点开发经验听个响就好。</p>
<h1 id="实现两个简单功能"><a href="#实现两个简单功能" class="headerlink" title="实现两个简单功能"></a>实现两个简单功能</h1><h2 id="计算求和"><a href="#计算求和" class="headerlink" title="计算求和"></a>计算求和</h2><h2 id="显示本地目录列表"><a href="#显示本地目录列表" class="headerlink" title="显示本地目录列表"></a>显示本地目录列表</h2><h1 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h1><h2 id="通过python实现一个server"><a href="#通过python实现一个server" class="headerlink" title="通过python实现一个server"></a>通过python实现一个server</h2><h3 id="文件创建"><a href="#文件创建" class="headerlink" title="文件创建"></a>文件创建</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/workspace/python/demo</span><br><span class="line"><span class="built_in">mkdir</span> mcp &amp;&amp; <span class="built_in">cd</span> mcp</span><br><span class="line"><span class="built_in">touch</span> SumMCP.py</span><br></pre></td></tr></table></figure>

<h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">一个MCP Server, SumMCP.py</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="keyword">from</span> fastmcp <span class="keyword">import</span> FastMCP</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">mcp = FastMCP(<span class="string">&quot;Demo&quot;</span>, log_level=<span class="string">&quot;ERROR&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">add</span>(<span class="params">a: <span class="built_in">int</span>, b: <span class="built_in">int</span></span>) -&gt; <span class="built_in">int</span>:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;Add two numbers&quot;&quot;&quot;</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;add&quot;</span>, a, b)</span><br><span class="line">    <span class="keyword">return</span> a + b</span><br><span class="line"></span><br><span class="line"><span class="meta">@mcp.tool()</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">listdir</span>(<span class="params">path: <span class="built_in">str</span></span>) -&gt; <span class="built_in">list</span>[<span class="built_in">str</span>]:</span><br><span class="line">    <span class="string">&quot;&quot;&quot;show user dir list 显示用户文件列表&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> os.listdir(path)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment"># mcp.run()</span></span><br><span class="line">    <span class="comment"># mcp.run(transport=&quot;sse&quot;, port=9123)</span></span><br><span class="line">    <span class="comment"># 基于标准输入输出实现，本地小工具推荐这种方式</span></span><br><span class="line">    mcp.run(transport=<span class="string">&#x27;stdio&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h3 id="依赖安装"><a href="#依赖安装" class="headerlink" title="依赖安装"></a>依赖安装</h3><p>我这里使用的是anaconda，其它依赖管理都行</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">conda create -n py_3.12 python=3.12</span><br><span class="line"><span class="built_in">source</span> /opt/anaconda/bin/activate py_3.12</span><br><span class="line">pip install fastmcp</span><br></pre></td></tr></table></figure>

<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://github.com/jlowin/fastmcp">https://github.com/jlowin/fastmcp</a></p>
<h2 id="vscode安装RooCode插件"><a href="#vscode安装RooCode插件" class="headerlink" title="vscode安装RooCode插件"></a>vscode安装RooCode插件</h2><h2 id="在RooCode插件中配置MCP"><a href="#在RooCode插件中配置MCP" class="headerlink" title="在RooCode插件中配置MCP"></a>在RooCode插件中配置MCP</h2><h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><p>在mcp_setting.json文件中配置自己的server</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;mcpServers&quot;: &#123;</span><br><span class="line">    &quot;demo&quot;: &#123;</span><br><span class="line">      &quot;command&quot;: &quot;~/.conda/envs/py_3.12/bin/fastmcp&quot;,</span><br><span class="line">      &quot;args&quot;: [&quot;run&quot;, &quot;~/workspace/python/demo/mcp/SumMCP.py&quot;],</span><br><span class="line">      &quot;disabled&quot;: false,</span><br><span class="line">      &quot;alwaysAllow&quot;: []</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="检查是否成功"><a href="#检查是否成功" class="headerlink" title="检查是否成功"></a>检查是否成功</h3><p>配置完成后，mcpServer会显示绿色图标,如下</p>
<p><img src="https://19921514.xyz/minio/images/roocode_mcp.png" alt="mcp配置"></p>
<p>如果在之前SumMCP.py中增加了工具，一定要在这里刷新下，显示出新的工具，然后在插件中使用才会读取到。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="求和"><a href="#求和" class="headerlink" title="求和"></a>求和</h3><p>使用demo工具, 计算99和98的和, 效果如下</p>
<p><img src="https://19921514.xyz/minio/images/roocode_mcp_sum.png" alt="显示求和"></p>
<h3 id="显示文件列表"><a href="#显示文件列表" class="headerlink" title="显示文件列表"></a>显示文件列表</h3><p>使用listdir工具显示 &#x2F;home&#x2F;xx&#x2F;Documents下的文件列表，效果如下</p>
<p><img src="https://19921514.xyz/minio/images/roocode_mcp_listdir.png" alt="显示文件列表"></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>使用mcp的方式可以按照自己要求实现一些插件本身做不了或者不好实现的功能。目的是为了让外部交互的返回更好的跟模型上下文结合，从而产生更好的效果。如果对话过程中，模型能够自动识别是需要使用哪个mcp那么效果应该会更好。目前是需要明确告诉插件使用mcp，有时候甚至得告诉它具体是哪个tool。</p>
<p>这里只是一个最简单的使用，企业项目中能否使用该方式扩展业务，如何扩展，且听下回分解。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/04/22/Vaultwarden%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/04/22/Vaultwarden%E5%AF%86%E7%A0%81%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">本地密码管理器-Vaultwarden</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-04-22 00:00:00" itemprop="dateCreated datePublished" datetime="2025-04-22T00:00:00+08:00">2025-04-22</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>之前主要使用lastpass，目前是浏览器端免费，其它都要收费，而且密码存在别人服务器总是不放心。</p>
<p>所以我们要本地部署vaultwarden并且可以在各种Bitwarden正常使用。这里使用vaultwarden是因为相比原生更加轻量，占用资源极少。</p>
<h1 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h1><h2 id="环境准备​​"><a href="#环境准备​​" class="headerlink" title="环境准备​​"></a>环境准备​​</h2><p>​​服务器要求​​：腾讯云服务器（1核2GB内存，Ubuntu&#x2F;Debian系统）。</p>
<p>​​开放端口​​：80（HTTP）、443（HTTPS），通过腾讯云控制台配置安全组</p>
<p>注:<br>如果家里本身就有公网ip，或者只是本地玩玩，是不需要公网服务器的。我这里公网服务器资源紧张，用来做转发，实际服务部署到内网机，所以公网和内网交互需要内网穿透，我这里使用的是zerotier。</p>
<h2 id="内网机部署"><a href="#内网机部署" class="headerlink" title="内网机部署"></a>内网机部署</h2><p>为了方便从云服务器转发到内网，所以通过nginx包一层，给vaultwarden套一个前缀，比如:&#x2F;bitwarden。否则云服务nginx转发会很乱</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">nginx-proxy:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">nginx:alpine</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">nginx-proxy</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;8000:80&quot;</span>    <span class="comment"># 对外暴露 HTTPS 端口</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./nginx.conf:/etc/nginx/nginx.conf</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./ssl:/etc/nginx/ssl</span>   <span class="comment"># 证书存储目录</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">vaultwarden-net</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">vaultwarden</span></span><br><span class="line">  <span class="attr">vaultwarden:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">vaultwarden/server:latest</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">vaultwarden</span></span><br><span class="line">    <span class="attr">restart:</span> <span class="string">unless-stopped</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">vaultwarden-net</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">./vw-data/:/data/</span></span><br><span class="line">    <span class="attr">expose:</span>          <span class="comment"># 仅内部暴露端口，nginx能访问即可</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;80&quot;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">&quot;3012&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 自定义网络（实现容器间通信）</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">vaultwarden-net:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">bridge</span></span><br></pre></td></tr></table></figure>

<h3 id="挂载目录结构如下"><a href="#挂载目录结构如下" class="headerlink" title="挂载目录结构如下"></a>挂载目录结构如下</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">vaultwarden/</span><br><span class="line">├── docker-compose.yaml</span><br><span class="line">└── volumes</span><br><span class="line">    ├── nginx</span><br><span class="line">    │   ├── conf.d</span><br><span class="line">    │   │   └── default.conf</span><br><span class="line">    │   ├── ssl</span><br><span class="line">    │   │   ├── certificate.crt</span><br><span class="line">    │   │   └── private.key</span><br><span class="line">    │   └── uwsgi_params</span><br><span class="line">    └── vw-data</span><br></pre></td></tr></table></figure>

<h3 id="conf-d-default-conf配置"><a href="#conf-d-default-conf配置" class="headerlink" title="conf.d&#x2F;default.conf配置"></a>conf.d&#x2F;default.conf配置</h3><p>这里nginx.conf会默认引入所有conf.d&#x2F;*.conf</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen       80;</span><br><span class="line">    listen  [::]:80;</span><br><span class="line">    server_name  localhost;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">return</span> 301 https://$host<span class="variable">$request_uri</span>;  <span class="comment"># 301 永久重定向</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># HTTPS 主配置</span></span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl http2;</span><br><span class="line">    listen [::]:443 ssl http2;</span><br><span class="line">    server_name localhost;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 证书配置（自签名示例，生产环境替换为 Let&#x27;s Encrypt）</span></span><br><span class="line">    <span class="comment">#ssl_certificate /etc/nginx/ssl/cert.pem;</span></span><br><span class="line">    <span class="comment">#ssl_certificate_key /etc/nginx/ssl/privkey.pem;</span></span><br><span class="line">    ssl_certificate /etc/nginx/ssl/certificate.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/private.key;</span><br><span class="line">    ssl_session_cache shared:SSL:1m;</span><br><span class="line">    ssl_session_timeout 10m;</span><br><span class="line">    ssl_ciphers HIGH:!aNULL:!MD5;</span><br><span class="line">    ssl_prefer_server_ciphers on;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 静态文件服务（可选）</span></span><br><span class="line">    location / &#123;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Vaultwarden 代理配置（核心修正）</span></span><br><span class="line">    location /bitwarden/ &#123;</span><br><span class="line">        proxy_pass http://vaultwarden/;  <span class="comment"># 末尾斜杠确保移除路径前缀</span></span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 解决路径前缀导致的资源加载问题</span></span><br><span class="line">        proxy_redirect off;</span><br><span class="line">        sub_filter_once off;</span><br><span class="line">        sub_filter_types *;</span><br><span class="line">        sub_filter <span class="string">&#x27;href=&quot;/&#x27;</span> <span class="string">&#x27;href=&quot;/bitwarden/&#x27;</span>;</span><br><span class="line">        sub_filter <span class="string">&#x27;src=&quot;/&#x27;</span> <span class="string">&#x27;src=&quot;/bitwarden/&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># WebSocket 支持（实时同步）, 自 v1.31.0 起，已移除对 3012 端口 WebSocket 流量的支持，因为它已集成至主 HTTP 端口。</span></span><br><span class="line">    location /bitwarden/notifications/hub &#123;</span><br><span class="line">        proxy_pass http://vaultwarden:3012;</span><br><span class="line">        proxy_set_header Upgrade <span class="variable">$http_upgrade</span>;</span><br><span class="line">        proxy_set_header Connection <span class="string">&quot;upgrade&quot;</span>;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 错误页面配置（保持原样）</span></span><br><span class="line">    error_page 500 502 503 504 /50x.html;</span><br><span class="line">    location = /50x.html &#123;</span><br><span class="line">        root /usr/share/nginx/html;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="配置自签名证书"><a href="#配置自签名证书" class="headerlink" title="配置自签名证书"></a>配置自签名证书</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在docker-compose同级目录执行</span></span><br><span class="line"><span class="built_in">sudo</span> openssl req -x509 -nodes -days 365 -newkey rsa:2048 \</span><br><span class="line">  -keyout ./volumes/nginx/ssl/private.key \</span><br><span class="line">  -out ./volumes/nginx/ssl/certificate.crt</span><br></pre></td></tr></table></figure>

<h3 id="服务启动"><a href="#服务启动" class="headerlink" title="服务启动"></a>服务启动</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker-compose up -d</span><br></pre></td></tr></table></figure>

<h3 id="测试访问"><a href="#测试访问" class="headerlink" title="测试访问"></a>测试访问</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://10.241.189.234:8443/bitwarden</span><br></pre></td></tr></table></figure>

<h2 id="公网ECS配置nginx-无域名"><a href="#公网ECS配置nginx-无域名" class="headerlink" title="公网ECS配置nginx(无域名)"></a>公网ECS配置nginx(无域名)</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /etc/nginx/conf.d</span><br><span class="line"></span><br><span class="line"><span class="comment"># 增加 234-proxy-443.conf, 这里一定要注意，把nginx.conf中server啥的都干掉，避免影响。</span></span><br><span class="line"></span><br><span class="line">[root@VM-8-12-centos conf.d]# <span class="built_in">cat</span> 234-proxy-443.conf</span><br><span class="line">server &#123;</span><br><span class="line">    listen 443 ssl;</span><br><span class="line">    server_name 替换为你的公网域名或IP;  <span class="comment"># 替换为你的公网域名或IP</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># SSL 证书配置（必须使用有效证书，如 Let&#x27;s Encrypt）</span></span><br><span class="line">    <span class="comment"># ssl_certificate /etc/letsencrypt/live/your-public-domain.com/fullchain.pem;</span></span><br><span class="line">    <span class="comment"># ssl_certificate_key /etc/letsencrypt/live/your-public-domain.com/privkey.pem;</span></span><br><span class="line">    ssl_certificate /etc/nginx/ssl/certificate.crt;</span><br><span class="line">    ssl_certificate_key /etc/nginx/ssl/private.key;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"># 反向代理到内网服务</span></span><br><span class="line">    location /bitwarden &#123;</span><br><span class="line">    proxy_pass https://10.241.189.234:8443;</span><br><span class="line">        proxy_set_header Host <span class="variable">$host</span>;</span><br><span class="line">        proxy_set_header X-Real-IP <span class="variable">$remote_addr</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-For <span class="variable">$proxy_add_x_forwarded_for</span>;</span><br><span class="line">        proxy_set_header X-Forwarded-Proto <span class="variable">$scheme</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment"># 信任内网服务的自签名证书（可选）</span></span><br><span class="line">        proxy_ssl_verify off;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"># 其他安全头配置</span></span><br><span class="line">    add_header Strict-Transport-Security <span class="string">&quot;max-age=63072000; includeSubDomains; preload&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="nginx-s-reload"><a href="#nginx-s-reload" class="headerlink" title="nginx -s reload"></a>nginx -s reload</h3><h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">https://ECS公网IP/bitwarden</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这种方式配置后，在浏览器可以直接使用，包括插件。但是会提示证书不安全，手机端除非手动能安装自建证书，否则无法直接使用。</span></span><br></pre></td></tr></table></figure>

<h2 id="公网ECS配置nginx-有域名"><a href="#公网ECS配置nginx-有域名" class="headerlink" title="公网ECS配置nginx(有域名)"></a>公网ECS配置nginx(有域名)</h2><p>以腾讯ECS为例</p>
<h3 id="域名配置"><a href="#域名配置" class="headerlink" title="域名配置"></a>域名配置</h3><p>根据官方提示，将域名绑定到ECS机器</p>
<p>进行域名备案</p>
<h3 id="调整nginx配置"><a href="#调整nginx配置" class="headerlink" title="调整nginx配置"></a>调整nginx配置</h3><p>使用免费或者付费的ssl证书，下载后替换nginx中配置的证书信息</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># SSL 证书配置（必须使用有效证书）</span></span><br><span class="line">ssl_certificate /etc/nginx/ssl/自己的域名.crt;</span><br><span class="line">ssl_certificate_key /etc/nginx/ssl/自己的域名.xyz.key;</span><br></pre></td></tr></table></figure>

<h2 id="客户端配置"><a href="#客户端配置" class="headerlink" title="客户端配置"></a>客户端配置</h2><ol>
<li>下载安装bitwarden相关客户端，包括app端，浏览器插件等</li>
<li>配置为自托管，然后按照自己设置的用户密码登录即可</li>
</ol>
<h1 id="备份"><a href="#备份" class="headerlink" title="备份"></a>备份</h1><p>找一个自己觉得安全的地方备份自己的挂载(volumes目录)，比如NAS或者网盘，U盘等</p>
<h1 id="问题处理"><a href="#问题处理" class="headerlink" title="问题处理"></a>问题处理</h1><h2 id="console-log-service-ts-53-Unhandled-error-in-angular-Error-Could-not-instantiate-WebCryptoFunctionService-Could-not-locate-Subtle-crypto"><a href="#console-log-service-ts-53-Unhandled-error-in-angular-Error-Could-not-instantiate-WebCryptoFunctionService-Could-not-locate-Subtle-crypto" class="headerlink" title="console-log.service.ts:53 Unhandled error in angular Error: Could not instantiate WebCryptoFunctionService. Could not locate Subtle crypto."></a>console-log.service.ts:53 Unhandled error in angular Error: Could not instantiate WebCryptoFunctionService. Could not locate Subtle crypto.</h2><h3 id="分析处理"><a href="#分析处理" class="headerlink" title="分析处理"></a>分析处理</h3><p>必须使用https访问，否则报错</p>
<h2 id="安卓客户端无法访问，提示无法验证服务器证书"><a href="#安卓客户端无法访问，提示无法验证服务器证书" class="headerlink" title="安卓客户端无法访问，提示无法验证服务器证书"></a>安卓客户端无法访问，提示无法验证服务器证书</h2><h3 id="分析处理-1"><a href="#分析处理-1" class="headerlink" title="分析处理"></a>分析处理</h3><p>这个真得有域名了。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="http://zhaozhiwei1992.github.io/2025/03/30/%E4%B8%9A%E5%8A%A1+AI%E4%BC%81%E4%B8%9A%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="Mr.zhao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="离线de日常">
      <meta itemprop="description" content="show me your code">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | 离线de日常">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/2025/03/30/%E4%B8%9A%E5%8A%A1+AI%E4%BC%81%E4%B8%9A%E8%90%BD%E5%9C%B0%E5%AE%9E%E8%B7%B5/" class="post-title-link" itemprop="url">从业务视角看AI落地：避免技术狂欢，聚焦真实需求</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2025-03-30 00:00:00" itemprop="dateCreated datePublished" datetime="2025-03-30T00:00:00+08:00">2025-03-30</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-11-12 15:40:02" itemprop="dateModified" datetime="2025-11-12T15:40:02+08:00">2025-11-12</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h1 id="前言：为什么企业需要警惕”AI军备竞赛”？"><a href="#前言：为什么企业需要警惕”AI军备竞赛”？" class="headerlink" title="前言：为什么企业需要警惕”AI军备竞赛”？"></a>前言：为什么企业需要警惕”AI军备竞赛”？</h1><p>当前AI技术发展呈现”技术狂欢”态势，今天Deepseek火了跟一把，明天出来个其它看着高级的东西又跟一把。但企业实践中最常出现的问题在于：投入大量资源训练模型后，业务价值却难以量化。本文从业务出发，探讨如何让AI真正成为业务增长的助推器。</p>
<h1 id="为什么AI是业务的必选项"><a href="#为什么AI是业务的必选项" class="headerlink" title="为什么AI是业务的必选项?"></a>为什么AI是业务的必选项?</h1><p>现在网上AI技术层出不穷，很多人通过ai来做一些日常工作，比如写写文章，查查资料，做做总结。高级一点的自己通过coze之类的平台做一些自己的AI工作流，智能体，通过各种组合提高自己的工作效率。</p>
<p>对于企业来说，如果自己在业务上能跟AI结合，能够从各方面提高自己产品的竞争力。</p>
<p>就以客服系统来说，有时候机器人客服回复的内容比较死板，很多都是通过内容匹配给出结果。但是使用AI以后能够充分利用AI的分析总结能力，将一些散落的知识分析总结，更加合理的提供给用户，甚至不仔细观察都以为是真人。相对于之前冷冰冰的知识，通过AI可以更好的提高客户体验，增强客户满意度和忠诚度。</p>
<h1 id="为什么AI很难在企业中落地"><a href="#为什么AI很难在企业中落地" class="headerlink" title="为什么AI很难在企业中落地?"></a>为什么AI很难在企业中落地?</h1><p>这里不是说落不了地，而是这么久了还没有爆炸性落地的产品。之前Deepseek火了，出来一拨”落地”热，基本上就是自己自己部署个模型或者搭建个简单知识库就敢说是落地。</p>
<p>其实AI无法落地主要的问题在于找不到切入点，还有行动力不足。首先是切入点问题，有些领导认为AI无所不能，上来就是高难度操作，认为只要部署个模型，挂个知识库，就可以让自己的产品智能了，用户问啥能干啥，也不需要那么多开发，测试，运营了。这种是完全被洗脑的，觉得AI就是神仙，无所不能，并不是所有场景适合硬往AI上套。还有一种是行动力不足，觉得AI现在发展还看不懂，不够成熟，准备再观察观察。</p>
<p>那么怎么让业务能跟AI更好的结合呢，下面我会给出一些自己在实践中的理解。</p>
<h1 id="AI如何重塑核心场景"><a href="#AI如何重塑核心场景" class="headerlink" title="AI如何重塑核心场景?"></a>AI如何重塑核心场景?</h1><h2 id="正确认识AI"><a href="#正确认识AI" class="headerlink" title="正确认识AI"></a>正确认识AI</h2><p>首先我们要对AI有个正确的认识，AI不是无所不能，并不是所有的场景都适合AI。AI本生是科技的产物，可以把它理解为一个拥有海量通用知识的业务小白。业务太庞杂了，对于一个行业内摸爬滚打多年的人都不敢说样样精通，并且很多业务不公开或者还需要随机应变，一些网上能下载到的通用大模型根本没有经过业务训练，不可能一上来就解决业务问题。</p>
<h2 id="识别关键业务场景"><a href="#识别关键业务场景" class="headerlink" title="识别关键业务场景"></a>识别关键业务场景</h2><p>之前说道网上有很多把AI玩出花的场景，也有很多解决实际问题的场景。为什么能出现这些东西，是因为大家会思考，能动手，知道自己要什么。比如我在没有AI之前也会通过程序脚本之类的各种玩意儿来解决自己实际问题，提高效率。对个人来说会思考，知道自己要什么，加一点点动手能力才能用好AI。</p>
<p>对于企业来说本身在行业深耕多年，业务就是企业最大的优势，应深入分析业务，在业务中找到与AI的结合点。AI的能力应该是解决实际问题，而不是为了应用AI而强行整合。再炫酷的操作如何用户不买账没有任何意义。最好是找三五个业务专家，再配合三五个对AI了解的工程师大家坐在一起，互相分享下业务场景，AI相关知识，多次分享讨论研究最终找出中间的结合点。</p>
<p>一定不要刚开始就给自己上强度，可以先找点场景试试demo，在做的过程中发现真正需要的场景再去挖掘。中小公司千万不要一上来就微调训练模型。刚开始的目标应该是业务+AI，业务为主，AI为辅，用业务驱动AI更快落地，最终让AI成为系统中一项不可分割的能力。</p>
<h2 id="AI技术的应用案例"><a href="#AI技术的应用案例" class="headerlink" title="AI技术的应用案例"></a>AI技术的应用案例</h2><p>下边我给出一些业务中使用的案例，供大家参考，不同的企业有不同的业务，这里只抛砖引玉。</p>
<h3 id="AI助理"><a href="#AI助理" class="headerlink" title="AI助理"></a>AI助理</h3><p>首先是问答类的AI助理，这种是对知识库的应用。企业在多年发展过程中本身积累了不少行业知识，那么就可以整理调整为知识库供AI使用。如何做知识库之前文章也说过，最重要的是知识库的准确性，一般来说，整理成QA方式最方便知识库使用，可以先将一些系统操作手册，问题解决方案之类的东西做知识库，后边再扩展。</p>
<h3 id="智能风控"><a href="#智能风控" class="headerlink" title="智能风控"></a>智能风控</h3><p>在很多领域都有风控的处理，好一点的会使用一些规则库进行处理，如果差的直接就是硬编码了，这些规则一般都是来源于一些业务或者政策文件，需要翻译成程序能识别的规则才能使用。如果用AI，我们只需要把这些政策做到人能理解的程度，那么AI就可以结合规则在数据流转中进行控制，并按照预设的要求进行反馈，比如生成一个风控报告之类的。这种方式比通过程序处理更方便，不用单独再通过程序实现报告功能，还得需要程序去主动调用。</p>
<h3 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h3><p>每个企业的业务都不一样，主要是从业务入手，去发现。一定是奔着简化用户操作，优化用户体验去的场景，而不是为了AI而造出来的业务。</p>
<h1 id="技术选型"><a href="#技术选型" class="headerlink" title="技术选型"></a>技术选型</h1><p>业务再整合模型时一定不会只使用一种模型走天下，不同的模型有不同的优势。所以前期可以选择市面好用的编排工具，比如DIFY之类的，配置比较灵活，可以整合市面上绝大部分模型。</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" title="下一页" aria-label="下一页" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>

</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2026</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Mr.zhao</span>
  </div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="https://cdnjs.cloudflare.com/ajax/libs/ribbon.js/1.0.2/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script>

  






  





</body>
</html>
